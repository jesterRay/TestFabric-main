{"ast":null,"code":"'use strict';\n\nvar c = require('./constants');\nvar d3 = require('@plotly/d3');\nvar Lib = require('../../lib');\nvar numberFormat = Lib.numberFormat;\nvar gup = require('../../lib/gup');\nvar Drawing = require('../../components/drawing');\nvar svgUtil = require('../../lib/svg_text_utils');\nvar raiseToTop = require('../../lib').raiseToTop;\nvar strTranslate = require('../../lib').strTranslate;\nvar cancelEeaseColumn = require('../../lib').cancelTransition;\nvar prepareData = require('./data_preparation_helper');\nvar splitData = require('./data_split_helpers');\nvar Color = require('../../components/color');\nmodule.exports = function plot(gd, wrappedTraceHolders) {\n  var dynamic = !gd._context.staticPlot;\n  var table = gd._fullLayout._paper.selectAll('.' + c.cn.table).data(wrappedTraceHolders.map(function (wrappedTraceHolder) {\n    var traceHolder = gup.unwrap(wrappedTraceHolder);\n    var trace = traceHolder.trace;\n    return prepareData(gd, trace);\n  }), gup.keyFun);\n  table.exit().remove();\n  table.enter().append('g').classed(c.cn.table, true).attr('overflow', 'visible').style('box-sizing', 'content-box').style('position', 'absolute').style('left', 0).style('overflow', 'visible').style('shape-rendering', 'crispEdges').style('pointer-events', 'all');\n  table.attr('width', function (d) {\n    return d.width + d.size.l + d.size.r;\n  }).attr('height', function (d) {\n    return d.height + d.size.t + d.size.b;\n  }).attr('transform', function (d) {\n    return strTranslate(d.translateX, d.translateY);\n  });\n  var tableControlView = table.selectAll('.' + c.cn.tableControlView).data(gup.repeat, gup.keyFun);\n  var cvEnter = tableControlView.enter().append('g').classed(c.cn.tableControlView, true).style('box-sizing', 'content-box');\n  if (dynamic) {\n    var wheelEvent = 'onwheel' in document ? 'wheel' : 'mousewheel';\n    cvEnter.on('mousemove', function (d) {\n      tableControlView.filter(function (dd) {\n        return d === dd;\n      }).call(renderScrollbarKit, gd);\n    }).on(wheelEvent, function (d) {\n      if (d.scrollbarState.wheeling) return;\n      d.scrollbarState.wheeling = true;\n      var newY = d.scrollY + d3.event.deltaY;\n      var noChange = makeDragRow(gd, tableControlView, null, newY)(d);\n      if (!noChange) {\n        d3.event.stopPropagation();\n        d3.event.preventDefault();\n      }\n      d.scrollbarState.wheeling = false;\n    }).call(renderScrollbarKit, gd, true);\n  }\n  tableControlView.attr('transform', function (d) {\n    return strTranslate(d.size.l, d.size.t);\n  });\n\n  // scrollBackground merely ensures that mouse events are captured even on crazy fast scrollwheeling\n  // otherwise rendering glitches may occur\n  var scrollBackground = tableControlView.selectAll('.' + c.cn.scrollBackground).data(gup.repeat, gup.keyFun);\n  scrollBackground.enter().append('rect').classed(c.cn.scrollBackground, true).attr('fill', 'none');\n  scrollBackground.attr('width', function (d) {\n    return d.width;\n  }).attr('height', function (d) {\n    return d.height;\n  });\n  tableControlView.each(function (d) {\n    Drawing.setClipUrl(d3.select(this), scrollAreaBottomClipKey(gd, d), gd);\n  });\n  var yColumn = tableControlView.selectAll('.' + c.cn.yColumn).data(function (vm) {\n    return vm.columns;\n  }, gup.keyFun);\n  yColumn.enter().append('g').classed(c.cn.yColumn, true);\n  yColumn.exit().remove();\n  yColumn.attr('transform', function (d) {\n    return strTranslate(d.x, 0);\n  });\n  if (dynamic) {\n    yColumn.call(d3.behavior.drag().origin(function (d) {\n      var movedColumn = d3.select(this);\n      easeColumn(movedColumn, d, -c.uplift);\n      raiseToTop(this);\n      d.calcdata.columnDragInProgress = true;\n      renderScrollbarKit(tableControlView.filter(function (dd) {\n        return d.calcdata.key === dd.key;\n      }), gd);\n      return d;\n    }).on('drag', function (d) {\n      var movedColumn = d3.select(this);\n      var getter = function (dd) {\n        return (d === dd ? d3.event.x : dd.x) + dd.columnWidth / 2;\n      };\n      d.x = Math.max(-c.overdrag, Math.min(d.calcdata.width + c.overdrag - d.columnWidth, d3.event.x));\n      var sortableColumns = flatData(yColumn).filter(function (dd) {\n        return dd.calcdata.key === d.calcdata.key;\n      });\n      var newOrder = sortableColumns.sort(function (a, b) {\n        return getter(a) - getter(b);\n      });\n      newOrder.forEach(function (dd, i) {\n        dd.xIndex = i;\n        dd.x = d === dd ? dd.x : dd.xScale(dd);\n      });\n      yColumn.filter(function (dd) {\n        return d !== dd;\n      }).transition().ease(c.transitionEase).duration(c.transitionDuration).attr('transform', function (d) {\n        return strTranslate(d.x, 0);\n      });\n      movedColumn.call(cancelEeaseColumn).attr('transform', strTranslate(d.x, -c.uplift));\n    }).on('dragend', function (d) {\n      var movedColumn = d3.select(this);\n      var p = d.calcdata;\n      d.x = d.xScale(d);\n      d.calcdata.columnDragInProgress = false;\n      easeColumn(movedColumn, d, 0);\n      columnMoved(gd, p, p.columns.map(function (dd) {\n        return dd.xIndex;\n      }));\n    }));\n  }\n  yColumn.each(function (d) {\n    Drawing.setClipUrl(d3.select(this), columnBoundaryClipKey(gd, d), gd);\n  });\n  var columnBlock = yColumn.selectAll('.' + c.cn.columnBlock).data(splitData.splitToPanels, gup.keyFun);\n  columnBlock.enter().append('g').classed(c.cn.columnBlock, true).attr('id', function (d) {\n    return d.key;\n  });\n  columnBlock.style('cursor', function (d) {\n    return d.dragHandle ? 'ew-resize' : d.calcdata.scrollbarState.barWiggleRoom ? 'ns-resize' : 'default';\n  });\n  var headerColumnBlock = columnBlock.filter(headerBlock);\n  var cellsColumnBlock = columnBlock.filter(cellsBlock);\n  if (dynamic) {\n    cellsColumnBlock.call(d3.behavior.drag().origin(function (d) {\n      d3.event.stopPropagation();\n      return d;\n    }).on('drag', makeDragRow(gd, tableControlView, -1)).on('dragend', function () {\n      // fixme emit plotly notification\n    }));\n  }\n\n  // initial rendering: header is rendered first, as it may may have async LaTeX (show header first)\n  // but blocks are _entered_ the way they are due to painter's algo (header on top)\n  renderColumnCellTree(gd, tableControlView, headerColumnBlock, columnBlock);\n  renderColumnCellTree(gd, tableControlView, cellsColumnBlock, columnBlock);\n  var scrollAreaClip = tableControlView.selectAll('.' + c.cn.scrollAreaClip).data(gup.repeat, gup.keyFun);\n  scrollAreaClip.enter().append('clipPath').classed(c.cn.scrollAreaClip, true).attr('id', function (d) {\n    return scrollAreaBottomClipKey(gd, d);\n  });\n  var scrollAreaClipRect = scrollAreaClip.selectAll('.' + c.cn.scrollAreaClipRect).data(gup.repeat, gup.keyFun);\n  scrollAreaClipRect.enter().append('rect').classed(c.cn.scrollAreaClipRect, true).attr('x', -c.overdrag).attr('y', -c.uplift).attr('fill', 'none');\n  scrollAreaClipRect.attr('width', function (d) {\n    return d.width + 2 * c.overdrag;\n  }).attr('height', function (d) {\n    return d.height + c.uplift;\n  });\n  var columnBoundary = yColumn.selectAll('.' + c.cn.columnBoundary).data(gup.repeat, gup.keyFun);\n  columnBoundary.enter().append('g').classed(c.cn.columnBoundary, true);\n  var columnBoundaryClippath = yColumn.selectAll('.' + c.cn.columnBoundaryClippath).data(gup.repeat, gup.keyFun);\n\n  // SVG spec doesn't mandate wrapping into a <defs> and doesn't seem to cause a speed difference\n  columnBoundaryClippath.enter().append('clipPath').classed(c.cn.columnBoundaryClippath, true);\n  columnBoundaryClippath.attr('id', function (d) {\n    return columnBoundaryClipKey(gd, d);\n  });\n  var columnBoundaryRect = columnBoundaryClippath.selectAll('.' + c.cn.columnBoundaryRect).data(gup.repeat, gup.keyFun);\n  columnBoundaryRect.enter().append('rect').classed(c.cn.columnBoundaryRect, true).attr('fill', 'none');\n  columnBoundaryRect.attr('width', function (d) {\n    return d.columnWidth + 2 * roundHalfWidth(d);\n  }).attr('height', function (d) {\n    return d.calcdata.height + 2 * roundHalfWidth(d) + c.uplift;\n  }).attr('x', function (d) {\n    return -roundHalfWidth(d);\n  }).attr('y', function (d) {\n    return -roundHalfWidth(d);\n  });\n  updateBlockYPosition(null, cellsColumnBlock, tableControlView);\n};\nfunction roundHalfWidth(d) {\n  return Math.ceil(d.calcdata.maxLineWidth / 2);\n}\nfunction scrollAreaBottomClipKey(gd, d) {\n  return 'clip' + gd._fullLayout._uid + '_scrollAreaBottomClip_' + d.key;\n}\nfunction columnBoundaryClipKey(gd, d) {\n  return 'clip' + gd._fullLayout._uid + '_columnBoundaryClippath_' + d.calcdata.key + '_' + d.specIndex;\n}\nfunction flatData(selection) {\n  return [].concat.apply([], selection.map(function (g) {\n    return g;\n  })).map(function (g) {\n    return g.__data__;\n  });\n}\nfunction renderScrollbarKit(tableControlView, gd, bypassVisibleBar) {\n  function calcTotalHeight(d) {\n    var blocks = d.rowBlocks;\n    return firstRowAnchor(blocks, blocks.length - 1) + (blocks.length ? rowsHeight(blocks[blocks.length - 1], Infinity) : 1);\n  }\n  var scrollbarKit = tableControlView.selectAll('.' + c.cn.scrollbarKit).data(gup.repeat, gup.keyFun);\n  scrollbarKit.enter().append('g').classed(c.cn.scrollbarKit, true).style('shape-rendering', 'geometricPrecision');\n  scrollbarKit.each(function (d) {\n    var s = d.scrollbarState;\n    s.totalHeight = calcTotalHeight(d);\n    s.scrollableAreaHeight = d.groupHeight - headerHeight(d);\n    s.currentlyVisibleHeight = Math.min(s.totalHeight, s.scrollableAreaHeight);\n    s.ratio = s.currentlyVisibleHeight / s.totalHeight;\n    s.barLength = Math.max(s.ratio * s.currentlyVisibleHeight, c.goldenRatio * c.scrollbarWidth);\n    s.barWiggleRoom = s.currentlyVisibleHeight - s.barLength;\n    s.wiggleRoom = Math.max(0, s.totalHeight - s.scrollableAreaHeight);\n    s.topY = s.barWiggleRoom === 0 ? 0 : d.scrollY / s.wiggleRoom * s.barWiggleRoom;\n    s.bottomY = s.topY + s.barLength;\n    s.dragMultiplier = s.wiggleRoom / s.barWiggleRoom;\n  }).attr('transform', function (d) {\n    var xPosition = d.width + c.scrollbarWidth / 2 + c.scrollbarOffset;\n    return strTranslate(xPosition, headerHeight(d));\n  });\n  var scrollbar = scrollbarKit.selectAll('.' + c.cn.scrollbar).data(gup.repeat, gup.keyFun);\n  scrollbar.enter().append('g').classed(c.cn.scrollbar, true);\n  var scrollbarSlider = scrollbar.selectAll('.' + c.cn.scrollbarSlider).data(gup.repeat, gup.keyFun);\n  scrollbarSlider.enter().append('g').classed(c.cn.scrollbarSlider, true);\n  scrollbarSlider.attr('transform', function (d) {\n    return strTranslate(0, d.scrollbarState.topY || 0);\n  });\n  var scrollbarGlyph = scrollbarSlider.selectAll('.' + c.cn.scrollbarGlyph).data(gup.repeat, gup.keyFun);\n  scrollbarGlyph.enter().append('line').classed(c.cn.scrollbarGlyph, true).attr('stroke', 'black').attr('stroke-width', c.scrollbarWidth).attr('stroke-linecap', 'round').attr('y1', c.scrollbarWidth / 2);\n  scrollbarGlyph.attr('y2', function (d) {\n    return d.scrollbarState.barLength - c.scrollbarWidth / 2;\n  }).attr('stroke-opacity', function (d) {\n    return d.columnDragInProgress || !d.scrollbarState.barWiggleRoom || bypassVisibleBar ? 0 : 0.4;\n  });\n\n  // cancel transition: possible pending (also, delayed) transition\n  scrollbarGlyph.transition().delay(0).duration(0);\n  scrollbarGlyph.transition().delay(c.scrollbarHideDelay).duration(c.scrollbarHideDuration).attr('stroke-opacity', 0);\n  var scrollbarCaptureZone = scrollbar.selectAll('.' + c.cn.scrollbarCaptureZone).data(gup.repeat, gup.keyFun);\n  scrollbarCaptureZone.enter().append('line').classed(c.cn.scrollbarCaptureZone, true).attr('stroke', 'white').attr('stroke-opacity', 0.01) // some browser might get rid of a 0 opacity element\n  .attr('stroke-width', c.scrollbarCaptureWidth).attr('stroke-linecap', 'butt').attr('y1', 0).on('mousedown', function (d) {\n    var y = d3.event.y;\n    var bbox = this.getBoundingClientRect();\n    var s = d.scrollbarState;\n    var pixelVal = y - bbox.top;\n    var inverseScale = d3.scale.linear().domain([0, s.scrollableAreaHeight]).range([0, s.totalHeight]).clamp(true);\n    if (!(s.topY <= pixelVal && pixelVal <= s.bottomY)) {\n      makeDragRow(gd, tableControlView, null, inverseScale(pixelVal - s.barLength / 2))(d);\n    }\n  }).call(d3.behavior.drag().origin(function (d) {\n    d3.event.stopPropagation();\n    d.scrollbarState.scrollbarScrollInProgress = true;\n    return d;\n  }).on('drag', makeDragRow(gd, tableControlView)).on('dragend', function () {\n    // fixme emit Plotly event\n  }));\n  scrollbarCaptureZone.attr('y2', function (d) {\n    return d.scrollbarState.scrollableAreaHeight;\n  });\n\n  // Remove scroll glyph and capture zone on static plots\n  // as they don't render properly when converted to PDF\n  // in the Chrome PDF viewer\n  // https://github.com/plotly/streambed/issues/11618\n  if (gd._context.staticPlot) {\n    scrollbarGlyph.remove();\n    scrollbarCaptureZone.remove();\n  }\n}\nfunction renderColumnCellTree(gd, tableControlView, columnBlock, allColumnBlock) {\n  // fixme this perf hotspot\n  // this is performance critical code as scrolling calls it on every revolver switch\n  // it appears sufficiently fast but there are plenty of low-hanging fruits for performance optimization\n\n  var columnCells = renderColumnCells(columnBlock);\n  var columnCell = renderColumnCell(columnCells);\n  supplyStylingValues(columnCell);\n  var cellRect = renderCellRect(columnCell);\n  sizeAndStyleRect(cellRect);\n  var cellTextHolder = renderCellTextHolder(columnCell);\n  var cellText = renderCellText(cellTextHolder);\n  setFont(cellText);\n  populateCellText(cellText, tableControlView, allColumnBlock, gd);\n\n  // doing this at the end when text, and text stlying are set\n  setCellHeightAndPositionY(columnCell);\n}\nfunction renderColumnCells(columnBlock) {\n  var columnCells = columnBlock.selectAll('.' + c.cn.columnCells).data(gup.repeat, gup.keyFun);\n  columnCells.enter().append('g').classed(c.cn.columnCells, true);\n  columnCells.exit().remove();\n  return columnCells;\n}\nfunction renderColumnCell(columnCells) {\n  var columnCell = columnCells.selectAll('.' + c.cn.columnCell).data(splitData.splitToCells, function (d) {\n    return d.keyWithinBlock;\n  });\n  columnCell.enter().append('g').classed(c.cn.columnCell, true);\n  columnCell.exit().remove();\n  return columnCell;\n}\nfunction renderCellRect(columnCell) {\n  var cellRect = columnCell.selectAll('.' + c.cn.cellRect).data(gup.repeat, function (d) {\n    return d.keyWithinBlock;\n  });\n  cellRect.enter().append('rect').classed(c.cn.cellRect, true);\n  return cellRect;\n}\nfunction renderCellText(cellTextHolder) {\n  var cellText = cellTextHolder.selectAll('.' + c.cn.cellText).data(gup.repeat, function (d) {\n    return d.keyWithinBlock;\n  });\n  cellText.enter().append('text').classed(c.cn.cellText, true).style('cursor', function () {\n    return 'auto';\n  }).on('mousedown', function () {\n    d3.event.stopPropagation();\n  });\n  return cellText;\n}\nfunction renderCellTextHolder(columnCell) {\n  var cellTextHolder = columnCell.selectAll('.' + c.cn.cellTextHolder).data(gup.repeat, function (d) {\n    return d.keyWithinBlock;\n  });\n  cellTextHolder.enter().append('g').classed(c.cn.cellTextHolder, true).style('shape-rendering', 'geometricPrecision');\n  return cellTextHolder;\n}\nfunction supplyStylingValues(columnCell) {\n  columnCell.each(function (d, i) {\n    var spec = d.calcdata.cells.font;\n    var col = d.column.specIndex;\n    var font = {\n      size: gridPick(spec.size, col, i),\n      color: gridPick(spec.color, col, i),\n      family: gridPick(spec.family, col, i),\n      weight: gridPick(spec.weight, col, i),\n      style: gridPick(spec.style, col, i),\n      variant: gridPick(spec.variant, col, i),\n      textcase: gridPick(spec.textcase, col, i),\n      lineposition: gridPick(spec.lineposition, col, i),\n      shadow: gridPick(spec.shadow, col, i)\n    };\n    d.rowNumber = d.key;\n    d.align = gridPick(d.calcdata.cells.align, col, i);\n    d.cellBorderWidth = gridPick(d.calcdata.cells.line.width, col, i);\n    d.font = font;\n  });\n}\nfunction setFont(cellText) {\n  cellText.each(function (d) {\n    Drawing.font(d3.select(this), d.font);\n  });\n}\nfunction sizeAndStyleRect(cellRect) {\n  cellRect.attr('width', function (d) {\n    return d.column.columnWidth;\n  }).attr('stroke-width', function (d) {\n    return d.cellBorderWidth;\n  }).each(function (d) {\n    var atomicSelection = d3.select(this);\n    Color.stroke(atomicSelection, gridPick(d.calcdata.cells.line.color, d.column.specIndex, d.rowNumber));\n    Color.fill(atomicSelection, gridPick(d.calcdata.cells.fill.color, d.column.specIndex, d.rowNumber));\n  });\n}\nfunction populateCellText(cellText, tableControlView, allColumnBlock, gd) {\n  cellText.text(function (d) {\n    var col = d.column.specIndex;\n    var row = d.rowNumber;\n    var userSuppliedContent = d.value;\n    var stringSupplied = typeof userSuppliedContent === 'string';\n    var hasBreaks = stringSupplied && userSuppliedContent.match(/<br>/i);\n    var userBrokenText = !stringSupplied || hasBreaks;\n    d.mayHaveMarkup = stringSupplied && userSuppliedContent.match(/[<&>]/);\n    var latex = isLatex(userSuppliedContent);\n    d.latex = latex;\n    var prefix = latex ? '' : gridPick(d.calcdata.cells.prefix, col, row) || '';\n    var suffix = latex ? '' : gridPick(d.calcdata.cells.suffix, col, row) || '';\n    var format = latex ? null : gridPick(d.calcdata.cells.format, col, row) || null;\n    var prefixSuffixedText = prefix + (format ? numberFormat(format)(d.value) : d.value) + suffix;\n    var hasWrapSplitCharacter;\n    d.wrappingNeeded = !d.wrapped && !userBrokenText && !latex && (hasWrapSplitCharacter = hasWrapCharacter(prefixSuffixedText));\n    d.cellHeightMayIncrease = hasBreaks || latex || d.mayHaveMarkup || (hasWrapSplitCharacter === void 0 ? hasWrapCharacter(prefixSuffixedText) : hasWrapSplitCharacter);\n    d.needsConvertToTspans = d.mayHaveMarkup || d.wrappingNeeded || d.latex;\n    var textToRender;\n    if (d.wrappingNeeded) {\n      var hrefPreservedText = c.wrapSplitCharacter === ' ' ? prefixSuffixedText.replace(/<a href=/ig, '<a_href=') : prefixSuffixedText;\n      var fragments = hrefPreservedText.split(c.wrapSplitCharacter);\n      var hrefRestoredFragments = c.wrapSplitCharacter === ' ' ? fragments.map(function (frag) {\n        return frag.replace(/<a_href=/ig, '<a href=');\n      }) : fragments;\n      d.fragments = hrefRestoredFragments.map(function (f) {\n        return {\n          text: f,\n          width: null\n        };\n      });\n      d.fragments.push({\n        fragment: c.wrapSpacer,\n        width: null\n      });\n      textToRender = hrefRestoredFragments.join(c.lineBreaker) + c.lineBreaker + c.wrapSpacer;\n    } else {\n      delete d.fragments;\n      textToRender = prefixSuffixedText;\n    }\n    return textToRender;\n  }).attr('dy', function (d) {\n    return d.needsConvertToTspans ? 0 : '0.75em';\n  }).each(function (d) {\n    var element = this;\n    var selection = d3.select(element);\n\n    // finalize what's in the DOM\n\n    var renderCallback = d.wrappingNeeded ? wrapTextMaker : updateYPositionMaker;\n    if (d.needsConvertToTspans) {\n      svgUtil.convertToTspans(selection, gd, renderCallback(allColumnBlock, element, tableControlView, gd, d));\n    } else {\n      d3.select(element.parentNode)\n      // basic cell adjustment - compliance with `cellPad`\n      .attr('transform', function (d) {\n        return strTranslate(xPosition(d), c.cellPad);\n      }).attr('text-anchor', function (d) {\n        return {\n          left: 'start',\n          center: 'middle',\n          right: 'end'\n        }[d.align];\n      });\n    }\n  });\n}\nfunction isLatex(content) {\n  return typeof content === 'string' && content.match(c.latexCheck);\n}\nfunction hasWrapCharacter(text) {\n  return text.indexOf(c.wrapSplitCharacter) !== -1;\n}\nfunction columnMoved(gd, calcdata, indices) {\n  var o = calcdata.gdColumnsOriginalOrder;\n  calcdata.gdColumns.sort(function (a, b) {\n    return indices[o.indexOf(a)] - indices[o.indexOf(b)];\n  });\n  calcdata.columnorder = indices;\n\n  // TODO: there's no data here, but also this reordering is not reflected\n  // in gd.data or even gd._fullData.\n  // For now I will not attempt to persist this in _preGUI\n  gd.emit('plotly_restyle');\n}\nfunction gridPick(spec, col, row) {\n  if (Lib.isArrayOrTypedArray(spec)) {\n    var column = spec[Math.min(col, spec.length - 1)];\n    if (Lib.isArrayOrTypedArray(column)) {\n      return column[Math.min(row, column.length - 1)];\n    } else {\n      return column;\n    }\n  } else {\n    return spec;\n  }\n}\nfunction easeColumn(selection, d, y) {\n  selection.transition().ease(c.releaseTransitionEase).duration(c.releaseTransitionDuration).attr('transform', strTranslate(d.x, y));\n}\nfunction cellsBlock(d) {\n  return d.type === 'cells';\n}\nfunction headerBlock(d) {\n  return d.type === 'header';\n}\n\n/**\n * Revolver panel and cell contents layouting\n */\n\nfunction headerHeight(d) {\n  var headerBlocks = d.rowBlocks.length ? d.rowBlocks[0].auxiliaryBlocks : [];\n  return headerBlocks.reduce(function (p, n) {\n    return p + rowsHeight(n, Infinity);\n  }, 0);\n}\nfunction findPagesAndCacheHeights(blocks, scrollY, scrollHeight) {\n  var pages = [];\n  var pTop = 0;\n  for (var blockIndex = 0; blockIndex < blocks.length; blockIndex++) {\n    var block = blocks[blockIndex];\n    var blockRows = block.rows;\n    var rowsHeight = 0;\n    for (var i = 0; i < blockRows.length; i++) {\n      rowsHeight += blockRows[i].rowHeight;\n    }\n\n    // caching allRowsHeight on the block - it's safe as this function is always called from within the code part\n    // that handles increases to row heights\n    block.allRowsHeight = rowsHeight;\n    var pBottom = pTop + rowsHeight;\n    var windowTop = scrollY;\n    var windowBottom = windowTop + scrollHeight;\n    if (windowTop < pBottom && windowBottom > pTop) {\n      pages.push(blockIndex);\n    }\n    pTop += rowsHeight;\n\n    // consider this nice final optimization; put it in `for` condition - caveat, currently the\n    // block.allRowsHeight relies on being invalidated, so enabling this opt may not be safe\n    // if(pages.length > 1) break;\n  }\n  return pages;\n}\nfunction updateBlockYPosition(gd, cellsColumnBlock, tableControlView) {\n  var d = flatData(cellsColumnBlock)[0];\n  if (d === undefined) return;\n  var blocks = d.rowBlocks;\n  var calcdata = d.calcdata;\n  var bottom = firstRowAnchor(blocks, blocks.length);\n  var scrollHeight = d.calcdata.groupHeight - headerHeight(d);\n  var scrollY = calcdata.scrollY = Math.max(0, Math.min(bottom - scrollHeight, calcdata.scrollY));\n  var pages = findPagesAndCacheHeights(blocks, scrollY, scrollHeight);\n  if (pages.length === 1) {\n    if (pages[0] === blocks.length - 1) {\n      pages.unshift(pages[0] - 1);\n    } else {\n      pages.push(pages[0] + 1);\n    }\n  }\n\n  // make phased out page jump by 2 while leaving stationary page intact\n  if (pages[0] % 2) {\n    pages.reverse();\n  }\n  cellsColumnBlock.each(function (d, i) {\n    // these values will also be needed when a block is translated again due to growing cell height\n    d.page = pages[i];\n    d.scrollY = scrollY;\n  });\n  cellsColumnBlock.attr('transform', function (d) {\n    var yTranslate = firstRowAnchor(d.rowBlocks, d.page) - d.scrollY;\n    return strTranslate(0, yTranslate);\n  });\n\n  // conditionally rerendering panel 0 and 1\n  if (gd) {\n    conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, d.prevPages, d, 0);\n    conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, d.prevPages, d, 1);\n    renderScrollbarKit(tableControlView, gd);\n  }\n}\nfunction makeDragRow(gd, allTableControlView, optionalMultiplier, optionalPosition) {\n  return function dragRow(eventD) {\n    // may come from whichever DOM event target: drag, wheel, bar... eventD corresponds to event target\n    var d = eventD.calcdata ? eventD.calcdata : eventD;\n    var tableControlView = allTableControlView.filter(function (dd) {\n      return d.key === dd.key;\n    });\n    var multiplier = optionalMultiplier || d.scrollbarState.dragMultiplier;\n    var initialScrollY = d.scrollY;\n    d.scrollY = optionalPosition === void 0 ? d.scrollY + multiplier * d3.event.dy : optionalPosition;\n    var cellsColumnBlock = tableControlView.selectAll('.' + c.cn.yColumn).selectAll('.' + c.cn.columnBlock).filter(cellsBlock);\n    updateBlockYPosition(gd, cellsColumnBlock, tableControlView);\n\n    // return false if we've \"used\" the scroll, ie it did something,\n    // so the event shouldn't bubble (if appropriate)\n    return d.scrollY === initialScrollY;\n  };\n}\nfunction conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, prevPages, d, revolverIndex) {\n  var shouldComponentUpdate = pages[revolverIndex] !== prevPages[revolverIndex];\n  if (shouldComponentUpdate) {\n    clearTimeout(d.currentRepaint[revolverIndex]);\n    d.currentRepaint[revolverIndex] = setTimeout(function () {\n      // setTimeout might lag rendering but yields a smoother scroll, because fast scrolling makes\n      // some repaints invisible ie. wasteful (DOM work blocks the main thread)\n      var toRerender = cellsColumnBlock.filter(function (d, i) {\n        return i === revolverIndex && pages[i] !== prevPages[i];\n      });\n      renderColumnCellTree(gd, tableControlView, toRerender, cellsColumnBlock);\n      prevPages[revolverIndex] = pages[revolverIndex];\n    });\n  }\n}\nfunction wrapTextMaker(columnBlock, element, tableControlView, gd) {\n  return function wrapText() {\n    var cellTextHolder = d3.select(element.parentNode);\n    cellTextHolder.each(function (d) {\n      var fragments = d.fragments;\n      cellTextHolder.selectAll('tspan.line').each(function (dd, i) {\n        fragments[i].width = this.getComputedTextLength();\n      });\n      // last element is only for measuring the separator character, so it's ignored:\n      var separatorLength = fragments[fragments.length - 1].width;\n      var rest = fragments.slice(0, -1);\n      var currentRow = [];\n      var currentAddition, currentAdditionLength;\n      var currentRowLength = 0;\n      var rowLengthLimit = d.column.columnWidth - 2 * c.cellPad;\n      d.value = '';\n      while (rest.length) {\n        currentAddition = rest.shift();\n        currentAdditionLength = currentAddition.width + separatorLength;\n        if (currentRowLength + currentAdditionLength > rowLengthLimit) {\n          d.value += currentRow.join(c.wrapSpacer) + c.lineBreaker;\n          currentRow = [];\n          currentRowLength = 0;\n        }\n        currentRow.push(currentAddition.text);\n        currentRowLength += currentAdditionLength;\n      }\n      if (currentRowLength) {\n        d.value += currentRow.join(c.wrapSpacer);\n      }\n      d.wrapped = true;\n    });\n\n    // the pre-wrapped text was rendered only for the text measurements\n    cellTextHolder.selectAll('tspan.line').remove();\n\n    // resupply text, now wrapped\n    populateCellText(cellTextHolder.select('.' + c.cn.cellText), tableControlView, columnBlock, gd);\n    d3.select(element.parentNode.parentNode).call(setCellHeightAndPositionY);\n  };\n}\nfunction updateYPositionMaker(columnBlock, element, tableControlView, gd, d) {\n  return function updateYPosition() {\n    if (d.settledY) return;\n    var cellTextHolder = d3.select(element.parentNode);\n    var l = getBlock(d);\n    var rowIndex = d.key - l.firstRowIndex;\n    var declaredRowHeight = l.rows[rowIndex].rowHeight;\n    var requiredHeight = d.cellHeightMayIncrease ? element.parentNode.getBoundingClientRect().height + 2 * c.cellPad : declaredRowHeight;\n    var finalHeight = Math.max(requiredHeight, declaredRowHeight);\n    var increase = finalHeight - l.rows[rowIndex].rowHeight;\n    if (increase) {\n      // current row height increased\n      l.rows[rowIndex].rowHeight = finalHeight;\n      columnBlock.selectAll('.' + c.cn.columnCell).call(setCellHeightAndPositionY);\n      updateBlockYPosition(null, columnBlock.filter(cellsBlock), 0);\n\n      // if d.column.type === 'header', then the scrollbar has to be pushed downward to the scrollable area\n      // if d.column.type === 'cells', it can still be relevant if total scrolling content height is less than the\n      //                               scrollable window, as increases to row heights may need scrollbar updates\n      renderScrollbarKit(tableControlView, gd, true);\n    }\n    cellTextHolder.attr('transform', function () {\n      // this code block is only invoked for items where d.cellHeightMayIncrease is truthy\n      var element = this;\n      var columnCellElement = element.parentNode;\n      var box = columnCellElement.getBoundingClientRect();\n      var rectBox = d3.select(element.parentNode).select('.' + c.cn.cellRect).node().getBoundingClientRect();\n      var currentTransform = element.transform.baseVal.consolidate();\n      var yPosition = rectBox.top - box.top + (currentTransform ? currentTransform.matrix.f : c.cellPad);\n      return strTranslate(xPosition(d, d3.select(element.parentNode).select('.' + c.cn.cellTextHolder).node().getBoundingClientRect().width), yPosition);\n    });\n    d.settledY = true;\n  };\n}\nfunction xPosition(d, optionalWidth) {\n  switch (d.align) {\n    case 'left':\n      return c.cellPad;\n    case 'right':\n      return d.column.columnWidth - (optionalWidth || 0) - c.cellPad;\n    case 'center':\n      return (d.column.columnWidth - (optionalWidth || 0)) / 2;\n    default:\n      return c.cellPad;\n  }\n}\nfunction setCellHeightAndPositionY(columnCell) {\n  columnCell.attr('transform', function (d) {\n    var headerHeight = d.rowBlocks[0].auxiliaryBlocks.reduce(function (p, n) {\n      return p + rowsHeight(n, Infinity);\n    }, 0);\n    var l = getBlock(d);\n    var rowAnchor = rowsHeight(l, d.key);\n    var yOffset = rowAnchor + headerHeight;\n    return strTranslate(0, yOffset);\n  }).selectAll('.' + c.cn.cellRect).attr('height', function (d) {\n    return getRow(getBlock(d), d.key).rowHeight;\n  });\n}\nfunction firstRowAnchor(blocks, page) {\n  var total = 0;\n  for (var i = page - 1; i >= 0; i--) {\n    total += allRowsHeight(blocks[i]);\n  }\n  return total;\n}\nfunction rowsHeight(rowBlock, key) {\n  var total = 0;\n  for (var i = 0; i < rowBlock.rows.length && rowBlock.rows[i].rowIndex < key; i++) {\n    total += rowBlock.rows[i].rowHeight;\n  }\n  return total;\n}\nfunction allRowsHeight(rowBlock) {\n  var cached = rowBlock.allRowsHeight;\n  if (cached !== void 0) {\n    return cached;\n  }\n  var total = 0;\n  for (var i = 0; i < rowBlock.rows.length; i++) {\n    total += rowBlock.rows[i].rowHeight;\n  }\n  rowBlock.allRowsHeight = total;\n  return total;\n}\nfunction getBlock(d) {\n  return d.rowBlocks[d.page];\n}\nfunction getRow(l, i) {\n  return l.rows[i - l.firstRowIndex];\n}","map":{"version":3,"names":["c","require","d3","Lib","numberFormat","gup","Drawing","svgUtil","raiseToTop","strTranslate","cancelEeaseColumn","cancelTransition","prepareData","splitData","Color","module","exports","plot","gd","wrappedTraceHolders","dynamic","_context","staticPlot","table","_fullLayout","_paper","selectAll","cn","data","map","wrappedTraceHolder","traceHolder","unwrap","trace","keyFun","exit","remove","enter","append","classed","attr","style","d","width","size","l","r","height","t","b","translateX","translateY","tableControlView","repeat","cvEnter","wheelEvent","document","on","filter","dd","call","renderScrollbarKit","scrollbarState","wheeling","newY","scrollY","event","deltaY","noChange","makeDragRow","stopPropagation","preventDefault","scrollBackground","each","setClipUrl","select","scrollAreaBottomClipKey","yColumn","vm","columns","x","behavior","drag","origin","movedColumn","easeColumn","uplift","calcdata","columnDragInProgress","key","getter","columnWidth","Math","max","overdrag","min","sortableColumns","flatData","newOrder","sort","a","forEach","i","xIndex","xScale","transition","ease","transitionEase","duration","transitionDuration","p","columnMoved","columnBoundaryClipKey","columnBlock","splitToPanels","dragHandle","barWiggleRoom","headerColumnBlock","headerBlock","cellsColumnBlock","cellsBlock","renderColumnCellTree","scrollAreaClip","scrollAreaClipRect","columnBoundary","columnBoundaryClippath","columnBoundaryRect","roundHalfWidth","updateBlockYPosition","ceil","maxLineWidth","_uid","specIndex","selection","concat","apply","g","__data__","bypassVisibleBar","calcTotalHeight","blocks","rowBlocks","firstRowAnchor","length","rowsHeight","Infinity","scrollbarKit","s","totalHeight","scrollableAreaHeight","groupHeight","headerHeight","currentlyVisibleHeight","ratio","barLength","goldenRatio","scrollbarWidth","wiggleRoom","topY","bottomY","dragMultiplier","xPosition","scrollbarOffset","scrollbar","scrollbarSlider","scrollbarGlyph","delay","scrollbarHideDelay","scrollbarHideDuration","scrollbarCaptureZone","scrollbarCaptureWidth","y","bbox","getBoundingClientRect","pixelVal","top","inverseScale","scale","linear","domain","range","clamp","scrollbarScrollInProgress","allColumnBlock","columnCells","renderColumnCells","columnCell","renderColumnCell","supplyStylingValues","cellRect","renderCellRect","sizeAndStyleRect","cellTextHolder","renderCellTextHolder","cellText","renderCellText","setFont","populateCellText","setCellHeightAndPositionY","splitToCells","keyWithinBlock","spec","cells","font","col","column","gridPick","color","family","weight","variant","textcase","lineposition","shadow","rowNumber","align","cellBorderWidth","line","atomicSelection","stroke","fill","text","row","userSuppliedContent","value","stringSupplied","hasBreaks","match","userBrokenText","mayHaveMarkup","latex","isLatex","prefix","suffix","format","prefixSuffixedText","hasWrapSplitCharacter","wrappingNeeded","wrapped","hasWrapCharacter","cellHeightMayIncrease","needsConvertToTspans","textToRender","hrefPreservedText","wrapSplitCharacter","replace","fragments","split","hrefRestoredFragments","frag","f","push","fragment","wrapSpacer","join","lineBreaker","element","renderCallback","wrapTextMaker","updateYPositionMaker","convertToTspans","parentNode","cellPad","left","center","right","content","latexCheck","indexOf","indices","o","gdColumnsOriginalOrder","gdColumns","columnorder","emit","isArrayOrTypedArray","releaseTransitionEase","releaseTransitionDuration","type","headerBlocks","auxiliaryBlocks","reduce","n","findPagesAndCacheHeights","scrollHeight","pages","pTop","blockIndex","block","blockRows","rows","rowHeight","allRowsHeight","pBottom","windowTop","windowBottom","undefined","bottom","unshift","reverse","page","yTranslate","conditionalPanelRerender","prevPages","allTableControlView","optionalMultiplier","optionalPosition","dragRow","eventD","multiplier","initialScrollY","dy","revolverIndex","shouldComponentUpdate","clearTimeout","currentRepaint","setTimeout","toRerender","wrapText","getComputedTextLength","separatorLength","rest","slice","currentRow","currentAddition","currentAdditionLength","currentRowLength","rowLengthLimit","shift","updateYPosition","settledY","getBlock","rowIndex","firstRowIndex","declaredRowHeight","requiredHeight","finalHeight","increase","columnCellElement","box","rectBox","node","currentTransform","transform","baseVal","consolidate","yPosition","matrix","optionalWidth","rowAnchor","yOffset","getRow","total","rowBlock","cached"],"sources":["E:/tog_workspace/TestFabric_main/TestFabric-main/node_modules/plotly.js/src/traces/table/plot.js"],"sourcesContent":["'use strict';\n\nvar c = require('./constants');\nvar d3 = require('@plotly/d3');\nvar Lib = require('../../lib');\nvar numberFormat = Lib.numberFormat;\nvar gup = require('../../lib/gup');\nvar Drawing = require('../../components/drawing');\nvar svgUtil = require('../../lib/svg_text_utils');\nvar raiseToTop = require('../../lib').raiseToTop;\nvar strTranslate = require('../../lib').strTranslate;\nvar cancelEeaseColumn = require('../../lib').cancelTransition;\nvar prepareData = require('./data_preparation_helper');\nvar splitData = require('./data_split_helpers');\nvar Color = require('../../components/color');\n\nmodule.exports = function plot(gd, wrappedTraceHolders) {\n    var dynamic = !gd._context.staticPlot;\n\n    var table = gd._fullLayout._paper.selectAll('.' + c.cn.table)\n        .data(wrappedTraceHolders.map(function(wrappedTraceHolder) {\n            var traceHolder = gup.unwrap(wrappedTraceHolder);\n            var trace = traceHolder.trace;\n            return prepareData(gd, trace);\n        }), gup.keyFun);\n\n    table.exit().remove();\n\n    table.enter()\n        .append('g')\n        .classed(c.cn.table, true)\n        .attr('overflow', 'visible')\n        .style('box-sizing', 'content-box')\n        .style('position', 'absolute')\n        .style('left', 0)\n        .style('overflow', 'visible')\n        .style('shape-rendering', 'crispEdges')\n        .style('pointer-events', 'all');\n\n    table\n        .attr('width', function(d) {return d.width + d.size.l + d.size.r;})\n        .attr('height', function(d) {return d.height + d.size.t + d.size.b;})\n        .attr('transform', function(d) {\n            return strTranslate(d.translateX, d.translateY);\n        });\n\n    var tableControlView = table.selectAll('.' + c.cn.tableControlView)\n        .data(gup.repeat, gup.keyFun);\n\n    var cvEnter = tableControlView.enter()\n        .append('g')\n        .classed(c.cn.tableControlView, true)\n        .style('box-sizing', 'content-box');\n    if(dynamic) {\n        var wheelEvent = 'onwheel' in document ? 'wheel' : 'mousewheel';\n        cvEnter\n            .on('mousemove', function(d) {\n                tableControlView\n                    .filter(function(dd) {return d === dd;})\n                    .call(renderScrollbarKit, gd);\n            })\n            .on(wheelEvent, function(d) {\n                if(d.scrollbarState.wheeling) return;\n                d.scrollbarState.wheeling = true;\n                var newY = d.scrollY + d3.event.deltaY;\n                var noChange = makeDragRow(gd, tableControlView, null, newY)(d);\n                if(!noChange) {\n                    d3.event.stopPropagation();\n                    d3.event.preventDefault();\n                }\n                d.scrollbarState.wheeling = false;\n            })\n            .call(renderScrollbarKit, gd, true);\n    }\n\n    tableControlView\n        .attr('transform', function(d) {return strTranslate(d.size.l, d.size.t);});\n\n    // scrollBackground merely ensures that mouse events are captured even on crazy fast scrollwheeling\n    // otherwise rendering glitches may occur\n    var scrollBackground = tableControlView.selectAll('.' + c.cn.scrollBackground)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollBackground.enter()\n        .append('rect')\n        .classed(c.cn.scrollBackground, true)\n        .attr('fill', 'none');\n\n    scrollBackground\n        .attr('width', function(d) {return d.width;})\n        .attr('height', function(d) {return d.height;});\n\n    tableControlView.each(function(d) {\n        Drawing.setClipUrl(d3.select(this), scrollAreaBottomClipKey(gd, d), gd);\n    });\n\n    var yColumn = tableControlView.selectAll('.' + c.cn.yColumn)\n        .data(function(vm) {return vm.columns;}, gup.keyFun);\n\n    yColumn.enter()\n        .append('g')\n        .classed(c.cn.yColumn, true);\n\n    yColumn.exit().remove();\n\n    yColumn.attr('transform', function(d) {return strTranslate(d.x, 0);});\n\n    if(dynamic) {\n        yColumn.call(d3.behavior.drag()\n            .origin(function(d) {\n                var movedColumn = d3.select(this);\n                easeColumn(movedColumn, d, -c.uplift);\n                raiseToTop(this);\n                d.calcdata.columnDragInProgress = true;\n                renderScrollbarKit(tableControlView.filter(function(dd) {return d.calcdata.key === dd.key;}), gd);\n                return d;\n            })\n            .on('drag', function(d) {\n                var movedColumn = d3.select(this);\n                var getter = function(dd) {return (d === dd ? d3.event.x : dd.x) + dd.columnWidth / 2;};\n                d.x = Math.max(-c.overdrag, Math.min(d.calcdata.width + c.overdrag - d.columnWidth, d3.event.x));\n\n                var sortableColumns = flatData(yColumn).filter(function(dd) {return dd.calcdata.key === d.calcdata.key;});\n                var newOrder = sortableColumns.sort(function(a, b) {return getter(a) - getter(b);});\n                newOrder.forEach(function(dd, i) {\n                    dd.xIndex = i;\n                    dd.x = d === dd ? dd.x : dd.xScale(dd);\n                });\n\n                yColumn.filter(function(dd) {return d !== dd;})\n                    .transition()\n                    .ease(c.transitionEase)\n                    .duration(c.transitionDuration)\n                    .attr('transform', function(d) {return strTranslate(d.x, 0);});\n                movedColumn\n                    .call(cancelEeaseColumn)\n                    .attr('transform', strTranslate(d.x, -c.uplift));\n            })\n            .on('dragend', function(d) {\n                var movedColumn = d3.select(this);\n                var p = d.calcdata;\n                d.x = d.xScale(d);\n                d.calcdata.columnDragInProgress = false;\n                easeColumn(movedColumn, d, 0);\n                columnMoved(gd, p, p.columns.map(function(dd) {return dd.xIndex;}));\n            })\n        );\n    }\n\n    yColumn.each(function(d) {\n        Drawing.setClipUrl(d3.select(this), columnBoundaryClipKey(gd, d), gd);\n    });\n\n    var columnBlock = yColumn.selectAll('.' + c.cn.columnBlock)\n        .data(splitData.splitToPanels, gup.keyFun);\n\n    columnBlock.enter()\n        .append('g')\n        .classed(c.cn.columnBlock, true)\n        .attr('id', function(d) {return d.key;});\n\n    columnBlock\n        .style('cursor', function(d) {\n            return d.dragHandle ? 'ew-resize' : d.calcdata.scrollbarState.barWiggleRoom ? 'ns-resize' : 'default';\n        });\n\n    var headerColumnBlock = columnBlock.filter(headerBlock);\n    var cellsColumnBlock = columnBlock.filter(cellsBlock);\n\n    if(dynamic) {\n        cellsColumnBlock.call(d3.behavior.drag()\n            .origin(function(d) {\n                d3.event.stopPropagation();\n                return d;\n            })\n            .on('drag', makeDragRow(gd, tableControlView, -1))\n            .on('dragend', function() {\n                // fixme emit plotly notification\n            })\n        );\n    }\n\n    // initial rendering: header is rendered first, as it may may have async LaTeX (show header first)\n    // but blocks are _entered_ the way they are due to painter's algo (header on top)\n    renderColumnCellTree(gd, tableControlView, headerColumnBlock, columnBlock);\n    renderColumnCellTree(gd, tableControlView, cellsColumnBlock, columnBlock);\n\n    var scrollAreaClip = tableControlView.selectAll('.' + c.cn.scrollAreaClip)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollAreaClip.enter()\n        .append('clipPath')\n        .classed(c.cn.scrollAreaClip, true)\n        .attr('id', function(d) {return scrollAreaBottomClipKey(gd, d);});\n\n    var scrollAreaClipRect = scrollAreaClip.selectAll('.' + c.cn.scrollAreaClipRect)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollAreaClipRect.enter()\n        .append('rect')\n        .classed(c.cn.scrollAreaClipRect, true)\n        .attr('x', -c.overdrag)\n        .attr('y', -c.uplift)\n        .attr('fill', 'none');\n\n    scrollAreaClipRect\n        .attr('width', function(d) {return d.width + 2 * c.overdrag;})\n        .attr('height', function(d) {return d.height + c.uplift;});\n\n    var columnBoundary = yColumn.selectAll('.' + c.cn.columnBoundary)\n        .data(gup.repeat, gup.keyFun);\n\n    columnBoundary.enter()\n        .append('g')\n        .classed(c.cn.columnBoundary, true);\n\n    var columnBoundaryClippath = yColumn.selectAll('.' + c.cn.columnBoundaryClippath)\n        .data(gup.repeat, gup.keyFun);\n\n    // SVG spec doesn't mandate wrapping into a <defs> and doesn't seem to cause a speed difference\n    columnBoundaryClippath.enter()\n        .append('clipPath')\n        .classed(c.cn.columnBoundaryClippath, true);\n\n    columnBoundaryClippath\n        .attr('id', function(d) {return columnBoundaryClipKey(gd, d);});\n\n    var columnBoundaryRect = columnBoundaryClippath.selectAll('.' + c.cn.columnBoundaryRect)\n        .data(gup.repeat, gup.keyFun);\n\n    columnBoundaryRect.enter()\n        .append('rect')\n        .classed(c.cn.columnBoundaryRect, true)\n        .attr('fill', 'none');\n\n    columnBoundaryRect\n        .attr('width', function(d) { return d.columnWidth + 2 * roundHalfWidth(d); })\n        .attr('height', function(d) {return d.calcdata.height + 2 * roundHalfWidth(d) + c.uplift;})\n        .attr('x', function(d) { return -roundHalfWidth(d); })\n        .attr('y', function(d) { return -roundHalfWidth(d); });\n\n    updateBlockYPosition(null, cellsColumnBlock, tableControlView);\n};\n\nfunction roundHalfWidth(d) {\n    return Math.ceil(d.calcdata.maxLineWidth / 2);\n}\n\nfunction scrollAreaBottomClipKey(gd, d) {\n    return 'clip' + gd._fullLayout._uid + '_scrollAreaBottomClip_' + d.key;\n}\n\nfunction columnBoundaryClipKey(gd, d) {\n    return 'clip' + gd._fullLayout._uid + '_columnBoundaryClippath_' + d.calcdata.key + '_' + d.specIndex;\n}\n\nfunction flatData(selection) {\n    return [].concat.apply([], selection.map(function(g) {return g;}))\n        .map(function(g) {return g.__data__;});\n}\n\nfunction renderScrollbarKit(tableControlView, gd, bypassVisibleBar) {\n    function calcTotalHeight(d) {\n        var blocks = d.rowBlocks;\n        return firstRowAnchor(blocks, blocks.length - 1) + (blocks.length ? rowsHeight(blocks[blocks.length - 1], Infinity) : 1);\n    }\n\n    var scrollbarKit = tableControlView.selectAll('.' + c.cn.scrollbarKit)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbarKit.enter()\n        .append('g')\n        .classed(c.cn.scrollbarKit, true)\n        .style('shape-rendering', 'geometricPrecision');\n\n    scrollbarKit\n        .each(function(d) {\n            var s = d.scrollbarState;\n            s.totalHeight = calcTotalHeight(d);\n            s.scrollableAreaHeight = d.groupHeight - headerHeight(d);\n            s.currentlyVisibleHeight = Math.min(s.totalHeight, s.scrollableAreaHeight);\n            s.ratio = s.currentlyVisibleHeight / s.totalHeight;\n            s.barLength = Math.max(s.ratio * s.currentlyVisibleHeight, c.goldenRatio * c.scrollbarWidth);\n            s.barWiggleRoom = s.currentlyVisibleHeight - s.barLength;\n            s.wiggleRoom = Math.max(0, s.totalHeight - s.scrollableAreaHeight);\n            s.topY = s.barWiggleRoom === 0 ? 0 : (d.scrollY / s.wiggleRoom) * s.barWiggleRoom;\n            s.bottomY = s.topY + s.barLength;\n            s.dragMultiplier = s.wiggleRoom / s.barWiggleRoom;\n        })\n        .attr('transform', function(d) {\n            var xPosition = d.width + c.scrollbarWidth / 2 + c.scrollbarOffset;\n            return strTranslate(xPosition, headerHeight(d));\n        });\n\n    var scrollbar = scrollbarKit.selectAll('.' + c.cn.scrollbar)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbar.enter()\n        .append('g')\n        .classed(c.cn.scrollbar, true);\n\n    var scrollbarSlider = scrollbar.selectAll('.' + c.cn.scrollbarSlider)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbarSlider.enter()\n        .append('g')\n        .classed(c.cn.scrollbarSlider, true);\n\n    scrollbarSlider\n        .attr('transform', function(d) {\n            return strTranslate(0, d.scrollbarState.topY || 0);\n        });\n\n    var scrollbarGlyph = scrollbarSlider.selectAll('.' + c.cn.scrollbarGlyph)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbarGlyph.enter()\n        .append('line')\n        .classed(c.cn.scrollbarGlyph, true)\n        .attr('stroke', 'black')\n        .attr('stroke-width', c.scrollbarWidth)\n        .attr('stroke-linecap', 'round')\n        .attr('y1', c.scrollbarWidth / 2);\n\n    scrollbarGlyph\n        .attr('y2', function(d) {\n            return d.scrollbarState.barLength - c.scrollbarWidth / 2;\n        })\n        .attr('stroke-opacity', function(d) {\n            return d.columnDragInProgress || !d.scrollbarState.barWiggleRoom || bypassVisibleBar ? 0 : 0.4;\n        });\n\n    // cancel transition: possible pending (also, delayed) transition\n    scrollbarGlyph\n        .transition().delay(0).duration(0);\n\n    scrollbarGlyph\n        .transition().delay(c.scrollbarHideDelay).duration(c.scrollbarHideDuration)\n        .attr('stroke-opacity', 0);\n\n    var scrollbarCaptureZone = scrollbar.selectAll('.' + c.cn.scrollbarCaptureZone)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbarCaptureZone.enter()\n        .append('line')\n        .classed(c.cn.scrollbarCaptureZone, true)\n        .attr('stroke', 'white')\n        .attr('stroke-opacity', 0.01) // some browser might get rid of a 0 opacity element\n        .attr('stroke-width', c.scrollbarCaptureWidth)\n        .attr('stroke-linecap', 'butt')\n        .attr('y1', 0)\n        .on('mousedown', function(d) {\n            var y = d3.event.y;\n            var bbox = this.getBoundingClientRect();\n            var s = d.scrollbarState;\n            var pixelVal = y - bbox.top;\n            var inverseScale = d3.scale.linear().domain([0, s.scrollableAreaHeight]).range([0, s.totalHeight]).clamp(true);\n            if(!(s.topY <= pixelVal && pixelVal <= s.bottomY)) {\n                makeDragRow(gd, tableControlView, null, inverseScale(pixelVal - s.barLength / 2))(d);\n            }\n        })\n        .call(d3.behavior.drag()\n            .origin(function(d) {\n                d3.event.stopPropagation();\n                d.scrollbarState.scrollbarScrollInProgress = true;\n                return d;\n            })\n            .on('drag', makeDragRow(gd, tableControlView))\n            .on('dragend', function() {\n                // fixme emit Plotly event\n            })\n        );\n\n    scrollbarCaptureZone\n        .attr('y2', function(d) {\n            return d.scrollbarState.scrollableAreaHeight;\n        });\n\n    // Remove scroll glyph and capture zone on static plots\n    // as they don't render properly when converted to PDF\n    // in the Chrome PDF viewer\n    // https://github.com/plotly/streambed/issues/11618\n    if(gd._context.staticPlot) {\n        scrollbarGlyph.remove();\n        scrollbarCaptureZone.remove();\n    }\n}\n\nfunction renderColumnCellTree(gd, tableControlView, columnBlock, allColumnBlock) {\n    // fixme this perf hotspot\n    // this is performance critical code as scrolling calls it on every revolver switch\n    // it appears sufficiently fast but there are plenty of low-hanging fruits for performance optimization\n\n    var columnCells = renderColumnCells(columnBlock);\n\n    var columnCell = renderColumnCell(columnCells);\n\n    supplyStylingValues(columnCell);\n\n    var cellRect = renderCellRect(columnCell);\n\n    sizeAndStyleRect(cellRect);\n\n    var cellTextHolder = renderCellTextHolder(columnCell);\n\n    var cellText = renderCellText(cellTextHolder);\n\n    setFont(cellText);\n    populateCellText(cellText, tableControlView, allColumnBlock, gd);\n\n    // doing this at the end when text, and text stlying are set\n    setCellHeightAndPositionY(columnCell);\n}\n\nfunction renderColumnCells(columnBlock) {\n    var columnCells = columnBlock.selectAll('.' + c.cn.columnCells)\n        .data(gup.repeat, gup.keyFun);\n\n    columnCells.enter()\n        .append('g')\n        .classed(c.cn.columnCells, true);\n\n    columnCells.exit()\n        .remove();\n\n    return columnCells;\n}\n\nfunction renderColumnCell(columnCells) {\n    var columnCell = columnCells.selectAll('.' + c.cn.columnCell)\n        .data(splitData.splitToCells, function(d) {return d.keyWithinBlock;});\n\n    columnCell.enter()\n        .append('g')\n        .classed(c.cn.columnCell, true);\n\n    columnCell.exit()\n        .remove();\n\n    return columnCell;\n}\n\nfunction renderCellRect(columnCell) {\n    var cellRect = columnCell.selectAll('.' + c.cn.cellRect)\n        .data(gup.repeat, function(d) {return d.keyWithinBlock;});\n\n    cellRect.enter()\n        .append('rect')\n        .classed(c.cn.cellRect, true);\n\n    return cellRect;\n}\n\nfunction renderCellText(cellTextHolder) {\n    var cellText = cellTextHolder.selectAll('.' + c.cn.cellText)\n        .data(gup.repeat, function(d) {return d.keyWithinBlock;});\n\n    cellText.enter()\n        .append('text')\n        .classed(c.cn.cellText, true)\n        .style('cursor', function() {return 'auto';})\n        .on('mousedown', function() {d3.event.stopPropagation();});\n\n    return cellText;\n}\n\nfunction renderCellTextHolder(columnCell) {\n    var cellTextHolder = columnCell.selectAll('.' + c.cn.cellTextHolder)\n        .data(gup.repeat, function(d) {return d.keyWithinBlock;});\n\n    cellTextHolder.enter()\n        .append('g')\n        .classed(c.cn.cellTextHolder, true)\n        .style('shape-rendering', 'geometricPrecision');\n\n    return cellTextHolder;\n}\n\nfunction supplyStylingValues(columnCell) {\n    columnCell\n        .each(function(d, i) {\n            var spec = d.calcdata.cells.font;\n            var col = d.column.specIndex;\n            var font = {\n                size: gridPick(spec.size, col, i),\n                color: gridPick(spec.color, col, i),\n                family: gridPick(spec.family, col, i),\n                weight: gridPick(spec.weight, col, i),\n                style: gridPick(spec.style, col, i),\n                variant: gridPick(spec.variant, col, i),\n                textcase: gridPick(spec.textcase, col, i),\n                lineposition: gridPick(spec.lineposition, col, i),\n                shadow: gridPick(spec.shadow, col, i),\n            };\n            d.rowNumber = d.key;\n            d.align = gridPick(d.calcdata.cells.align, col, i);\n            d.cellBorderWidth = gridPick(d.calcdata.cells.line.width, col, i);\n            d.font = font;\n        });\n}\n\nfunction setFont(cellText) {\n    cellText\n        .each(function(d) {\n            Drawing.font(d3.select(this), d.font);\n        });\n}\n\nfunction sizeAndStyleRect(cellRect) {\n    cellRect\n        .attr('width', function(d) {return d.column.columnWidth;})\n        .attr('stroke-width', function(d) {return d.cellBorderWidth;})\n        .each(function(d) {\n            var atomicSelection = d3.select(this);\n            Color.stroke(atomicSelection, gridPick(d.calcdata.cells.line.color, d.column.specIndex, d.rowNumber));\n            Color.fill(atomicSelection, gridPick(d.calcdata.cells.fill.color, d.column.specIndex, d.rowNumber));\n        });\n}\n\nfunction populateCellText(cellText, tableControlView, allColumnBlock, gd) {\n    cellText\n        .text(function(d) {\n            var col = d.column.specIndex;\n            var row = d.rowNumber;\n\n            var userSuppliedContent = d.value;\n            var stringSupplied = (typeof userSuppliedContent === 'string');\n            var hasBreaks = stringSupplied && userSuppliedContent.match(/<br>/i);\n            var userBrokenText = !stringSupplied || hasBreaks;\n            d.mayHaveMarkup = stringSupplied && userSuppliedContent.match(/[<&>]/);\n\n            var latex = isLatex(userSuppliedContent);\n            d.latex = latex;\n\n            var prefix = latex ? '' : gridPick(d.calcdata.cells.prefix, col, row) || '';\n            var suffix = latex ? '' : gridPick(d.calcdata.cells.suffix, col, row) || '';\n            var format = latex ? null : gridPick(d.calcdata.cells.format, col, row) || null;\n\n            var prefixSuffixedText = prefix + (format ? numberFormat(format)(d.value) : d.value) + suffix;\n\n            var hasWrapSplitCharacter;\n            d.wrappingNeeded = !d.wrapped && !userBrokenText && !latex && (hasWrapSplitCharacter = hasWrapCharacter(prefixSuffixedText));\n            d.cellHeightMayIncrease = hasBreaks || latex || d.mayHaveMarkup || (hasWrapSplitCharacter === void(0) ? hasWrapCharacter(prefixSuffixedText) : hasWrapSplitCharacter);\n            d.needsConvertToTspans = d.mayHaveMarkup || d.wrappingNeeded || d.latex;\n\n            var textToRender;\n            if(d.wrappingNeeded) {\n                var hrefPreservedText = c.wrapSplitCharacter === ' ' ? prefixSuffixedText.replace(/<a href=/ig, '<a_href=') : prefixSuffixedText;\n                var fragments = hrefPreservedText.split(c.wrapSplitCharacter);\n                var hrefRestoredFragments = c.wrapSplitCharacter === ' ' ? fragments.map(function(frag) {return frag.replace(/<a_href=/ig, '<a href=');}) : fragments;\n                d.fragments = hrefRestoredFragments.map(function(f) {return {text: f, width: null};});\n                d.fragments.push({fragment: c.wrapSpacer, width: null});\n                textToRender = hrefRestoredFragments.join(c.lineBreaker) + c.lineBreaker + c.wrapSpacer;\n            } else {\n                delete d.fragments;\n                textToRender = prefixSuffixedText;\n            }\n\n            return textToRender;\n        })\n        .attr('dy', function(d) {\n            return d.needsConvertToTspans ? 0 : '0.75em';\n        })\n        .each(function(d) {\n            var element = this;\n            var selection = d3.select(element);\n\n            // finalize what's in the DOM\n\n            var renderCallback = d.wrappingNeeded ? wrapTextMaker : updateYPositionMaker;\n            if(d.needsConvertToTspans) {\n                svgUtil.convertToTspans(selection, gd, renderCallback(allColumnBlock, element, tableControlView, gd, d));\n            } else {\n                d3.select(element.parentNode)\n                    // basic cell adjustment - compliance with `cellPad`\n                    .attr('transform', function(d) {return strTranslate(xPosition(d), c.cellPad);})\n                    .attr('text-anchor', function(d) {\n                        return ({\n                            left: 'start',\n                            center: 'middle',\n                            right: 'end'\n                        })[d.align];\n                    });\n            }\n        });\n}\n\nfunction isLatex(content) {\n    return typeof content === 'string' && content.match(c.latexCheck);\n}\n\nfunction hasWrapCharacter(text) {return text.indexOf(c.wrapSplitCharacter) !== -1;}\n\nfunction columnMoved(gd, calcdata, indices) {\n    var o = calcdata.gdColumnsOriginalOrder;\n    calcdata.gdColumns.sort(function(a, b) {\n        return indices[o.indexOf(a)] - indices[o.indexOf(b)];\n    });\n\n    calcdata.columnorder = indices;\n\n    // TODO: there's no data here, but also this reordering is not reflected\n    // in gd.data or even gd._fullData.\n    // For now I will not attempt to persist this in _preGUI\n    gd.emit('plotly_restyle');\n}\n\nfunction gridPick(spec, col, row) {\n    if(Lib.isArrayOrTypedArray(spec)) {\n        var column = spec[Math.min(col, spec.length - 1)];\n        if(Lib.isArrayOrTypedArray(column)) {\n            return column[Math.min(row, column.length - 1)];\n        } else {\n            return column;\n        }\n    } else {\n        return spec;\n    }\n}\n\nfunction easeColumn(selection, d, y) {\n    selection\n        .transition()\n        .ease(c.releaseTransitionEase)\n        .duration(c.releaseTransitionDuration)\n        .attr('transform', strTranslate(d.x, y));\n}\n\nfunction cellsBlock(d) {return d.type === 'cells';}\nfunction headerBlock(d) {return d.type === 'header';}\n\n/**\n * Revolver panel and cell contents layouting\n */\n\nfunction headerHeight(d) {\n    var headerBlocks = d.rowBlocks.length ? d.rowBlocks[0].auxiliaryBlocks : [];\n    return headerBlocks.reduce(function(p, n) {return p + rowsHeight(n, Infinity);}, 0);\n}\n\nfunction findPagesAndCacheHeights(blocks, scrollY, scrollHeight) {\n    var pages = [];\n    var pTop = 0;\n\n    for(var blockIndex = 0; blockIndex < blocks.length; blockIndex++) {\n        var block = blocks[blockIndex];\n        var blockRows = block.rows;\n        var rowsHeight = 0;\n        for(var i = 0; i < blockRows.length; i++) {\n            rowsHeight += blockRows[i].rowHeight;\n        }\n\n        // caching allRowsHeight on the block - it's safe as this function is always called from within the code part\n        // that handles increases to row heights\n        block.allRowsHeight = rowsHeight;\n\n        var pBottom = pTop + rowsHeight;\n        var windowTop = scrollY;\n        var windowBottom = windowTop + scrollHeight;\n        if(windowTop < pBottom && windowBottom > pTop) {\n            pages.push(blockIndex);\n        }\n        pTop += rowsHeight;\n\n        // consider this nice final optimization; put it in `for` condition - caveat, currently the\n        // block.allRowsHeight relies on being invalidated, so enabling this opt may not be safe\n        // if(pages.length > 1) break;\n    }\n\n    return pages;\n}\n\nfunction updateBlockYPosition(gd, cellsColumnBlock, tableControlView) {\n    var d = flatData(cellsColumnBlock)[0];\n    if(d === undefined) return;\n    var blocks = d.rowBlocks;\n    var calcdata = d.calcdata;\n\n    var bottom = firstRowAnchor(blocks, blocks.length);\n    var scrollHeight = d.calcdata.groupHeight - headerHeight(d);\n    var scrollY = calcdata.scrollY = Math.max(0, Math.min(bottom - scrollHeight, calcdata.scrollY));\n\n    var pages = findPagesAndCacheHeights(blocks, scrollY, scrollHeight);\n    if(pages.length === 1) {\n        if(pages[0] === blocks.length - 1) {\n            pages.unshift(pages[0] - 1);\n        } else {\n            pages.push(pages[0] + 1);\n        }\n    }\n\n    // make phased out page jump by 2 while leaving stationary page intact\n    if(pages[0] % 2) {\n        pages.reverse();\n    }\n\n    cellsColumnBlock\n        .each(function(d, i) {\n            // these values will also be needed when a block is translated again due to growing cell height\n            d.page = pages[i];\n            d.scrollY = scrollY;\n        });\n\n    cellsColumnBlock\n        .attr('transform', function(d) {\n            var yTranslate = firstRowAnchor(d.rowBlocks, d.page) - d.scrollY;\n            return strTranslate(0, yTranslate);\n        });\n\n    // conditionally rerendering panel 0 and 1\n    if(gd) {\n        conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, d.prevPages, d, 0);\n        conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, d.prevPages, d, 1);\n        renderScrollbarKit(tableControlView, gd);\n    }\n}\n\nfunction makeDragRow(gd, allTableControlView, optionalMultiplier, optionalPosition) {\n    return function dragRow(eventD) {\n        // may come from whichever DOM event target: drag, wheel, bar... eventD corresponds to event target\n        var d = eventD.calcdata ? eventD.calcdata : eventD;\n        var tableControlView = allTableControlView.filter(function(dd) {return d.key === dd.key;});\n        var multiplier = optionalMultiplier || d.scrollbarState.dragMultiplier;\n\n        var initialScrollY = d.scrollY;\n\n        d.scrollY = optionalPosition === void(0) ? d.scrollY + multiplier * d3.event.dy : optionalPosition;\n        var cellsColumnBlock = tableControlView.selectAll('.' + c.cn.yColumn).selectAll('.' + c.cn.columnBlock).filter(cellsBlock);\n        updateBlockYPosition(gd, cellsColumnBlock, tableControlView);\n\n        // return false if we've \"used\" the scroll, ie it did something,\n        // so the event shouldn't bubble (if appropriate)\n        return d.scrollY === initialScrollY;\n    };\n}\n\nfunction conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, prevPages, d, revolverIndex) {\n    var shouldComponentUpdate = pages[revolverIndex] !== prevPages[revolverIndex];\n    if(shouldComponentUpdate) {\n        clearTimeout(d.currentRepaint[revolverIndex]);\n        d.currentRepaint[revolverIndex] = setTimeout(function() {\n            // setTimeout might lag rendering but yields a smoother scroll, because fast scrolling makes\n            // some repaints invisible ie. wasteful (DOM work blocks the main thread)\n            var toRerender = cellsColumnBlock.filter(function(d, i) {return i === revolverIndex && pages[i] !== prevPages[i];});\n            renderColumnCellTree(gd, tableControlView, toRerender, cellsColumnBlock);\n            prevPages[revolverIndex] = pages[revolverIndex];\n        });\n    }\n}\n\nfunction wrapTextMaker(columnBlock, element, tableControlView, gd) {\n    return function wrapText() {\n        var cellTextHolder = d3.select(element.parentNode);\n        cellTextHolder\n            .each(function(d) {\n                var fragments = d.fragments;\n                cellTextHolder.selectAll('tspan.line').each(function(dd, i) {\n                    fragments[i].width = this.getComputedTextLength();\n                });\n                // last element is only for measuring the separator character, so it's ignored:\n                var separatorLength = fragments[fragments.length - 1].width;\n                var rest = fragments.slice(0, -1);\n                var currentRow = [];\n                var currentAddition, currentAdditionLength;\n                var currentRowLength = 0;\n                var rowLengthLimit = d.column.columnWidth - 2 * c.cellPad;\n                d.value = '';\n                while(rest.length) {\n                    currentAddition = rest.shift();\n                    currentAdditionLength = currentAddition.width + separatorLength;\n                    if(currentRowLength + currentAdditionLength > rowLengthLimit) {\n                        d.value += currentRow.join(c.wrapSpacer) + c.lineBreaker;\n                        currentRow = [];\n                        currentRowLength = 0;\n                    }\n                    currentRow.push(currentAddition.text);\n                    currentRowLength += currentAdditionLength;\n                }\n                if(currentRowLength) {\n                    d.value += currentRow.join(c.wrapSpacer);\n                }\n                d.wrapped = true;\n            });\n\n        // the pre-wrapped text was rendered only for the text measurements\n        cellTextHolder.selectAll('tspan.line').remove();\n\n        // resupply text, now wrapped\n        populateCellText(cellTextHolder.select('.' + c.cn.cellText), tableControlView, columnBlock, gd);\n        d3.select(element.parentNode.parentNode).call(setCellHeightAndPositionY);\n    };\n}\n\nfunction updateYPositionMaker(columnBlock, element, tableControlView, gd, d) {\n    return function updateYPosition() {\n        if(d.settledY) return;\n        var cellTextHolder = d3.select(element.parentNode);\n        var l = getBlock(d);\n        var rowIndex = d.key - l.firstRowIndex;\n\n        var declaredRowHeight = l.rows[rowIndex].rowHeight;\n\n        var requiredHeight = d.cellHeightMayIncrease ? element.parentNode.getBoundingClientRect().height + 2 * c.cellPad : declaredRowHeight;\n\n        var finalHeight = Math.max(requiredHeight, declaredRowHeight);\n        var increase = finalHeight - l.rows[rowIndex].rowHeight;\n\n        if(increase) {\n            // current row height increased\n            l.rows[rowIndex].rowHeight = finalHeight;\n\n            columnBlock\n                .selectAll('.' + c.cn.columnCell)\n                .call(setCellHeightAndPositionY);\n\n            updateBlockYPosition(null, columnBlock.filter(cellsBlock), 0);\n\n            // if d.column.type === 'header', then the scrollbar has to be pushed downward to the scrollable area\n            // if d.column.type === 'cells', it can still be relevant if total scrolling content height is less than the\n            //                               scrollable window, as increases to row heights may need scrollbar updates\n            renderScrollbarKit(tableControlView, gd, true);\n        }\n\n        cellTextHolder\n            .attr('transform', function() {\n                // this code block is only invoked for items where d.cellHeightMayIncrease is truthy\n                var element = this;\n                var columnCellElement = element.parentNode;\n                var box = columnCellElement.getBoundingClientRect();\n                var rectBox = d3.select(element.parentNode).select('.' + c.cn.cellRect).node().getBoundingClientRect();\n                var currentTransform = element.transform.baseVal.consolidate();\n                var yPosition = rectBox.top - box.top + (currentTransform ? currentTransform.matrix.f : c.cellPad);\n                return strTranslate(xPosition(d, d3.select(element.parentNode).select('.' + c.cn.cellTextHolder).node().getBoundingClientRect().width), yPosition);\n            });\n\n        d.settledY = true;\n    };\n}\n\nfunction xPosition(d, optionalWidth) {\n    switch(d.align) {\n        case 'left': return c.cellPad;\n        case 'right': return d.column.columnWidth - (optionalWidth || 0) - c.cellPad;\n        case 'center': return (d.column.columnWidth - (optionalWidth || 0)) / 2;\n        default: return c.cellPad;\n    }\n}\n\nfunction setCellHeightAndPositionY(columnCell) {\n    columnCell\n        .attr('transform', function(d) {\n            var headerHeight = d.rowBlocks[0].auxiliaryBlocks.reduce(function(p, n) {return p + rowsHeight(n, Infinity);}, 0);\n            var l = getBlock(d);\n            var rowAnchor = rowsHeight(l, d.key);\n            var yOffset = rowAnchor + headerHeight;\n            return strTranslate(0, yOffset);\n        })\n        .selectAll('.' + c.cn.cellRect)\n        .attr('height', function(d) {return getRow(getBlock(d), d.key).rowHeight;});\n}\n\nfunction firstRowAnchor(blocks, page) {\n    var total = 0;\n    for(var i = page - 1; i >= 0; i--) {\n        total += allRowsHeight(blocks[i]);\n    }\n    return total;\n}\n\nfunction rowsHeight(rowBlock, key) {\n    var total = 0;\n    for(var i = 0; i < rowBlock.rows.length && rowBlock.rows[i].rowIndex < key; i++) {\n        total += rowBlock.rows[i].rowHeight;\n    }\n    return total;\n}\n\nfunction allRowsHeight(rowBlock) {\n    var cached = rowBlock.allRowsHeight;\n\n    if(cached !== void(0)) {\n        return cached;\n    }\n\n    var total = 0;\n    for(var i = 0; i < rowBlock.rows.length; i++) {\n        total += rowBlock.rows[i].rowHeight;\n    }\n    rowBlock.allRowsHeight = total;\n\n    return total;\n}\n\nfunction getBlock(d) {return d.rowBlocks[d.page];}\nfunction getRow(l, i) {return l.rows[i - l.firstRowIndex];}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}