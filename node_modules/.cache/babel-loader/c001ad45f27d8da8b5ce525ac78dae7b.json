{"ast":null,"code":"'use strict';\n\nvar Axes = require('../../plots/cartesian/axes');\nvar alignPeriod = require('../../plots/cartesian/align_period');\nvar mergeArray = require('../../lib').mergeArray;\nvar calcSelection = require('../scatter/calc_selection');\nvar BADNUM = require('../../constants/numerical').BADNUM;\nfunction isAbsolute(a) {\n  return a === 'a' || a === 'absolute';\n}\nfunction isTotal(a) {\n  return a === 't' || a === 'total';\n}\nmodule.exports = function calc(gd, trace) {\n  var xa = Axes.getFromId(gd, trace.xaxis || 'x');\n  var ya = Axes.getFromId(gd, trace.yaxis || 'y');\n  var size, pos, origPos, pObj, hasPeriod, pLetter;\n  if (trace.orientation === 'h') {\n    size = xa.makeCalcdata(trace, 'x');\n    origPos = ya.makeCalcdata(trace, 'y');\n    pObj = alignPeriod(trace, ya, 'y', origPos);\n    hasPeriod = !!trace.yperiodalignment;\n    pLetter = 'y';\n  } else {\n    size = ya.makeCalcdata(trace, 'y');\n    origPos = xa.makeCalcdata(trace, 'x');\n    pObj = alignPeriod(trace, xa, 'x', origPos);\n    hasPeriod = !!trace.xperiodalignment;\n    pLetter = 'x';\n  }\n  pos = pObj.vals;\n\n  // create the \"calculated data\" to plot\n  var serieslen = Math.min(pos.length, size.length);\n  var cd = new Array(serieslen);\n\n  // set position and size (as well as for waterfall total size)\n  var previousSum = 0;\n  var newSize;\n  // trace-wide flags\n  var hasTotals = false;\n  for (var i = 0; i < serieslen; i++) {\n    var amount = size[i] || 0;\n    var connectToNext = false;\n    if (size[i] !== BADNUM || isTotal(trace.measure[i]) || isAbsolute(trace.measure[i])) {\n      if (i + 1 < serieslen && (size[i + 1] !== BADNUM || isTotal(trace.measure[i + 1]) || isAbsolute(trace.measure[i + 1]))) {\n        connectToNext = true;\n      }\n    }\n    var cdi = cd[i] = {\n      i: i,\n      p: pos[i],\n      s: amount,\n      rawS: amount,\n      cNext: connectToNext\n    };\n    if (isAbsolute(trace.measure[i])) {\n      previousSum = cdi.s;\n      cdi.isSum = true;\n      cdi.dir = 'totals';\n      cdi.s = previousSum;\n    } else if (isTotal(trace.measure[i])) {\n      cdi.isSum = true;\n      cdi.dir = 'totals';\n      cdi.s = previousSum;\n    } else {\n      // default: relative\n      cdi.isSum = false;\n      cdi.dir = cdi.rawS < 0 ? 'decreasing' : 'increasing';\n      newSize = cdi.s;\n      cdi.s = previousSum + newSize;\n      previousSum += newSize;\n    }\n    if (cdi.dir === 'totals') {\n      hasTotals = true;\n    }\n    if (hasPeriod) {\n      cd[i].orig_p = origPos[i]; // used by hover\n      cd[i][pLetter + 'End'] = pObj.ends[i];\n      cd[i][pLetter + 'Start'] = pObj.starts[i];\n    }\n    if (trace.ids) {\n      cdi.id = String(trace.ids[i]);\n    }\n    cdi.v = (trace.base || 0) + previousSum;\n  }\n  if (cd.length) cd[0].hasTotals = hasTotals;\n  mergeArray(trace.text, cd, 'tx');\n  mergeArray(trace.hovertext, cd, 'htx');\n  calcSelection(cd, trace);\n  return cd;\n};","map":{"version":3,"names":["Axes","require","alignPeriod","mergeArray","calcSelection","BADNUM","isAbsolute","a","isTotal","module","exports","calc","gd","trace","xa","getFromId","xaxis","ya","yaxis","size","pos","origPos","pObj","hasPeriod","pLetter","orientation","makeCalcdata","yperiodalignment","xperiodalignment","vals","serieslen","Math","min","length","cd","Array","previousSum","newSize","hasTotals","i","amount","connectToNext","measure","cdi","p","s","rawS","cNext","isSum","dir","orig_p","ends","starts","ids","id","String","v","base","text","hovertext"],"sources":["E:/tog_workspace/TestFabric_main/TestFabric-main/node_modules/plotly.js/src/traces/waterfall/calc.js"],"sourcesContent":["'use strict';\n\nvar Axes = require('../../plots/cartesian/axes');\nvar alignPeriod = require('../../plots/cartesian/align_period');\nvar mergeArray = require('../../lib').mergeArray;\nvar calcSelection = require('../scatter/calc_selection');\nvar BADNUM = require('../../constants/numerical').BADNUM;\n\nfunction isAbsolute(a) {\n    return (a === 'a' || a === 'absolute');\n}\n\nfunction isTotal(a) {\n    return (a === 't' || a === 'total');\n}\n\nmodule.exports = function calc(gd, trace) {\n    var xa = Axes.getFromId(gd, trace.xaxis || 'x');\n    var ya = Axes.getFromId(gd, trace.yaxis || 'y');\n    var size, pos, origPos, pObj, hasPeriod, pLetter;\n\n    if(trace.orientation === 'h') {\n        size = xa.makeCalcdata(trace, 'x');\n        origPos = ya.makeCalcdata(trace, 'y');\n        pObj = alignPeriod(trace, ya, 'y', origPos);\n        hasPeriod = !!trace.yperiodalignment;\n        pLetter = 'y';\n    } else {\n        size = ya.makeCalcdata(trace, 'y');\n        origPos = xa.makeCalcdata(trace, 'x');\n        pObj = alignPeriod(trace, xa, 'x', origPos);\n        hasPeriod = !!trace.xperiodalignment;\n        pLetter = 'x';\n    }\n    pos = pObj.vals;\n\n    // create the \"calculated data\" to plot\n    var serieslen = Math.min(pos.length, size.length);\n    var cd = new Array(serieslen);\n\n    // set position and size (as well as for waterfall total size)\n    var previousSum = 0;\n    var newSize;\n    // trace-wide flags\n    var hasTotals = false;\n\n    for(var i = 0; i < serieslen; i++) {\n        var amount = size[i] || 0;\n\n        var connectToNext = false;\n        if(size[i] !== BADNUM || isTotal(trace.measure[i]) || isAbsolute(trace.measure[i])) {\n            if(i + 1 < serieslen && (size[i + 1] !== BADNUM || isTotal(trace.measure[i + 1]) || isAbsolute(trace.measure[i + 1]))) {\n                connectToNext = true;\n            }\n        }\n\n        var cdi = cd[i] = {\n            i: i,\n            p: pos[i],\n            s: amount,\n            rawS: amount,\n            cNext: connectToNext\n        };\n\n        if(isAbsolute(trace.measure[i])) {\n            previousSum = cdi.s;\n\n            cdi.isSum = true;\n            cdi.dir = 'totals';\n            cdi.s = previousSum;\n        } else if(isTotal(trace.measure[i])) {\n            cdi.isSum = true;\n            cdi.dir = 'totals';\n            cdi.s = previousSum;\n        } else {\n            // default: relative\n            cdi.isSum = false;\n            cdi.dir = cdi.rawS < 0 ? 'decreasing' : 'increasing';\n            newSize = cdi.s;\n            cdi.s = previousSum + newSize;\n            previousSum += newSize;\n        }\n\n        if(cdi.dir === 'totals') {\n            hasTotals = true;\n        }\n\n        if(hasPeriod) {\n            cd[i].orig_p = origPos[i]; // used by hover\n            cd[i][pLetter + 'End'] = pObj.ends[i];\n            cd[i][pLetter + 'Start'] = pObj.starts[i];\n        }\n\n        if(trace.ids) {\n            cdi.id = String(trace.ids[i]);\n        }\n\n        cdi.v = (trace.base || 0) + previousSum;\n    }\n\n    if(cd.length) cd[0].hasTotals = hasTotals;\n\n    mergeArray(trace.text, cd, 'tx');\n    mergeArray(trace.hovertext, cd, 'htx');\n    calcSelection(cd, trace);\n\n    return cd;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}