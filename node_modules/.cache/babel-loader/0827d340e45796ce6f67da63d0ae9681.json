{"ast":null,"code":"'use strict';\n\nvar createHeatmap2D = require('../../../stackgl_modules').gl_heatmap2d;\nvar Axes = require('../../plots/cartesian/axes');\nvar str2RGBArray = require('../../lib/str2rgbarray');\nfunction Heatmap(scene, uid) {\n  this.scene = scene;\n  this.uid = uid;\n  this.type = 'heatmapgl';\n  this.name = '';\n  this.hoverinfo = 'all';\n  this.xData = [];\n  this.yData = [];\n  this.zData = [];\n  this.textLabels = [];\n  this.idToIndex = [];\n  this.bounds = [0, 0, 0, 0];\n  this.options = {\n    zsmooth: 'fast',\n    z: [],\n    x: [],\n    y: [],\n    shape: [0, 0],\n    colorLevels: [0],\n    colorValues: [0, 0, 0, 1]\n  };\n  this.heatmap = createHeatmap2D(scene.glplot, this.options);\n  this.heatmap._trace = this;\n}\nvar proto = Heatmap.prototype;\nproto.handlePick = function (pickResult) {\n  var options = this.options;\n  var shape = options.shape;\n  var index = pickResult.pointId;\n  var xIndex = index % shape[0];\n  var yIndex = Math.floor(index / shape[0]);\n  var zIndex = index;\n  return {\n    trace: this,\n    dataCoord: pickResult.dataCoord,\n    traceCoord: [options.x[xIndex], options.y[yIndex], options.z[zIndex]],\n    textLabel: this.textLabels[index],\n    name: this.name,\n    pointIndex: [yIndex, xIndex],\n    hoverinfo: this.hoverinfo\n  };\n};\nproto.update = function (fullTrace, calcTrace) {\n  var calcPt = calcTrace[0];\n  this.index = fullTrace.index;\n  this.name = fullTrace.name;\n  this.hoverinfo = fullTrace.hoverinfo;\n\n  // convert z from 2D -> 1D\n  var z = calcPt.z;\n  this.options.z = [].concat.apply([], z);\n  var rowLen = z[0].length;\n  var colLen = z.length;\n  this.options.shape = [rowLen, colLen];\n  this.options.x = calcPt.x;\n  this.options.y = calcPt.y;\n  this.options.zsmooth = fullTrace.zsmooth;\n  var colorOptions = convertColorscale(fullTrace);\n  this.options.colorLevels = colorOptions.colorLevels;\n  this.options.colorValues = colorOptions.colorValues;\n\n  // convert text from 2D -> 1D\n  this.textLabels = [].concat.apply([], fullTrace.text);\n  this.heatmap.update(this.options);\n  var xa = this.scene.xaxis;\n  var ya = this.scene.yaxis;\n  var xOpts, yOpts;\n  if (fullTrace.zsmooth === false) {\n    // increase padding for discretised heatmap as suggested by Louise Ord\n    xOpts = {\n      ppad: calcPt.x[1] - calcPt.x[0]\n    };\n    yOpts = {\n      ppad: calcPt.y[1] - calcPt.y[0]\n    };\n  }\n  fullTrace._extremes[xa._id] = Axes.findExtremes(xa, calcPt.x, xOpts);\n  fullTrace._extremes[ya._id] = Axes.findExtremes(ya, calcPt.y, yOpts);\n};\nproto.dispose = function () {\n  this.heatmap.dispose();\n};\nfunction convertColorscale(fullTrace) {\n  var scl = fullTrace.colorscale;\n  var zmin = fullTrace.zmin;\n  var zmax = fullTrace.zmax;\n  var N = scl.length;\n  var domain = new Array(N);\n  var range = new Array(4 * N);\n  for (var i = 0; i < N; i++) {\n    var si = scl[i];\n    var color = str2RGBArray(si[1]);\n    domain[i] = zmin + si[0] * (zmax - zmin);\n    for (var j = 0; j < 4; j++) {\n      range[4 * i + j] = color[j];\n    }\n  }\n  return {\n    colorLevels: domain,\n    colorValues: range\n  };\n}\nfunction createHeatmap(scene, fullTrace, calcTrace) {\n  var plot = new Heatmap(scene, fullTrace.uid);\n  plot.update(fullTrace, calcTrace);\n  return plot;\n}\nmodule.exports = createHeatmap;","map":{"version":3,"names":["createHeatmap2D","require","gl_heatmap2d","Axes","str2RGBArray","Heatmap","scene","uid","type","name","hoverinfo","xData","yData","zData","textLabels","idToIndex","bounds","options","zsmooth","z","x","y","shape","colorLevels","colorValues","heatmap","glplot","_trace","proto","prototype","handlePick","pickResult","index","pointId","xIndex","yIndex","Math","floor","zIndex","trace","dataCoord","traceCoord","textLabel","pointIndex","update","fullTrace","calcTrace","calcPt","concat","apply","rowLen","length","colLen","colorOptions","convertColorscale","text","xa","xaxis","ya","yaxis","xOpts","yOpts","ppad","_extremes","_id","findExtremes","dispose","scl","colorscale","zmin","zmax","N","domain","Array","range","i","si","color","j","createHeatmap","plot","module","exports"],"sources":["E:/tog_workspace/TestFabric_main/TestFabric-main/node_modules/plotly.js/src/traces/heatmapgl/convert.js"],"sourcesContent":["'use strict';\n\nvar createHeatmap2D = require('../../../stackgl_modules').gl_heatmap2d;\nvar Axes = require('../../plots/cartesian/axes');\nvar str2RGBArray = require('../../lib/str2rgbarray');\n\n\nfunction Heatmap(scene, uid) {\n    this.scene = scene;\n    this.uid = uid;\n    this.type = 'heatmapgl';\n\n    this.name = '';\n    this.hoverinfo = 'all';\n\n    this.xData = [];\n    this.yData = [];\n    this.zData = [];\n    this.textLabels = [];\n\n    this.idToIndex = [];\n    this.bounds = [0, 0, 0, 0];\n\n    this.options = {\n        zsmooth: 'fast',\n        z: [],\n        x: [],\n        y: [],\n        shape: [0, 0],\n        colorLevels: [0],\n        colorValues: [0, 0, 0, 1]\n    };\n\n    this.heatmap = createHeatmap2D(scene.glplot, this.options);\n    this.heatmap._trace = this;\n}\n\nvar proto = Heatmap.prototype;\n\nproto.handlePick = function(pickResult) {\n    var options = this.options;\n    var shape = options.shape;\n    var index = pickResult.pointId;\n    var xIndex = index % shape[0];\n    var yIndex = Math.floor(index / shape[0]);\n    var zIndex = index;\n\n    return {\n        trace: this,\n        dataCoord: pickResult.dataCoord,\n        traceCoord: [\n            options.x[xIndex],\n            options.y[yIndex],\n            options.z[zIndex]\n        ],\n        textLabel: this.textLabels[index],\n        name: this.name,\n        pointIndex: [yIndex, xIndex],\n        hoverinfo: this.hoverinfo\n    };\n};\n\nproto.update = function(fullTrace, calcTrace) {\n    var calcPt = calcTrace[0];\n\n    this.index = fullTrace.index;\n    this.name = fullTrace.name;\n    this.hoverinfo = fullTrace.hoverinfo;\n\n    // convert z from 2D -> 1D\n    var z = calcPt.z;\n    this.options.z = [].concat.apply([], z);\n\n    var rowLen = z[0].length;\n    var colLen = z.length;\n    this.options.shape = [rowLen, colLen];\n\n    this.options.x = calcPt.x;\n    this.options.y = calcPt.y;\n    this.options.zsmooth = fullTrace.zsmooth;\n\n    var colorOptions = convertColorscale(fullTrace);\n    this.options.colorLevels = colorOptions.colorLevels;\n    this.options.colorValues = colorOptions.colorValues;\n\n    // convert text from 2D -> 1D\n    this.textLabels = [].concat.apply([], fullTrace.text);\n\n    this.heatmap.update(this.options);\n\n    var xa = this.scene.xaxis;\n    var ya = this.scene.yaxis;\n\n    var xOpts, yOpts;\n    if(fullTrace.zsmooth === false) {\n        // increase padding for discretised heatmap as suggested by Louise Ord\n        xOpts = { ppad: calcPt.x[1] - calcPt.x[0] };\n        yOpts = { ppad: calcPt.y[1] - calcPt.y[0] };\n    }\n\n    fullTrace._extremes[xa._id] = Axes.findExtremes(xa, calcPt.x, xOpts);\n    fullTrace._extremes[ya._id] = Axes.findExtremes(ya, calcPt.y, yOpts);\n};\n\nproto.dispose = function() {\n    this.heatmap.dispose();\n};\n\nfunction convertColorscale(fullTrace) {\n    var scl = fullTrace.colorscale;\n    var zmin = fullTrace.zmin;\n    var zmax = fullTrace.zmax;\n\n    var N = scl.length;\n    var domain = new Array(N);\n    var range = new Array(4 * N);\n\n    for(var i = 0; i < N; i++) {\n        var si = scl[i];\n        var color = str2RGBArray(si[1]);\n\n        domain[i] = zmin + si[0] * (zmax - zmin);\n\n        for(var j = 0; j < 4; j++) {\n            range[(4 * i) + j] = color[j];\n        }\n    }\n\n    return {\n        colorLevels: domain,\n        colorValues: range\n    };\n}\n\nfunction createHeatmap(scene, fullTrace, calcTrace) {\n    var plot = new Heatmap(scene, fullTrace.uid);\n    plot.update(fullTrace, calcTrace);\n    return plot;\n}\n\nmodule.exports = createHeatmap;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}