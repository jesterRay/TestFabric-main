{"ast":null,"code":"'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar xmlnsNamespaces = require('../../constants/xmlns_namespaces');\nvar constants = require('./constants');\nvar supportsPixelatedImage = require('../../lib/supports_pixelated_image');\nvar PIXELATED_IMAGE_STYLE = require('../../constants/pixelated_image').STYLE;\nmodule.exports = function plot(gd, plotinfo, cdimage, imageLayer) {\n  var xa = plotinfo.xaxis;\n  var ya = plotinfo.yaxis;\n  var supportsPixelated = !gd._context._exportedPlot && supportsPixelatedImage();\n  Lib.makeTraceGroups(imageLayer, cdimage, 'im').each(function (cd) {\n    var plotGroup = d3.select(this);\n    var cd0 = cd[0];\n    var trace = cd0.trace;\n    var realImage = (trace.zsmooth === 'fast' || trace.zsmooth === false && supportsPixelated) && !trace._hasZ && trace._hasSource && xa.type === 'linear' && ya.type === 'linear';\n    trace._realImage = realImage;\n    var z = cd0.z;\n    var x0 = cd0.x0;\n    var y0 = cd0.y0;\n    var w = cd0.w;\n    var h = cd0.h;\n    var dx = trace.dx;\n    var dy = trace.dy;\n    var left, right, temp, top, bottom, i;\n    // in case of log of a negative\n    i = 0;\n    while (left === undefined && i < w) {\n      left = xa.c2p(x0 + i * dx);\n      i++;\n    }\n    i = w;\n    while (right === undefined && i > 0) {\n      right = xa.c2p(x0 + i * dx);\n      i--;\n    }\n    i = 0;\n    while (top === undefined && i < h) {\n      top = ya.c2p(y0 + i * dy);\n      i++;\n    }\n    i = h;\n    while (bottom === undefined && i > 0) {\n      bottom = ya.c2p(y0 + i * dy);\n      i--;\n    }\n    if (right < left) {\n      temp = right;\n      right = left;\n      left = temp;\n    }\n    if (bottom < top) {\n      temp = top;\n      top = bottom;\n      bottom = temp;\n    }\n\n    // Reduce image size when zoomed in to save memory\n    if (!realImage) {\n      var extra = 0.5; // half the axis size\n      left = Math.max(-extra * xa._length, left);\n      right = Math.min((1 + extra) * xa._length, right);\n      top = Math.max(-extra * ya._length, top);\n      bottom = Math.min((1 + extra) * ya._length, bottom);\n    }\n    var imageWidth = Math.round(right - left);\n    var imageHeight = Math.round(bottom - top);\n\n    // if image is entirely off-screen, don't even draw it\n    var isOffScreen = imageWidth <= 0 || imageHeight <= 0;\n    if (isOffScreen) {\n      var noImage = plotGroup.selectAll('image').data([]);\n      noImage.exit().remove();\n      return;\n    }\n\n    // Create a new canvas and draw magnified pixels on it\n    function drawMagnifiedPixelsOnCanvas(readPixel) {\n      var canvas = document.createElement('canvas');\n      canvas.width = imageWidth;\n      canvas.height = imageHeight;\n      var context = canvas.getContext('2d', {\n        willReadFrequently: true\n      });\n      var ipx = function (i) {\n        return Lib.constrain(Math.round(xa.c2p(x0 + i * dx) - left), 0, imageWidth);\n      };\n      var jpx = function (j) {\n        return Lib.constrain(Math.round(ya.c2p(y0 + j * dy) - top), 0, imageHeight);\n      };\n      var cr = constants.colormodel[trace.colormodel];\n      var colormodel = cr.colormodel || trace.colormodel;\n      var fmt = cr.fmt;\n      var c;\n      for (i = 0; i < cd0.w; i++) {\n        var ipx0 = ipx(i);\n        var ipx1 = ipx(i + 1);\n        if (ipx1 === ipx0 || isNaN(ipx1) || isNaN(ipx0)) continue;\n        for (var j = 0; j < cd0.h; j++) {\n          var jpx0 = jpx(j);\n          var jpx1 = jpx(j + 1);\n          if (jpx1 === jpx0 || isNaN(jpx1) || isNaN(jpx0) || !readPixel(i, j)) continue;\n          c = trace._scaler(readPixel(i, j));\n          if (c) {\n            context.fillStyle = colormodel + '(' + fmt(c).join(',') + ')';\n          } else {\n            // Return a transparent pixel\n            context.fillStyle = 'rgba(0,0,0,0)';\n          }\n          context.fillRect(ipx0, jpx0, ipx1 - ipx0, jpx1 - jpx0);\n        }\n      }\n      return canvas;\n    }\n    var image3 = plotGroup.selectAll('image').data([cd]);\n    image3.enter().append('svg:image').attr({\n      xmlns: xmlnsNamespaces.svg,\n      preserveAspectRatio: 'none'\n    });\n    image3.exit().remove();\n    var style = trace.zsmooth === false ? PIXELATED_IMAGE_STYLE : '';\n    if (realImage) {\n      var xRange = Lib.simpleMap(xa.range, xa.r2l);\n      var yRange = Lib.simpleMap(ya.range, ya.r2l);\n      var flipX = xRange[1] < xRange[0];\n      var flipY = yRange[1] > yRange[0];\n      if (flipX || flipY) {\n        var tx = left + imageWidth / 2;\n        var ty = top + imageHeight / 2;\n        style += 'transform:' + strTranslate(tx + 'px', ty + 'px') + 'scale(' + (flipX ? -1 : 1) + ',' + (flipY ? -1 : 1) + ')' + strTranslate(-tx + 'px', -ty + 'px') + ';';\n      }\n    }\n    image3.attr('style', style);\n    var p = new Promise(function (resolve) {\n      if (trace._hasZ) {\n        resolve();\n      } else if (trace._hasSource) {\n        // Check if canvas already exists and has the right data\n        if (trace._canvas && trace._canvas.el.width === w && trace._canvas.el.height === h && trace._canvas.source === trace.source) {\n          resolve();\n        } else {\n          // Create a canvas and transfer image onto it to access pixel information\n          var canvas = document.createElement('canvas');\n          canvas.width = w;\n          canvas.height = h;\n          var context = canvas.getContext('2d', {\n            willReadFrequently: true\n          });\n          trace._image = trace._image || new Image();\n          var image = trace._image;\n          image.onload = function () {\n            context.drawImage(image, 0, 0);\n            trace._canvas = {\n              el: canvas,\n              source: trace.source\n            };\n            resolve();\n          };\n          image.setAttribute('src', trace.source);\n        }\n      }\n    }).then(function () {\n      var href, canvas;\n      if (trace._hasZ) {\n        canvas = drawMagnifiedPixelsOnCanvas(function (i, j) {\n          var _z = z[j][i];\n          if (Lib.isTypedArray(_z)) _z = Array.from(_z);\n          return _z;\n        });\n        href = canvas.toDataURL('image/png');\n      } else if (trace._hasSource) {\n        if (realImage) {\n          href = trace.source;\n        } else {\n          var context = trace._canvas.el.getContext('2d', {\n            willReadFrequently: true\n          });\n          var data = context.getImageData(0, 0, w, h).data;\n          canvas = drawMagnifiedPixelsOnCanvas(function (i, j) {\n            var index = 4 * (j * w + i);\n            return [data[index], data[index + 1], data[index + 2], data[index + 3]];\n          });\n          href = canvas.toDataURL('image/png');\n        }\n      }\n      image3.attr({\n        'xlink:href': href,\n        height: imageHeight,\n        width: imageWidth,\n        x: left,\n        y: top\n      });\n    });\n    gd._promises.push(p);\n  });\n};","map":{"version":3,"names":["d3","require","Lib","strTranslate","xmlnsNamespaces","constants","supportsPixelatedImage","PIXELATED_IMAGE_STYLE","STYLE","module","exports","plot","gd","plotinfo","cdimage","imageLayer","xa","xaxis","ya","yaxis","supportsPixelated","_context","_exportedPlot","makeTraceGroups","each","cd","plotGroup","select","cd0","trace","realImage","zsmooth","_hasZ","_hasSource","type","_realImage","z","x0","y0","w","h","dx","dy","left","right","temp","top","bottom","i","undefined","c2p","extra","Math","max","_length","min","imageWidth","round","imageHeight","isOffScreen","noImage","selectAll","data","exit","remove","drawMagnifiedPixelsOnCanvas","readPixel","canvas","document","createElement","width","height","context","getContext","willReadFrequently","ipx","constrain","jpx","j","cr","colormodel","fmt","c","ipx0","ipx1","isNaN","jpx0","jpx1","_scaler","fillStyle","join","fillRect","image3","enter","append","attr","xmlns","svg","preserveAspectRatio","style","xRange","simpleMap","range","r2l","yRange","flipX","flipY","tx","ty","p","Promise","resolve","_canvas","el","source","_image","Image","image","onload","drawImage","setAttribute","then","href","_z","isTypedArray","Array","from","toDataURL","getImageData","index","x","y","_promises","push"],"sources":["E:/tog_workspace/TestFabric_main/TestFabric-main/node_modules/plotly.js/src/traces/image/plot.js"],"sourcesContent":["'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar xmlnsNamespaces = require('../../constants/xmlns_namespaces');\nvar constants = require('./constants');\nvar supportsPixelatedImage = require('../../lib/supports_pixelated_image');\nvar PIXELATED_IMAGE_STYLE = require('../../constants/pixelated_image').STYLE;\n\nmodule.exports = function plot(gd, plotinfo, cdimage, imageLayer) {\n    var xa = plotinfo.xaxis;\n    var ya = plotinfo.yaxis;\n\n    var supportsPixelated = !gd._context._exportedPlot && supportsPixelatedImage();\n\n    Lib.makeTraceGroups(imageLayer, cdimage, 'im').each(function(cd) {\n        var plotGroup = d3.select(this);\n        var cd0 = cd[0];\n        var trace = cd0.trace;\n        var realImage = (\n            ((trace.zsmooth === 'fast') || (trace.zsmooth === false && supportsPixelated)) &&\n            !trace._hasZ && trace._hasSource && xa.type === 'linear' && ya.type === 'linear'\n        );\n        trace._realImage = realImage;\n\n        var z = cd0.z;\n        var x0 = cd0.x0;\n        var y0 = cd0.y0;\n        var w = cd0.w;\n        var h = cd0.h;\n        var dx = trace.dx;\n        var dy = trace.dy;\n\n        var left, right, temp, top, bottom, i;\n        // in case of log of a negative\n        i = 0;\n        while(left === undefined && i < w) {\n            left = xa.c2p(x0 + i * dx);\n            i++;\n        }\n        i = w;\n        while(right === undefined && i > 0) {\n            right = xa.c2p(x0 + i * dx);\n            i--;\n        }\n        i = 0;\n        while(top === undefined && i < h) {\n            top = ya.c2p(y0 + i * dy);\n            i++;\n        }\n        i = h;\n        while(bottom === undefined && i > 0) {\n            bottom = ya.c2p(y0 + i * dy);\n            i--;\n        }\n\n        if(right < left) {\n            temp = right;\n            right = left;\n            left = temp;\n        }\n\n        if(bottom < top) {\n            temp = top;\n            top = bottom;\n            bottom = temp;\n        }\n\n        // Reduce image size when zoomed in to save memory\n        if(!realImage) {\n            var extra = 0.5; // half the axis size\n            left = Math.max(-extra * xa._length, left);\n            right = Math.min((1 + extra) * xa._length, right);\n            top = Math.max(-extra * ya._length, top);\n            bottom = Math.min((1 + extra) * ya._length, bottom);\n        }\n\n        var imageWidth = Math.round(right - left);\n        var imageHeight = Math.round(bottom - top);\n\n        // if image is entirely off-screen, don't even draw it\n        var isOffScreen = (imageWidth <= 0 || imageHeight <= 0);\n        if(isOffScreen) {\n            var noImage = plotGroup.selectAll('image').data([]);\n            noImage.exit().remove();\n            return;\n        }\n\n        // Create a new canvas and draw magnified pixels on it\n        function drawMagnifiedPixelsOnCanvas(readPixel) {\n            var canvas = document.createElement('canvas');\n            canvas.width = imageWidth;\n            canvas.height = imageHeight;\n            var context = canvas.getContext('2d', {willReadFrequently: true});\n\n            var ipx = function(i) {return Lib.constrain(Math.round(xa.c2p(x0 + i * dx) - left), 0, imageWidth);};\n            var jpx = function(j) {return Lib.constrain(Math.round(ya.c2p(y0 + j * dy) - top), 0, imageHeight);};\n\n            var cr = constants.colormodel[trace.colormodel];\n            var colormodel = (cr.colormodel || trace.colormodel);\n            var fmt = cr.fmt;\n            var c;\n            for(i = 0; i < cd0.w; i++) {\n                var ipx0 = ipx(i); var ipx1 = ipx(i + 1);\n                if(ipx1 === ipx0 || isNaN(ipx1) || isNaN(ipx0)) continue;\n                for(var j = 0; j < cd0.h; j++) {\n                    var jpx0 = jpx(j); var jpx1 = jpx(j + 1);\n                    if(jpx1 === jpx0 || isNaN(jpx1) || isNaN(jpx0) || !readPixel(i, j)) continue;\n                    c = trace._scaler(readPixel(i, j));\n                    if(c) {\n                        context.fillStyle = colormodel + '(' + fmt(c).join(',') + ')';\n                    } else {\n                        // Return a transparent pixel\n                        context.fillStyle = 'rgba(0,0,0,0)';\n                    }\n                    context.fillRect(ipx0, jpx0, ipx1 - ipx0, jpx1 - jpx0);\n                }\n            }\n\n            return canvas;\n        }\n\n        var image3 = plotGroup.selectAll('image')\n            .data([cd]);\n\n        image3.enter().append('svg:image').attr({\n            xmlns: xmlnsNamespaces.svg,\n            preserveAspectRatio: 'none'\n        });\n\n        image3.exit().remove();\n\n        var style = (trace.zsmooth === false) ? PIXELATED_IMAGE_STYLE : '';\n\n        if(realImage) {\n            var xRange = Lib.simpleMap(xa.range, xa.r2l);\n            var yRange = Lib.simpleMap(ya.range, ya.r2l);\n\n            var flipX = xRange[1] < xRange[0];\n            var flipY = yRange[1] > yRange[0];\n            if(flipX || flipY) {\n                var tx = left + imageWidth / 2;\n                var ty = top + imageHeight / 2;\n                style += 'transform:' +\n                    strTranslate(tx + 'px', ty + 'px') +\n                    'scale(' + (flipX ? -1 : 1) + ',' + (flipY ? -1 : 1) + ')' +\n                    strTranslate(-tx + 'px', -ty + 'px') + ';';\n            }\n        }\n        image3.attr('style', style);\n\n        var p = new Promise(function(resolve) {\n            if(trace._hasZ) {\n                resolve();\n            } else if(trace._hasSource) {\n                // Check if canvas already exists and has the right data\n                if(\n                    trace._canvas &&\n                    trace._canvas.el.width === w &&\n                    trace._canvas.el.height === h &&\n                    trace._canvas.source === trace.source\n                ) {\n                    resolve();\n                } else {\n                    // Create a canvas and transfer image onto it to access pixel information\n                    var canvas = document.createElement('canvas');\n                    canvas.width = w;\n                    canvas.height = h;\n                    var context = canvas.getContext('2d', {willReadFrequently: true});\n\n                    trace._image = trace._image || new Image();\n                    var image = trace._image;\n                    image.onload = function() {\n                        context.drawImage(image, 0, 0);\n                        trace._canvas = {\n                            el: canvas,\n                            source: trace.source\n                        };\n                        resolve();\n                    };\n                    image.setAttribute('src', trace.source);\n                }\n            }\n        })\n        .then(function() {\n            var href, canvas;\n            if(trace._hasZ) {\n                canvas = drawMagnifiedPixelsOnCanvas(function(i, j) {\n                    var _z = z[j][i];\n                    if(Lib.isTypedArray(_z)) _z = Array.from(_z);\n                    return _z;\n                });\n                href = canvas.toDataURL('image/png');\n            } else if(trace._hasSource) {\n                if(realImage) {\n                    href = trace.source;\n                } else {\n                    var context = trace._canvas.el.getContext('2d', {willReadFrequently: true});\n                    var data = context.getImageData(0, 0, w, h).data;\n                    canvas = drawMagnifiedPixelsOnCanvas(function(i, j) {\n                        var index = 4 * (j * w + i);\n                        return [\n                            data[index],\n                            data[index + 1],\n                            data[index + 2],\n                            data[index + 3]\n                        ];\n                    });\n                    href = canvas.toDataURL('image/png');\n                }\n            }\n\n            image3.attr({\n                'xlink:href': href,\n                height: imageHeight,\n                width: imageWidth,\n                x: left,\n                y: top\n            });\n        });\n\n        gd._promises.push(p);\n    });\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}