{"ast":null,"code":"'use strict';\n\nvar convert = require('./convert');\nvar LAYER_PREFIX = require('../../plots/map/constants').traceLayerPrefix;\nfunction DensityMap(subplot, uid) {\n  this.type = 'densitymap';\n  this.subplot = subplot;\n  this.uid = uid;\n  this.sourceId = 'source-' + uid;\n  this.layerList = [['heatmap', LAYER_PREFIX + uid + '-heatmap']];\n\n  // previous 'below' value,\n  // need this to update it properly\n  this.below = null;\n}\nvar proto = DensityMap.prototype;\nproto.update = function (calcTrace) {\n  var subplot = this.subplot;\n  var layerList = this.layerList;\n  var optsAll = convert(calcTrace);\n  var below = subplot.belowLookup['trace-' + this.uid];\n  subplot.map.getSource(this.sourceId).setData(optsAll.geojson);\n  if (below !== this.below) {\n    this._removeLayers();\n    this._addLayers(optsAll, below);\n    this.below = below;\n  }\n  for (var i = 0; i < layerList.length; i++) {\n    var item = layerList[i];\n    var k = item[0];\n    var id = item[1];\n    var opts = optsAll[k];\n    subplot.setOptions(id, 'setLayoutProperty', opts.layout);\n    if (opts.layout.visibility === 'visible') {\n      subplot.setOptions(id, 'setPaintProperty', opts.paint);\n    }\n  }\n};\nproto._addLayers = function (optsAll, below) {\n  var subplot = this.subplot;\n  var layerList = this.layerList;\n  var sourceId = this.sourceId;\n  for (var i = 0; i < layerList.length; i++) {\n    var item = layerList[i];\n    var k = item[0];\n    var opts = optsAll[k];\n    subplot.addLayer({\n      type: k,\n      id: item[1],\n      source: sourceId,\n      layout: opts.layout,\n      paint: opts.paint\n    }, below);\n  }\n};\nproto._removeLayers = function () {\n  var map = this.subplot.map;\n  var layerList = this.layerList;\n  for (var i = layerList.length - 1; i >= 0; i--) {\n    map.removeLayer(layerList[i][1]);\n  }\n};\nproto.dispose = function () {\n  var map = this.subplot.map;\n  this._removeLayers();\n  map.removeSource(this.sourceId);\n};\nmodule.exports = function createDensityMap(subplot, calcTrace) {\n  var trace = calcTrace[0].trace;\n  var densityMap = new DensityMap(subplot, trace.uid);\n  var sourceId = densityMap.sourceId;\n  var optsAll = convert(calcTrace);\n  var below = densityMap.below = subplot.belowLookup['trace-' + trace.uid];\n  subplot.map.addSource(sourceId, {\n    type: 'geojson',\n    data: optsAll.geojson\n  });\n  densityMap._addLayers(optsAll, below);\n  return densityMap;\n};","map":{"version":3,"names":["convert","require","LAYER_PREFIX","traceLayerPrefix","DensityMap","subplot","uid","type","sourceId","layerList","below","proto","prototype","update","calcTrace","optsAll","belowLookup","map","getSource","setData","geojson","_removeLayers","_addLayers","i","length","item","k","id","opts","setOptions","layout","visibility","paint","addLayer","source","removeLayer","dispose","removeSource","module","exports","createDensityMap","trace","densityMap","addSource","data"],"sources":["E:/tog_workspace/TestFabric_main/TestFabric-main/node_modules/plotly.js/src/traces/densitymap/plot.js"],"sourcesContent":["'use strict';\n\nvar convert = require('./convert');\nvar LAYER_PREFIX = require('../../plots/map/constants').traceLayerPrefix;\n\nfunction DensityMap(subplot, uid) {\n    this.type = 'densitymap';\n    this.subplot = subplot;\n    this.uid = uid;\n\n    this.sourceId = 'source-' + uid;\n\n    this.layerList = [\n        ['heatmap', LAYER_PREFIX + uid + '-heatmap']\n    ];\n\n    // previous 'below' value,\n    // need this to update it properly\n    this.below = null;\n}\n\nvar proto = DensityMap.prototype;\n\nproto.update = function(calcTrace) {\n    var subplot = this.subplot;\n    var layerList = this.layerList;\n    var optsAll = convert(calcTrace);\n    var below = subplot.belowLookup['trace-' + this.uid];\n\n    subplot.map\n        .getSource(this.sourceId)\n        .setData(optsAll.geojson);\n\n    if(below !== this.below) {\n        this._removeLayers();\n        this._addLayers(optsAll, below);\n        this.below = below;\n    }\n\n    for(var i = 0; i < layerList.length; i++) {\n        var item = layerList[i];\n        var k = item[0];\n        var id = item[1];\n        var opts = optsAll[k];\n\n        subplot.setOptions(id, 'setLayoutProperty', opts.layout);\n\n        if(opts.layout.visibility === 'visible') {\n            subplot.setOptions(id, 'setPaintProperty', opts.paint);\n        }\n    }\n};\n\nproto._addLayers = function(optsAll, below) {\n    var subplot = this.subplot;\n    var layerList = this.layerList;\n    var sourceId = this.sourceId;\n\n    for(var i = 0; i < layerList.length; i++) {\n        var item = layerList[i];\n        var k = item[0];\n        var opts = optsAll[k];\n\n        subplot.addLayer({\n            type: k,\n            id: item[1],\n            source: sourceId,\n            layout: opts.layout,\n            paint: opts.paint\n        }, below);\n    }\n};\n\nproto._removeLayers = function() {\n    var map = this.subplot.map;\n    var layerList = this.layerList;\n\n    for(var i = layerList.length - 1; i >= 0; i--) {\n        map.removeLayer(layerList[i][1]);\n    }\n};\n\nproto.dispose = function() {\n    var map = this.subplot.map;\n    this._removeLayers();\n    map.removeSource(this.sourceId);\n};\n\nmodule.exports = function createDensityMap(subplot, calcTrace) {\n    var trace = calcTrace[0].trace;\n    var densityMap = new DensityMap(subplot, trace.uid);\n    var sourceId = densityMap.sourceId;\n    var optsAll = convert(calcTrace);\n    var below = densityMap.below = subplot.belowLookup['trace-' + trace.uid];\n\n    subplot.map.addSource(sourceId, {\n        type: 'geojson',\n        data: optsAll.geojson\n    });\n\n    densityMap._addLayers(optsAll, below);\n\n    return densityMap;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}