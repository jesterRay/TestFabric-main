{"ast":null,"code":"'use strict';\n\nvar d3 = require('@plotly/d3');\nvar isNumeric = require('fast-isnumeric');\nvar Plots = require('../../plots/plots');\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar interactConstants = require('../../constants/interactions');\nvar OPPOSITE_SIDE = require('../../constants/alignment').OPPOSITE_SIDE;\nvar numStripRE = / [XY][0-9]* /;\nvar SUBTITLE_PADDING_MATHJAX_EM = 1.6;\nvar SUBTITLE_PADDING_EM = 1.6;\n\n/**\n * Titles - (re)draw titles on the axes and plot:\n * @param {DOM element} gd - the graphDiv\n * @param {string} titleClass - the css class of this title\n * @param {object} options - how and what to draw\n *      propContainer - the layout object containing `title` and `titlefont`\n *          attributes that apply to this title\n *      propName - the full name of the title property (for Plotly.relayout)\n *      [traceIndex] - include only if this property applies to one trace\n *          (such as a colorbar title) - then editing pipes to Plotly.restyle\n *          instead of Plotly.relayout\n *      placeholder - placeholder text for an empty editable title\n *      [avoid] {object} - include if this title should move to avoid other elements\n *          selection - d3 selection of elements to avoid\n *          side - which direction to move if there is a conflict\n *          [offsetLeft] - if these elements are subject to a translation\n *              wrt the title element\n *          [offsetTop]\n *      attributes {object} - position and alignment attributes\n *          x - pixels\n *          y - pixels\n *          text-anchor - start|middle|end\n *      transform {object} - how to transform the title after positioning\n *          rotate - degrees\n *          offset - shift up/down in the rotated frame (unused?)\n *      containerGroup - if an svg <g> element already exists to hold this\n *          title, include here. Otherwise it will go in fullLayout._infolayer\n *      _meta {object (optional} - meta key-value to for title with\n *          Lib.templateString, default to fullLayout._meta, if not provided\n *\n *  @return {selection} d3 selection of title container group\n */\nfunction draw(gd, titleClass, options) {\n  var fullLayout = gd._fullLayout;\n  var cont = options.propContainer;\n  var prop = options.propName;\n  var placeholder = options.placeholder;\n  var traceIndex = options.traceIndex;\n  var avoid = options.avoid || {};\n  var attributes = options.attributes;\n  var transform = options.transform;\n  var group = options.containerGroup;\n  var opacity = 1;\n  var title = cont.title;\n  var txt = (title && title.text ? title.text : '').trim();\n  var titleIsPlaceholder = false;\n  var font = title && title.font ? title.font : {};\n  var fontFamily = font.family;\n  var fontSize = font.size;\n  var fontColor = font.color;\n  var fontWeight = font.weight;\n  var fontStyle = font.style;\n  var fontVariant = font.variant;\n  var fontTextcase = font.textcase;\n  var fontLineposition = font.lineposition;\n  var fontShadow = font.shadow;\n\n  // Get subtitle properties\n  var subtitleProp = options.subtitlePropName;\n  var subtitleEnabled = !!subtitleProp;\n  var subtitlePlaceholder = options.subtitlePlaceholder;\n  var subtitle = (cont.title || {}).subtitle || {\n    text: '',\n    font: {}\n  };\n  var subtitleTxt = subtitle.text.trim();\n  var subtitleIsPlaceholder = false;\n  var subtitleOpacity = 1;\n  var subtitleFont = subtitle.font;\n  var subFontFamily = subtitleFont.family;\n  var subFontSize = subtitleFont.size;\n  var subFontColor = subtitleFont.color;\n  var subFontWeight = subtitleFont.weight;\n  var subFontStyle = subtitleFont.style;\n  var subFontVariant = subtitleFont.variant;\n  var subFontTextcase = subtitleFont.textcase;\n  var subFontLineposition = subtitleFont.lineposition;\n  var subFontShadow = subtitleFont.shadow;\n\n  // only make this title editable if we positively identify its property\n  // as one that has editing enabled.\n  // Subtitle is editable if and only if title is editable\n  var editAttr;\n  if (prop === 'title.text') editAttr = 'titleText';else if (prop.indexOf('axis') !== -1) editAttr = 'axisTitleText';else if (prop.indexOf('colorbar' !== -1)) editAttr = 'colorbarTitleText';\n  var editable = gd._context.edits[editAttr];\n  function matchesPlaceholder(text, placeholder) {\n    if (text === undefined || placeholder === undefined) return false;\n    // look for placeholder text while stripping out numbers from eg X2, Y3\n    // this is just for backward compatibility with the old version that had\n    // \"Click to enter X2 title\" and may have gotten saved in some old plots,\n    // we don't want this to show up when these are displayed.\n    return text.replace(numStripRE, ' % ') === placeholder.replace(numStripRE, ' % ');\n  }\n  if (txt === '') opacity = 0;else if (matchesPlaceholder(txt, placeholder)) {\n    if (!editable) txt = '';\n    opacity = 0.2;\n    titleIsPlaceholder = true;\n  }\n  if (subtitleEnabled) {\n    if (subtitleTxt === '') subtitleOpacity = 0;else if (matchesPlaceholder(subtitleTxt, subtitlePlaceholder)) {\n      if (!editable) subtitleTxt = '';\n      subtitleOpacity = 0.2;\n      subtitleIsPlaceholder = true;\n    }\n  }\n  if (options._meta) {\n    txt = Lib.templateString(txt, options._meta);\n  } else if (fullLayout._meta) {\n    txt = Lib.templateString(txt, fullLayout._meta);\n  }\n  var elShouldExist = txt || subtitleTxt || editable;\n  var hColorbarMoveTitle;\n  if (!group) {\n    group = Lib.ensureSingle(fullLayout._infolayer, 'g', 'g-' + titleClass);\n    hColorbarMoveTitle = fullLayout._hColorbarMoveTitle;\n  }\n  var el = group.selectAll('text.' + titleClass).data(elShouldExist ? [0] : []);\n  el.enter().append('text');\n  el.text(txt)\n  // this is hacky, but convertToTspans uses the class\n  // to determine whether to rotate mathJax...\n  // so we need to clear out any old class and put the\n  // correct one (only relevant for colorbars, at least\n  // for now) - ie don't use .classed\n  .attr('class', titleClass);\n  el.exit().remove();\n  var subtitleEl = null;\n  var subtitleClass = titleClass + '-subtitle';\n  var subtitleElShouldExist = subtitleTxt || editable;\n  if (subtitleEnabled && subtitleElShouldExist) {\n    subtitleEl = group.selectAll('text.' + subtitleClass).data(subtitleElShouldExist ? [0] : []);\n    subtitleEl.enter().append('text');\n    subtitleEl.text(subtitleTxt).attr('class', subtitleClass);\n    subtitleEl.exit().remove();\n  }\n  if (!elShouldExist) return group;\n  function titleLayout(titleEl, subtitleEl) {\n    Lib.syncOrAsync([drawTitle, scootTitle], {\n      title: titleEl,\n      subtitle: subtitleEl\n    });\n  }\n  function drawTitle(titleAndSubtitleEls) {\n    var titleEl = titleAndSubtitleEls.title;\n    var subtitleEl = titleAndSubtitleEls.subtitle;\n    var transformVal;\n    if (!transform && hColorbarMoveTitle) {\n      transform = {};\n    }\n    if (transform) {\n      transformVal = '';\n      if (transform.rotate) {\n        transformVal += 'rotate(' + [transform.rotate, attributes.x, attributes.y] + ')';\n      }\n      if (transform.offset || hColorbarMoveTitle) {\n        transformVal += strTranslate(0, (transform.offset || 0) - (hColorbarMoveTitle || 0));\n      }\n    } else {\n      transformVal = null;\n    }\n    titleEl.attr('transform', transformVal);\n\n    // Callback to adjust the subtitle position after mathjax is rendered\n    // Mathjax is rendered asynchronously, which is why this step needs to be\n    // passed as a callback\n    function adjustSubtitlePosition(titleElMathGroup) {\n      if (!titleElMathGroup) return;\n      var subtitleElement = d3.select(titleElMathGroup.node().parentNode).select('.' + subtitleClass);\n      if (!subtitleElement.empty()) {\n        var titleElMathBbox = titleElMathGroup.node().getBBox();\n        if (titleElMathBbox.height) {\n          // Position subtitle based on bottom of Mathjax title\n          var subtitleY = titleElMathBbox.y + titleElMathBbox.height + SUBTITLE_PADDING_MATHJAX_EM * subFontSize;\n          subtitleElement.attr('y', subtitleY);\n        }\n      }\n    }\n    titleEl.style('opacity', opacity * Color.opacity(fontColor)).call(Drawing.font, {\n      color: Color.rgb(fontColor),\n      size: d3.round(fontSize, 2),\n      family: fontFamily,\n      weight: fontWeight,\n      style: fontStyle,\n      variant: fontVariant,\n      textcase: fontTextcase,\n      shadow: fontShadow,\n      lineposition: fontLineposition\n    }).attr(attributes).call(svgTextUtils.convertToTspans, gd, adjustSubtitlePosition);\n    if (subtitleEl) {\n      // Set subtitle y position based on bottom of title\n      // We need to check the Mathjax group as well, in case the Mathjax\n      // has already rendered\n      var titleElMathGroup = group.select('.' + titleClass + '-math-group');\n      var titleElBbox = titleEl.node().getBBox();\n      var titleElMathBbox = titleElMathGroup.node() ? titleElMathGroup.node().getBBox() : undefined;\n      var subtitleY = titleElMathBbox ? titleElMathBbox.y + titleElMathBbox.height + SUBTITLE_PADDING_MATHJAX_EM * subFontSize : titleElBbox.y + titleElBbox.height + SUBTITLE_PADDING_EM * subFontSize;\n      var subtitleAttributes = Lib.extendFlat({}, attributes, {\n        y: subtitleY\n      });\n      subtitleEl.attr('transform', transformVal);\n      subtitleEl.style('opacity', subtitleOpacity * Color.opacity(subFontColor)).call(Drawing.font, {\n        color: Color.rgb(subFontColor),\n        size: d3.round(subFontSize, 2),\n        family: subFontFamily,\n        weight: subFontWeight,\n        style: subFontStyle,\n        variant: subFontVariant,\n        textcase: subFontTextcase,\n        shadow: subFontShadow,\n        lineposition: subFontLineposition\n      }).attr(subtitleAttributes).call(svgTextUtils.convertToTspans, gd);\n    }\n    return Plots.previousPromises(gd);\n  }\n  function scootTitle(titleAndSubtitleEls) {\n    var titleElIn = titleAndSubtitleEls.title;\n    var titleGroup = d3.select(titleElIn.node().parentNode);\n    if (avoid && avoid.selection && avoid.side && txt) {\n      titleGroup.attr('transform', null);\n\n      // move toward avoid.side (= left, right, top, bottom) if needed\n      // can include pad (pixels, default 2)\n      var backside = OPPOSITE_SIDE[avoid.side];\n      var shiftSign = avoid.side === 'left' || avoid.side === 'top' ? -1 : 1;\n      var pad = isNumeric(avoid.pad) ? avoid.pad : 2;\n      var titlebb = Drawing.bBox(titleGroup.node());\n\n      // Account for reservedMargins\n      var reservedMargins = {\n        t: 0,\n        b: 0,\n        l: 0,\n        r: 0\n      };\n      var margins = gd._fullLayout._reservedMargin;\n      for (var key in margins) {\n        for (var side in margins[key]) {\n          var val = margins[key][side];\n          reservedMargins[side] = Math.max(reservedMargins[side], val);\n        }\n      }\n      var paperbb = {\n        left: reservedMargins.l,\n        top: reservedMargins.t,\n        right: fullLayout.width - reservedMargins.r,\n        bottom: fullLayout.height - reservedMargins.b\n      };\n      var maxshift = avoid.maxShift || shiftSign * (paperbb[avoid.side] - titlebb[avoid.side]);\n      var shift = 0;\n\n      // Prevent the title going off the paper\n      if (maxshift < 0) {\n        shift = maxshift;\n      } else {\n        // so we don't have to offset each avoided element,\n        // give the title the opposite offset\n        var offsetLeft = avoid.offsetLeft || 0;\n        var offsetTop = avoid.offsetTop || 0;\n        titlebb.left -= offsetLeft;\n        titlebb.right -= offsetLeft;\n        titlebb.top -= offsetTop;\n        titlebb.bottom -= offsetTop;\n\n        // iterate over a set of elements (avoid.selection)\n        // to avoid collisions with\n        avoid.selection.each(function () {\n          var avoidbb = Drawing.bBox(this);\n          if (Lib.bBoxIntersect(titlebb, avoidbb, pad)) {\n            shift = Math.max(shift, shiftSign * (avoidbb[avoid.side] - titlebb[backside]) + pad);\n          }\n        });\n        shift = Math.min(maxshift, shift);\n        // Keeping track of this for calculation of full axis size if needed\n        cont._titleScoot = Math.abs(shift);\n      }\n      if (shift > 0 || maxshift < 0) {\n        var shiftTemplate = {\n          left: [-shift, 0],\n          right: [shift, 0],\n          top: [0, -shift],\n          bottom: [0, shift]\n        }[avoid.side];\n        titleGroup.attr('transform', strTranslate(shiftTemplate[0], shiftTemplate[1]));\n      }\n    }\n  }\n  el.call(titleLayout, subtitleEl);\n  function setPlaceholder(element, placeholderText) {\n    element.text(placeholderText).on('mouseover.opacity', function () {\n      d3.select(this).transition().duration(interactConstants.SHOW_PLACEHOLDER).style('opacity', 1);\n    }).on('mouseout.opacity', function () {\n      d3.select(this).transition().duration(interactConstants.HIDE_PLACEHOLDER).style('opacity', 0);\n    });\n  }\n  if (editable) {\n    if (!txt) {\n      setPlaceholder(el, placeholder);\n      titleIsPlaceholder = true;\n    } else el.on('.opacity', null);\n    el.call(svgTextUtils.makeEditable, {\n      gd: gd\n    }).on('edit', function (text) {\n      if (traceIndex !== undefined) {\n        Registry.call('_guiRestyle', gd, prop, text, traceIndex);\n      } else {\n        Registry.call('_guiRelayout', gd, prop, text);\n      }\n    }).on('cancel', function () {\n      this.text(this.attr('data-unformatted')).call(titleLayout);\n    }).on('input', function (d) {\n      this.text(d || ' ').call(svgTextUtils.positionText, attributes.x, attributes.y);\n    });\n    if (subtitleEnabled) {\n      // Adjust subtitle position now that title placeholder has been added\n      // Only adjust if subtitle is enabled and title text was originally empty\n      if (subtitleEnabled && !txt) {\n        var titleElBbox = el.node().getBBox();\n        var subtitleY = titleElBbox.y + titleElBbox.height + SUBTITLE_PADDING_EM * subFontSize;\n        subtitleEl.attr('y', subtitleY);\n      }\n      if (!subtitleTxt) {\n        setPlaceholder(subtitleEl, subtitlePlaceholder);\n        subtitleIsPlaceholder = true;\n      } else subtitleEl.on('.opacity', null);\n      subtitleEl.call(svgTextUtils.makeEditable, {\n        gd: gd\n      }).on('edit', function (text) {\n        Registry.call('_guiRelayout', gd, 'title.subtitle.text', text);\n      }).on('cancel', function () {\n        this.text(this.attr('data-unformatted')).call(titleLayout);\n      }).on('input', function (d) {\n        this.text(d || ' ').call(svgTextUtils.positionText, subtitleEl.attr('x'), subtitleEl.attr('y'));\n      });\n    }\n  }\n  el.classed('js-placeholder', titleIsPlaceholder);\n  if (subtitleEl) subtitleEl.classed('js-placeholder', subtitleIsPlaceholder);\n  return group;\n}\nmodule.exports = {\n  draw: draw,\n  SUBTITLE_PADDING_EM: SUBTITLE_PADDING_EM,\n  SUBTITLE_PADDING_MATHJAX_EM: SUBTITLE_PADDING_MATHJAX_EM\n};","map":{"version":3,"names":["d3","require","isNumeric","Plots","Registry","Lib","strTranslate","Drawing","Color","svgTextUtils","interactConstants","OPPOSITE_SIDE","numStripRE","SUBTITLE_PADDING_MATHJAX_EM","SUBTITLE_PADDING_EM","draw","gd","titleClass","options","fullLayout","_fullLayout","cont","propContainer","prop","propName","placeholder","traceIndex","avoid","attributes","transform","group","containerGroup","opacity","title","txt","text","trim","titleIsPlaceholder","font","fontFamily","family","fontSize","size","fontColor","color","fontWeight","weight","fontStyle","style","fontVariant","variant","fontTextcase","textcase","fontLineposition","lineposition","fontShadow","shadow","subtitleProp","subtitlePropName","subtitleEnabled","subtitlePlaceholder","subtitle","subtitleTxt","subtitleIsPlaceholder","subtitleOpacity","subtitleFont","subFontFamily","subFontSize","subFontColor","subFontWeight","subFontStyle","subFontVariant","subFontTextcase","subFontLineposition","subFontShadow","editAttr","indexOf","editable","_context","edits","matchesPlaceholder","undefined","replace","_meta","templateString","elShouldExist","hColorbarMoveTitle","ensureSingle","_infolayer","_hColorbarMoveTitle","el","selectAll","data","enter","append","attr","exit","remove","subtitleEl","subtitleClass","subtitleElShouldExist","titleLayout","titleEl","syncOrAsync","drawTitle","scootTitle","titleAndSubtitleEls","transformVal","rotate","x","y","offset","adjustSubtitlePosition","titleElMathGroup","subtitleElement","select","node","parentNode","empty","titleElMathBbox","getBBox","height","subtitleY","call","rgb","round","convertToTspans","titleElBbox","subtitleAttributes","extendFlat","previousPromises","titleElIn","titleGroup","selection","side","backside","shiftSign","pad","titlebb","bBox","reservedMargins","t","b","l","r","margins","_reservedMargin","key","val","Math","max","paperbb","left","top","right","width","bottom","maxshift","maxShift","shift","offsetLeft","offsetTop","each","avoidbb","bBoxIntersect","min","_titleScoot","abs","shiftTemplate","setPlaceholder","element","placeholderText","on","transition","duration","SHOW_PLACEHOLDER","HIDE_PLACEHOLDER","makeEditable","d","positionText","classed","module","exports"],"sources":["E:/tog_workspace/TestFabric_main/TestFabric-main/node_modules/plotly.js/src/components/titles/index.js"],"sourcesContent":["'use strict';\n\nvar d3 = require('@plotly/d3');\nvar isNumeric = require('fast-isnumeric');\n\nvar Plots = require('../../plots/plots');\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar interactConstants = require('../../constants/interactions');\n\nvar OPPOSITE_SIDE = require('../../constants/alignment').OPPOSITE_SIDE;\nvar numStripRE = / [XY][0-9]* /;\nvar SUBTITLE_PADDING_MATHJAX_EM = 1.6;\nvar SUBTITLE_PADDING_EM = 1.6;\n\n/**\n * Titles - (re)draw titles on the axes and plot:\n * @param {DOM element} gd - the graphDiv\n * @param {string} titleClass - the css class of this title\n * @param {object} options - how and what to draw\n *      propContainer - the layout object containing `title` and `titlefont`\n *          attributes that apply to this title\n *      propName - the full name of the title property (for Plotly.relayout)\n *      [traceIndex] - include only if this property applies to one trace\n *          (such as a colorbar title) - then editing pipes to Plotly.restyle\n *          instead of Plotly.relayout\n *      placeholder - placeholder text for an empty editable title\n *      [avoid] {object} - include if this title should move to avoid other elements\n *          selection - d3 selection of elements to avoid\n *          side - which direction to move if there is a conflict\n *          [offsetLeft] - if these elements are subject to a translation\n *              wrt the title element\n *          [offsetTop]\n *      attributes {object} - position and alignment attributes\n *          x - pixels\n *          y - pixels\n *          text-anchor - start|middle|end\n *      transform {object} - how to transform the title after positioning\n *          rotate - degrees\n *          offset - shift up/down in the rotated frame (unused?)\n *      containerGroup - if an svg <g> element already exists to hold this\n *          title, include here. Otherwise it will go in fullLayout._infolayer\n *      _meta {object (optional} - meta key-value to for title with\n *          Lib.templateString, default to fullLayout._meta, if not provided\n *\n *  @return {selection} d3 selection of title container group\n */\nfunction draw(gd, titleClass, options) {\n    var fullLayout = gd._fullLayout;\n\n    var cont = options.propContainer;\n    var prop = options.propName;\n    var placeholder = options.placeholder;\n    var traceIndex = options.traceIndex;\n    var avoid = options.avoid || {};\n    var attributes = options.attributes;\n    var transform = options.transform;\n    var group = options.containerGroup;\n    var opacity = 1;\n    var title = cont.title;\n    var txt = (title && title.text ? title.text : '').trim();\n    var titleIsPlaceholder = false;\n\n    var font = title && title.font ? title.font : {};\n    var fontFamily = font.family;\n    var fontSize = font.size;\n    var fontColor = font.color;\n    var fontWeight = font.weight;\n    var fontStyle = font.style;\n    var fontVariant = font.variant;\n    var fontTextcase = font.textcase;\n    var fontLineposition = font.lineposition;\n    var fontShadow = font.shadow;\n\n    // Get subtitle properties\n    var subtitleProp = options.subtitlePropName;\n    var subtitleEnabled = !!subtitleProp;\n    var subtitlePlaceholder = options.subtitlePlaceholder;\n    var subtitle = (cont.title || {}).subtitle || {text: '', font: {}};\n    var subtitleTxt = subtitle.text.trim();\n    var subtitleIsPlaceholder = false;\n    var subtitleOpacity = 1;\n\n    var subtitleFont = subtitle.font;\n    var subFontFamily = subtitleFont.family;\n    var subFontSize = subtitleFont.size;\n    var subFontColor = subtitleFont.color;\n    var subFontWeight = subtitleFont.weight;\n    var subFontStyle = subtitleFont.style;\n    var subFontVariant = subtitleFont.variant;\n    var subFontTextcase = subtitleFont.textcase;\n    var subFontLineposition = subtitleFont.lineposition;\n    var subFontShadow = subtitleFont.shadow;\n\n    // only make this title editable if we positively identify its property\n    // as one that has editing enabled.\n    // Subtitle is editable if and only if title is editable\n    var editAttr;\n    if(prop === 'title.text') editAttr = 'titleText';\n    else if(prop.indexOf('axis') !== -1) editAttr = 'axisTitleText';\n    else if(prop.indexOf('colorbar' !== -1)) editAttr = 'colorbarTitleText';\n    var editable = gd._context.edits[editAttr];\n\n    function matchesPlaceholder(text, placeholder) {\n        if(text === undefined || placeholder === undefined) return false;\n        // look for placeholder text while stripping out numbers from eg X2, Y3\n        // this is just for backward compatibility with the old version that had\n        // \"Click to enter X2 title\" and may have gotten saved in some old plots,\n        // we don't want this to show up when these are displayed.\n        return text.replace(numStripRE, ' % ') === placeholder.replace(numStripRE, ' % ');\n    }\n\n    if(txt === '') opacity = 0;\n    else if(matchesPlaceholder(txt, placeholder)) {\n        if(!editable) txt = '';\n        opacity = 0.2;\n        titleIsPlaceholder = true;\n    }\n\n    if(subtitleEnabled) {\n        if(subtitleTxt === '') subtitleOpacity = 0;\n        else if(matchesPlaceholder(subtitleTxt, subtitlePlaceholder)) {\n            if(!editable) subtitleTxt = '';\n            subtitleOpacity = 0.2;\n            subtitleIsPlaceholder = true;\n        }\n    }\n\n    if(options._meta) {\n        txt = Lib.templateString(txt, options._meta);\n    } else if(fullLayout._meta) {\n        txt = Lib.templateString(txt, fullLayout._meta);\n    }\n\n    var elShouldExist = txt || subtitleTxt || editable;\n\n    var hColorbarMoveTitle;\n    if(!group) {\n        group = Lib.ensureSingle(fullLayout._infolayer, 'g', 'g-' + titleClass);\n        hColorbarMoveTitle = fullLayout._hColorbarMoveTitle;\n    }\n\n    var el = group.selectAll('text.' + titleClass)\n        .data(elShouldExist ? [0] : []);\n    el.enter().append('text');\n    el.text(txt)\n        // this is hacky, but convertToTspans uses the class\n        // to determine whether to rotate mathJax...\n        // so we need to clear out any old class and put the\n        // correct one (only relevant for colorbars, at least\n        // for now) - ie don't use .classed\n        .attr('class', titleClass);\n    el.exit().remove();\n\n    var subtitleEl = null;\n    var subtitleClass = titleClass + '-subtitle';\n    var subtitleElShouldExist = subtitleTxt || editable;\n\n    if(subtitleEnabled && subtitleElShouldExist) {\n        subtitleEl = group.selectAll('text.' + subtitleClass)\n            .data(subtitleElShouldExist ? [0] : []);\n        subtitleEl.enter().append('text');\n        subtitleEl.text(subtitleTxt).attr('class', subtitleClass);\n        subtitleEl.exit().remove();\n    }\n\n\n    if(!elShouldExist) return group;\n\n    function titleLayout(titleEl, subtitleEl) {\n        Lib.syncOrAsync([drawTitle, scootTitle], { title: titleEl, subtitle: subtitleEl });\n    }\n\n    function drawTitle(titleAndSubtitleEls) {\n        var titleEl = titleAndSubtitleEls.title;\n        var subtitleEl = titleAndSubtitleEls.subtitle;\n\n        var transformVal;\n\n        if(!transform && hColorbarMoveTitle) {\n            transform = {};\n        }\n\n        if(transform) {\n            transformVal = '';\n            if(transform.rotate) {\n                transformVal += 'rotate(' + [transform.rotate, attributes.x, attributes.y] + ')';\n            }\n            if(transform.offset || hColorbarMoveTitle) {\n                transformVal += strTranslate(0, (transform.offset || 0) - (hColorbarMoveTitle || 0));\n            }\n        } else {\n            transformVal = null;\n        }\n\n        titleEl.attr('transform', transformVal);\n\n        // Callback to adjust the subtitle position after mathjax is rendered\n        // Mathjax is rendered asynchronously, which is why this step needs to be\n        // passed as a callback\n        function adjustSubtitlePosition(titleElMathGroup) {\n            if(!titleElMathGroup) return;\n\n            var subtitleElement = d3.select(titleElMathGroup.node().parentNode).select('.' + subtitleClass);\n            if(!subtitleElement.empty()) {\n                var titleElMathBbox = titleElMathGroup.node().getBBox();\n                if(titleElMathBbox.height) {\n                    // Position subtitle based on bottom of Mathjax title\n                    var subtitleY = titleElMathBbox.y + titleElMathBbox.height + (SUBTITLE_PADDING_MATHJAX_EM * subFontSize);\n                    subtitleElement.attr('y', subtitleY);\n                }\n            }\n        }\n\n        titleEl.style('opacity', opacity * Color.opacity(fontColor))\n        .call(Drawing.font, {\n            color: Color.rgb(fontColor),\n            size: d3.round(fontSize, 2),\n            family: fontFamily,\n            weight: fontWeight,\n            style: fontStyle,\n            variant: fontVariant,\n            textcase: fontTextcase,\n            shadow: fontShadow,\n            lineposition: fontLineposition,\n        })\n        .attr(attributes)\n            .call(svgTextUtils.convertToTspans, gd, adjustSubtitlePosition);\n\n        if(subtitleEl) {\n            // Set subtitle y position based on bottom of title\n            // We need to check the Mathjax group as well, in case the Mathjax\n            // has already rendered\n            var titleElMathGroup = group.select('.' + titleClass + '-math-group');\n            var titleElBbox = titleEl.node().getBBox();\n            var titleElMathBbox = titleElMathGroup.node() ? titleElMathGroup.node().getBBox() : undefined;\n            var subtitleY = titleElMathBbox ? titleElMathBbox.y + titleElMathBbox.height + (SUBTITLE_PADDING_MATHJAX_EM * subFontSize) : titleElBbox.y + titleElBbox.height + (SUBTITLE_PADDING_EM * subFontSize);\n\n            var subtitleAttributes = Lib.extendFlat({}, attributes, {\n                y: subtitleY\n            });\n\n            subtitleEl.attr('transform', transformVal);\n            subtitleEl.style('opacity', subtitleOpacity * Color.opacity(subFontColor))\n            .call(Drawing.font, {\n                color: Color.rgb(subFontColor),\n                size: d3.round(subFontSize, 2),\n                family: subFontFamily,\n                weight: subFontWeight,\n                style: subFontStyle,\n                variant: subFontVariant,\n                textcase: subFontTextcase,\n                shadow: subFontShadow,\n                lineposition: subFontLineposition,\n            })\n            .attr(subtitleAttributes)\n                .call(svgTextUtils.convertToTspans, gd);\n        }\n\n        return Plots.previousPromises(gd);\n    }\n\n    function scootTitle(titleAndSubtitleEls) {\n        var titleElIn = titleAndSubtitleEls.title;\n        var titleGroup = d3.select(titleElIn.node().parentNode);\n\n        if(avoid && avoid.selection && avoid.side && txt) {\n            titleGroup.attr('transform', null);\n\n            // move toward avoid.side (= left, right, top, bottom) if needed\n            // can include pad (pixels, default 2)\n            var backside = OPPOSITE_SIDE[avoid.side];\n            var shiftSign = (avoid.side === 'left' || avoid.side === 'top') ? -1 : 1;\n            var pad = isNumeric(avoid.pad) ? avoid.pad : 2;\n\n            var titlebb = Drawing.bBox(titleGroup.node());\n\n            // Account for reservedMargins\n            var reservedMargins = {t: 0, b: 0, l: 0, r: 0};\n            var margins = gd._fullLayout._reservedMargin;\n            for(var key in margins) {\n                for(var side in margins[key]) {\n                    var val = margins[key][side];\n                    reservedMargins[side] = Math.max(reservedMargins[side], val);\n                }\n            }\n            var paperbb = {\n                left: reservedMargins.l,\n                top: reservedMargins.t,\n                right: fullLayout.width - reservedMargins.r,\n                bottom: fullLayout.height - reservedMargins.b\n            };\n\n            var maxshift = avoid.maxShift ||\n                shiftSign * (paperbb[avoid.side] - titlebb[avoid.side]);\n            var shift = 0;\n\n            // Prevent the title going off the paper\n            if(maxshift < 0) {\n                shift = maxshift;\n            } else {\n                // so we don't have to offset each avoided element,\n                // give the title the opposite offset\n                var offsetLeft = avoid.offsetLeft || 0;\n                var offsetTop = avoid.offsetTop || 0;\n                titlebb.left -= offsetLeft;\n                titlebb.right -= offsetLeft;\n                titlebb.top -= offsetTop;\n                titlebb.bottom -= offsetTop;\n\n                // iterate over a set of elements (avoid.selection)\n                // to avoid collisions with\n                avoid.selection.each(function() {\n                    var avoidbb = Drawing.bBox(this);\n\n                    if(Lib.bBoxIntersect(titlebb, avoidbb, pad)) {\n                        shift = Math.max(shift, shiftSign * (\n                            avoidbb[avoid.side] - titlebb[backside]) + pad);\n                    }\n                });\n                shift = Math.min(maxshift, shift);\n                // Keeping track of this for calculation of full axis size if needed\n                cont._titleScoot = Math.abs(shift);\n            }\n\n            if(shift > 0 || maxshift < 0) {\n                var shiftTemplate = {\n                    left: [-shift, 0],\n                    right: [shift, 0],\n                    top: [0, -shift],\n                    bottom: [0, shift]\n                }[avoid.side];\n                titleGroup.attr('transform', strTranslate(shiftTemplate[0], shiftTemplate[1]));\n            }\n        }\n    }\n\n    el.call(titleLayout, subtitleEl);\n\n    function setPlaceholder(element, placeholderText) {\n        element.text(placeholderText)\n            .on('mouseover.opacity', function() {\n                d3.select(this).transition()\n                    .duration(interactConstants.SHOW_PLACEHOLDER).style('opacity', 1);\n            })\n            .on('mouseout.opacity', function() {\n                d3.select(this).transition()\n                    .duration(interactConstants.HIDE_PLACEHOLDER).style('opacity', 0);\n            });\n    }\n\n    if(editable) {\n        if(!txt) {\n            setPlaceholder(el, placeholder);\n            titleIsPlaceholder = true;\n        } else el.on('.opacity', null);\n\n        el.call(svgTextUtils.makeEditable, {gd: gd})\n            .on('edit', function(text) {\n                if(traceIndex !== undefined) {\n                    Registry.call('_guiRestyle', gd, prop, text, traceIndex);\n                } else {\n                    Registry.call('_guiRelayout', gd, prop, text);\n                }\n            })\n            .on('cancel', function() {\n                this.text(this.attr('data-unformatted'))\n                    .call(titleLayout);\n            })\n            .on('input', function(d) {\n                this.text(d || ' ')\n                    .call(svgTextUtils.positionText, attributes.x, attributes.y);\n            });\n\n        if(subtitleEnabled) {\n            // Adjust subtitle position now that title placeholder has been added\n            // Only adjust if subtitle is enabled and title text was originally empty\n            if(subtitleEnabled && !txt) {\n                var titleElBbox = el.node().getBBox();\n                var subtitleY = titleElBbox.y + titleElBbox.height + (SUBTITLE_PADDING_EM * subFontSize);\n                subtitleEl.attr('y', subtitleY);\n            }\n\n            if(!subtitleTxt) {\n                setPlaceholder(subtitleEl, subtitlePlaceholder);\n                subtitleIsPlaceholder = true;\n            } else subtitleEl.on('.opacity', null);\n            subtitleEl.call(svgTextUtils.makeEditable, {gd: gd})\n                .on('edit', function(text) {\n                    Registry.call('_guiRelayout', gd, 'title.subtitle.text', text);\n                })\n                .on('cancel', function() {\n                    this.text(this.attr('data-unformatted'))\n                        .call(titleLayout);\n                })\n                .on('input', function(d) {\n                    this.text(d || ' ')\n                        .call(svgTextUtils.positionText, subtitleEl.attr('x'), subtitleEl.attr('y'));\n                });\n        }\n    }\n\n    el.classed('js-placeholder', titleIsPlaceholder);\n    if(subtitleEl) subtitleEl.classed('js-placeholder', subtitleIsPlaceholder);\n\n    return group;\n}\n\nmodule.exports = {\n    draw: draw,\n    SUBTITLE_PADDING_EM: SUBTITLE_PADDING_EM,\n    SUBTITLE_PADDING_MATHJAX_EM: SUBTITLE_PADDING_MATHJAX_EM,\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}