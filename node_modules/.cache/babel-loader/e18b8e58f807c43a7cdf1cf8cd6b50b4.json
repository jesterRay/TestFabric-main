{"ast":null,"code":"'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar extractOpts = require('../colorscale/helpers').extractOpts;\nvar subTypes = require('../../traces/scatter/subtypes');\nvar stylePie = require('../../traces/pie/style_one');\nvar pieCastOption = require('../../traces/pie/helpers').castOption;\nvar constants = require('./constants');\nvar CST_MARKER_SIZE = 12;\nvar CST_LINE_WIDTH = 5;\nvar CST_MARKER_LINE_WIDTH = 2;\nvar MAX_LINE_WIDTH = 10;\nvar MAX_MARKER_LINE_WIDTH = 5;\nmodule.exports = function style(s, gd, legend) {\n  var fullLayout = gd._fullLayout;\n  if (!legend) legend = fullLayout.legend;\n  var constantItemSizing = legend.itemsizing === 'constant';\n  var itemWidth = legend.itemwidth;\n  var centerPos = (itemWidth + constants.itemGap * 2) / 2;\n  var centerTransform = strTranslate(centerPos, 0);\n  var boundLineWidth = function (mlw, cont, max, cst) {\n    var v;\n    if (mlw + 1) {\n      v = mlw;\n    } else if (cont && cont.width > 0) {\n      v = cont.width;\n    } else {\n      return 0;\n    }\n    return constantItemSizing ? cst : Math.min(v, max);\n  };\n  s.each(function (d) {\n    var traceGroup = d3.select(this);\n    var layers = Lib.ensureSingle(traceGroup, 'g', 'layers');\n    layers.style('opacity', d[0].trace.opacity);\n    var indentation = legend.indentation;\n    var valign = legend.valign;\n    var lineHeight = d[0].lineHeight;\n    var height = d[0].height;\n    if (valign === 'middle' && indentation === 0 || !lineHeight || !height) {\n      layers.attr('transform', null);\n    } else {\n      var factor = {\n        top: 1,\n        bottom: -1\n      }[valign];\n      var markerOffsetY = factor * (0.5 * (lineHeight - height + 3)) || 0;\n      var markerOffsetX = legend.indentation;\n      layers.attr('transform', strTranslate(markerOffsetX, markerOffsetY));\n    }\n    var fill = layers.selectAll('g.legendfill').data([d]);\n    fill.enter().append('g').classed('legendfill', true);\n    var line = layers.selectAll('g.legendlines').data([d]);\n    line.enter().append('g').classed('legendlines', true);\n    var symbol = layers.selectAll('g.legendsymbols').data([d]);\n    symbol.enter().append('g').classed('legendsymbols', true);\n    symbol.selectAll('g.legendpoints').data([d]).enter().append('g').classed('legendpoints', true);\n  }).each(styleSpatial).each(styleWaterfalls).each(styleFunnels).each(styleBars).each(styleBoxes).each(styleFunnelareas).each(stylePies).each(styleLines).each(stylePoints).each(styleCandles).each(styleOHLC);\n  function styleLines(d) {\n    var styleGuide = getStyleGuide(d);\n    var showFill = styleGuide.showFill;\n    var showLine = styleGuide.showLine;\n    var showGradientLine = styleGuide.showGradientLine;\n    var showGradientFill = styleGuide.showGradientFill;\n    var anyFill = styleGuide.anyFill;\n    var anyLine = styleGuide.anyLine;\n    var d0 = d[0];\n    var trace = d0.trace;\n    var dMod, tMod;\n    var cOpts = extractOpts(trace);\n    var colorscale = cOpts.colorscale;\n    var reversescale = cOpts.reversescale;\n    var fillStyle = function (s) {\n      if (s.size()) {\n        if (showFill) {\n          Drawing.fillGroupStyle(s, gd, true);\n        } else {\n          var gradientID = 'legendfill-' + trace.uid;\n          Drawing.gradient(s, gd, gradientID, getGradientDirection(reversescale), colorscale, 'fill');\n        }\n      }\n    };\n    var lineGradient = function (s) {\n      if (s.size()) {\n        var gradientID = 'legendline-' + trace.uid;\n        Drawing.lineGroupStyle(s);\n        Drawing.gradient(s, gd, gradientID, getGradientDirection(reversescale), colorscale, 'stroke');\n      }\n    };\n\n    // with fill and no markers or text, move the line and fill up a bit\n    // so it's more centered\n\n    var pathStart = subTypes.hasMarkers(trace) || !anyFill ? 'M5,0' :\n    // with a line leave it slightly below center, to leave room for the\n    // line thickness and because the line is usually more prominent\n    anyLine ? 'M5,-2' : 'M5,-3';\n    var this3 = d3.select(this);\n    var fill = this3.select('.legendfill').selectAll('path').data(showFill || showGradientFill ? [d] : []);\n    fill.enter().append('path').classed('js-fill', true);\n    fill.exit().remove();\n    fill.attr('d', pathStart + 'h' + itemWidth + 'v6h-' + itemWidth + 'z').call(fillStyle);\n    if (showLine || showGradientLine) {\n      var lw = boundLineWidth(undefined, trace.line, MAX_LINE_WIDTH, CST_LINE_WIDTH);\n      tMod = Lib.minExtend(trace, {\n        line: {\n          width: lw\n        }\n      });\n      dMod = [Lib.minExtend(d0, {\n        trace: tMod\n      })];\n    }\n    var line = this3.select('.legendlines').selectAll('path').data(showLine || showGradientLine ? [dMod] : []);\n    line.enter().append('path').classed('js-line', true);\n    line.exit().remove();\n\n    // this is ugly... but you can't apply a gradient to a perfectly\n    // horizontal or vertical line. Presumably because then\n    // the system doesn't know how to scale vertical variation, even\n    // though there *is* no vertical variation in this case.\n    // so add an invisibly small angle to the line\n    // This issue (and workaround) exist across (Mac) Chrome, FF, and Safari\n    line.attr('d', pathStart + (showGradientLine ? 'l' + itemWidth + ',0.0001' : 'h' + itemWidth)).call(showLine ? Drawing.lineGroupStyle : lineGradient);\n  }\n  function stylePoints(d) {\n    var styleGuide = getStyleGuide(d);\n    var anyFill = styleGuide.anyFill;\n    var anyLine = styleGuide.anyLine;\n    var showLine = styleGuide.showLine;\n    var showMarker = styleGuide.showMarker;\n    var d0 = d[0];\n    var trace = d0.trace;\n    var showText = !showMarker && !anyLine && !anyFill && subTypes.hasText(trace);\n    var dMod, tMod;\n\n    // 'scatter3d' don't use gd.calcdata,\n    // use d0.trace to infer arrayOk attributes\n\n    function boundVal(attrIn, arrayToValFn, bounds, cst) {\n      var valIn = Lib.nestedProperty(trace, attrIn).get();\n      var valToBound = Lib.isArrayOrTypedArray(valIn) && arrayToValFn ? arrayToValFn(valIn) : valIn;\n      if (constantItemSizing && valToBound && cst !== undefined) {\n        valToBound = cst;\n      }\n      if (bounds) {\n        if (valToBound < bounds[0]) return bounds[0];else if (valToBound > bounds[1]) return bounds[1];\n      }\n      return valToBound;\n    }\n    function pickFirst(array) {\n      if (d0._distinct && d0.index && array[d0.index]) return array[d0.index];\n      return array[0];\n    }\n\n    // constrain text, markers, etc so they'll fit on the legend\n    if (showMarker || showText || showLine) {\n      var dEdit = {};\n      var tEdit = {};\n      if (showMarker) {\n        dEdit.mc = boundVal('marker.color', pickFirst);\n        dEdit.mx = boundVal('marker.symbol', pickFirst);\n        dEdit.mo = boundVal('marker.opacity', Lib.mean, [0.2, 1]);\n        dEdit.mlc = boundVal('marker.line.color', pickFirst);\n        dEdit.mlw = boundVal('marker.line.width', Lib.mean, [0, 5], CST_MARKER_LINE_WIDTH);\n        tEdit.marker = {\n          sizeref: 1,\n          sizemin: 1,\n          sizemode: 'diameter'\n        };\n        var ms = boundVal('marker.size', Lib.mean, [2, 16], CST_MARKER_SIZE);\n        dEdit.ms = ms;\n        tEdit.marker.size = ms;\n      }\n      if (showLine) {\n        tEdit.line = {\n          width: boundVal('line.width', pickFirst, [0, 10], CST_LINE_WIDTH)\n        };\n      }\n      if (showText) {\n        dEdit.tx = 'Aa';\n        dEdit.tp = boundVal('textposition', pickFirst);\n        dEdit.ts = 10;\n        dEdit.tc = boundVal('textfont.color', pickFirst);\n        dEdit.tf = boundVal('textfont.family', pickFirst);\n        dEdit.tw = boundVal('textfont.weight', pickFirst);\n        dEdit.ty = boundVal('textfont.style', pickFirst);\n        dEdit.tv = boundVal('textfont.variant', pickFirst);\n        dEdit.tC = boundVal('textfont.textcase', pickFirst);\n        dEdit.tE = boundVal('textfont.lineposition', pickFirst);\n        dEdit.tS = boundVal('textfont.shadow', pickFirst);\n      }\n      dMod = [Lib.minExtend(d0, dEdit)];\n      tMod = Lib.minExtend(trace, tEdit);\n\n      // always show legend items in base state\n      tMod.selectedpoints = null;\n\n      // never show texttemplate\n      tMod.texttemplate = null;\n    }\n    var ptgroup = d3.select(this).select('g.legendpoints');\n    var pts = ptgroup.selectAll('path.scatterpts').data(showMarker ? dMod : []);\n    // make sure marker is on the bottom, in case it enters after text\n    pts.enter().insert('path', ':first-child').classed('scatterpts', true).attr('transform', centerTransform);\n    pts.exit().remove();\n    pts.call(Drawing.pointStyle, tMod, gd);\n\n    // 'mrc' is set in pointStyle and used in textPointStyle:\n    // constrain it here\n    if (showMarker) dMod[0].mrc = 3;\n    var txt = ptgroup.selectAll('g.pointtext').data(showText ? dMod : []);\n    txt.enter().append('g').classed('pointtext', true).append('text').attr('transform', centerTransform);\n    txt.exit().remove();\n    txt.selectAll('text').call(Drawing.textPointStyle, tMod, gd);\n  }\n  function styleWaterfalls(d) {\n    var trace = d[0].trace;\n    var isWaterfall = trace.type === 'waterfall';\n    if (d[0]._distinct && isWaterfall) {\n      var cont = d[0].trace[d[0].dir].marker;\n      d[0].mc = cont.color;\n      d[0].mlw = cont.line.width;\n      d[0].mlc = cont.line.color;\n      return styleBarLike(d, this, 'waterfall');\n    }\n    var ptsData = [];\n    if (trace.visible && isWaterfall) {\n      ptsData = d[0].hasTotals ? [['increasing', 'M-6,-6V6H0Z'], ['totals', 'M6,6H0L-6,-6H-0Z'], ['decreasing', 'M6,6V-6H0Z']] : [['increasing', 'M-6,-6V6H6Z'], ['decreasing', 'M6,6V-6H-6Z']];\n    }\n    var pts = d3.select(this).select('g.legendpoints').selectAll('path.legendwaterfall').data(ptsData);\n    pts.enter().append('path').classed('legendwaterfall', true).attr('transform', centerTransform).style('stroke-miterlimit', 1);\n    pts.exit().remove();\n    pts.each(function (dd) {\n      var pt = d3.select(this);\n      var cont = trace[dd[0]].marker;\n      var lw = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n      pt.attr('d', dd[1]).style('stroke-width', lw + 'px').call(Color.fill, cont.color);\n      if (lw) {\n        pt.call(Color.stroke, cont.line.color);\n      }\n    });\n  }\n  function styleBars(d) {\n    styleBarLike(d, this);\n  }\n  function styleFunnels(d) {\n    styleBarLike(d, this, 'funnel');\n  }\n  function styleBarLike(d, lThis, desiredType) {\n    var trace = d[0].trace;\n    var marker = trace.marker || {};\n    var markerLine = marker.line || {};\n\n    // If bar has rounded corners, round corners of legend icon\n    var pathStr = marker.cornerradius ? 'M6,3a3,3,0,0,1-3,3H-3a3,3,0,0,1-3-3V-3a3,3,0,0,1,3-3H3a3,3,0,0,1,3,3Z' :\n    // Square with rounded corners\n    'M6,6H-6V-6H6Z'; // Normal square\n\n    var isVisible = !desiredType ? Registry.traceIs(trace, 'bar') : trace.visible && trace.type === desiredType;\n    var barpath = d3.select(lThis).select('g.legendpoints').selectAll('path.legend' + desiredType).data(isVisible ? [d] : []);\n    barpath.enter().append('path').classed('legend' + desiredType, true).attr('d', pathStr).attr('transform', centerTransform);\n    barpath.exit().remove();\n    barpath.each(function (d) {\n      var p = d3.select(this);\n      var d0 = d[0];\n      var w = boundLineWidth(d0.mlw, marker.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n      p.style('stroke-width', w + 'px');\n      var mcc = d0.mcc;\n      if (!legend._inHover && 'mc' in d0) {\n        // not in unified hover but\n        // for legend use the color in the middle of scale\n        var cOpts = extractOpts(marker);\n        var mid = cOpts.mid;\n        if (mid === undefined) mid = (cOpts.max + cOpts.min) / 2;\n        mcc = Drawing.tryColorscale(marker, '')(mid);\n      }\n      var fillColor = mcc || d0.mc || marker.color;\n      var markerPattern = marker.pattern;\n      var patternShape = markerPattern && Drawing.getPatternAttr(markerPattern.shape, 0, '');\n      if (patternShape) {\n        var patternBGColor = Drawing.getPatternAttr(markerPattern.bgcolor, 0, null);\n        var patternFGColor = Drawing.getPatternAttr(markerPattern.fgcolor, 0, null);\n        var patternFGOpacity = markerPattern.fgopacity;\n        var patternSize = dimAttr(markerPattern.size, 8, 10);\n        var patternSolidity = dimAttr(markerPattern.solidity, 0.5, 1);\n        var patternID = 'legend-' + trace.uid;\n        p.call(Drawing.pattern, 'legend', gd, patternID, patternShape, patternSize, patternSolidity, mcc, markerPattern.fillmode, patternBGColor, patternFGColor, patternFGOpacity);\n      } else {\n        p.call(Color.fill, fillColor);\n      }\n      if (w) Color.stroke(p, d0.mlc || markerLine.color);\n    });\n  }\n  function styleBoxes(d) {\n    var trace = d[0].trace;\n    var pts = d3.select(this).select('g.legendpoints').selectAll('path.legendbox').data(trace.visible && Registry.traceIs(trace, 'box-violin') ? [d] : []);\n    pts.enter().append('path').classed('legendbox', true)\n    // if we want the median bar, prepend M6,0H-6\n    .attr('d', 'M6,6H-6V-6H6Z').attr('transform', centerTransform);\n    pts.exit().remove();\n    pts.each(function () {\n      var p = d3.select(this);\n      if ((trace.boxpoints === 'all' || trace.points === 'all') && Color.opacity(trace.fillcolor) === 0 && Color.opacity((trace.line || {}).color) === 0) {\n        var tMod = Lib.minExtend(trace, {\n          marker: {\n            size: constantItemSizing ? CST_MARKER_SIZE : Lib.constrain(trace.marker.size, 2, 16),\n            sizeref: 1,\n            sizemin: 1,\n            sizemode: 'diameter'\n          }\n        });\n        pts.call(Drawing.pointStyle, tMod, gd);\n      } else {\n        var w = boundLineWidth(undefined, trace.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n        p.style('stroke-width', w + 'px').call(Color.fill, trace.fillcolor);\n        if (w) Color.stroke(p, trace.line.color);\n      }\n    });\n  }\n  function styleCandles(d) {\n    var trace = d[0].trace;\n    var pts = d3.select(this).select('g.legendpoints').selectAll('path.legendcandle').data(trace.visible && trace.type === 'candlestick' ? [d, d] : []);\n    pts.enter().append('path').classed('legendcandle', true).attr('d', function (_, i) {\n      if (i) return 'M-15,0H-8M-8,6V-6H8Z'; // increasing\n      return 'M15,0H8M8,-6V6H-8Z'; // decreasing\n    }).attr('transform', centerTransform).style('stroke-miterlimit', 1);\n    pts.exit().remove();\n    pts.each(function (_, i) {\n      var p = d3.select(this);\n      var cont = trace[i ? 'increasing' : 'decreasing'];\n      var w = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n      p.style('stroke-width', w + 'px').call(Color.fill, cont.fillcolor);\n      if (w) Color.stroke(p, cont.line.color);\n    });\n  }\n  function styleOHLC(d) {\n    var trace = d[0].trace;\n    var pts = d3.select(this).select('g.legendpoints').selectAll('path.legendohlc').data(trace.visible && trace.type === 'ohlc' ? [d, d] : []);\n    pts.enter().append('path').classed('legendohlc', true).attr('d', function (_, i) {\n      if (i) return 'M-15,0H0M-8,-6V0'; // increasing\n      return 'M15,0H0M8,6V0'; // decreasing\n    }).attr('transform', centerTransform).style('stroke-miterlimit', 1);\n    pts.exit().remove();\n    pts.each(function (_, i) {\n      var p = d3.select(this);\n      var cont = trace[i ? 'increasing' : 'decreasing'];\n      var w = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n      p.style('fill', 'none').call(Drawing.dashLine, cont.line.dash, w);\n      if (w) Color.stroke(p, cont.line.color);\n    });\n  }\n  function stylePies(d) {\n    stylePieLike(d, this, 'pie');\n  }\n  function styleFunnelareas(d) {\n    stylePieLike(d, this, 'funnelarea');\n  }\n  function stylePieLike(d, lThis, desiredType) {\n    var d0 = d[0];\n    var trace = d0.trace;\n    var isVisible = !desiredType ? Registry.traceIs(trace, desiredType) : trace.visible && trace.type === desiredType;\n    var pts = d3.select(lThis).select('g.legendpoints').selectAll('path.legend' + desiredType).data(isVisible ? [d] : []);\n    pts.enter().append('path').classed('legend' + desiredType, true).attr('d', 'M6,6H-6V-6H6Z').attr('transform', centerTransform);\n    pts.exit().remove();\n    if (pts.size()) {\n      var cont = trace.marker || {};\n      var lw = boundLineWidth(pieCastOption(cont.line.width, d0.pts), cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n      var opt = 'pieLike';\n      var tMod = Lib.minExtend(trace, {\n        marker: {\n          line: {\n            width: lw\n          }\n        }\n      }, opt);\n      var d0Mod = Lib.minExtend(d0, {\n        trace: tMod\n      }, opt);\n      stylePie(pts, d0Mod, tMod, gd);\n    }\n  }\n  function styleSpatial(d) {\n    // i.e. maninly traces having z and colorscale\n    var trace = d[0].trace;\n    var useGradient;\n    var ptsData = [];\n    if (trace.visible) {\n      switch (trace.type) {\n        case 'histogram2d':\n        case 'heatmap':\n          ptsData = [['M-15,-2V4H15V-2Z'] // similar to contour\n          ];\n          useGradient = true;\n          break;\n        case 'choropleth':\n        case 'choroplethmapbox':\n        case 'choroplethmap':\n          ptsData = [['M-6,-6V6H6V-6Z']];\n          useGradient = true;\n          break;\n        case 'densitymapbox':\n        case 'densitymap':\n          ptsData = [['M-6,0 a6,6 0 1,0 12,0 a 6,6 0 1,0 -12,0']];\n          useGradient = 'radial';\n          break;\n        case 'cone':\n          ptsData = [['M-6,2 A2,2 0 0,0 -6,6 V6L6,4Z'], ['M-6,-6 A2,2 0 0,0 -6,-2 L6,-4Z'], ['M-6,-2 A2,2 0 0,0 -6,2 L6,0Z']];\n          useGradient = false;\n          break;\n        case 'streamtube':\n          ptsData = [['M-6,2 A2,2 0 0,0 -6,6 H6 A2,2 0 0,1 6,2 Z'], ['M-6,-6 A2,2 0 0,0 -6,-2 H6 A2,2 0 0,1 6,-6 Z'], ['M-6,-2 A2,2 0 0,0 -6,2 H6 A2,2 0 0,1 6,-2 Z']];\n          useGradient = false;\n          break;\n        case 'surface':\n          ptsData = [['M-6,-6 A2,3 0 0,0 -6,0 H6 A2,3 0 0,1 6,-6 Z'], ['M-6,1 A2,3 0 0,1 -6,6 H6 A2,3 0 0,0 6,0 Z']];\n          useGradient = true;\n          break;\n        case 'mesh3d':\n          ptsData = [['M-6,6H0L-6,-6Z'], ['M6,6H0L6,-6Z'], ['M-6,-6H6L0,6Z']];\n          useGradient = false;\n          break;\n        case 'volume':\n          ptsData = [['M-6,6H0L-6,-6Z'], ['M6,6H0L6,-6Z'], ['M-6,-6H6L0,6Z']];\n          useGradient = true;\n          break;\n        case 'isosurface':\n          ptsData = [['M-6,6H0L-6,-6Z'], ['M6,6H0L6,-6Z'], ['M-6,-6 A12,24 0 0,0 6,-6 L0,6Z']];\n          useGradient = false;\n          break;\n      }\n    }\n    var pts = d3.select(this).select('g.legendpoints').selectAll('path.legend3dandfriends').data(ptsData);\n    pts.enter().append('path').classed('legend3dandfriends', true).attr('transform', centerTransform).style('stroke-miterlimit', 1);\n    pts.exit().remove();\n    pts.each(function (dd, i) {\n      var pt = d3.select(this);\n      var cOpts = extractOpts(trace);\n      var colorscale = cOpts.colorscale;\n      var reversescale = cOpts.reversescale;\n      var fillGradient = function (s) {\n        if (s.size()) {\n          var gradientID = 'legendfill-' + trace.uid;\n          Drawing.gradient(s, gd, gradientID, getGradientDirection(reversescale, useGradient === 'radial'), colorscale, 'fill');\n        }\n      };\n      var fillColor;\n      if (!colorscale) {\n        var color = trace.vertexcolor || trace.facecolor || trace.color;\n        fillColor = Lib.isArrayOrTypedArray(color) ? color[i] || color[0] : color;\n      } else {\n        if (!useGradient) {\n          var len = colorscale.length;\n          fillColor = i === 0 ? colorscale[reversescale ? len - 1 : 0][1] :\n          // minimum\n          i === 1 ? colorscale[reversescale ? 0 : len - 1][1] :\n          // maximum\n          colorscale[Math.floor((len - 1) / 2)][1]; // middle\n        }\n      }\n      pt.attr('d', dd[0]);\n      if (fillColor) {\n        pt.call(Color.fill, fillColor);\n      } else {\n        pt.call(fillGradient);\n      }\n    });\n  }\n};\nfunction getGradientDirection(reversescale, isRadial) {\n  var str = isRadial ? 'radial' : 'horizontal';\n  return str + (reversescale ? '' : 'reversed');\n}\nfunction getStyleGuide(d) {\n  var trace = d[0].trace;\n  var contours = trace.contours;\n  var showLine = subTypes.hasLines(trace);\n  var showMarker = subTypes.hasMarkers(trace);\n  var showFill = trace.visible && trace.fill && trace.fill !== 'none';\n  var showGradientLine = false;\n  var showGradientFill = false;\n  if (contours) {\n    var coloring = contours.coloring;\n    if (coloring === 'lines') {\n      showGradientLine = true;\n    } else {\n      showLine = coloring === 'none' || coloring === 'heatmap' || contours.showlines;\n    }\n    if (contours.type === 'constraint') {\n      showFill = contours._operation !== '=';\n    } else if (coloring === 'fill' || coloring === 'heatmap') {\n      showGradientFill = true;\n    }\n  }\n  return {\n    showMarker: showMarker,\n    showLine: showLine,\n    showFill: showFill,\n    showGradientLine: showGradientLine,\n    showGradientFill: showGradientFill,\n    anyLine: showLine || showGradientLine,\n    anyFill: showFill || showGradientFill\n  };\n}\nfunction dimAttr(v, dflt, max) {\n  if (v && Lib.isArrayOrTypedArray(v)) return dflt;\n  if (v > max) return max;\n  return v;\n}","map":{"version":3,"names":["d3","require","Registry","Lib","strTranslate","Drawing","Color","extractOpts","subTypes","stylePie","pieCastOption","castOption","constants","CST_MARKER_SIZE","CST_LINE_WIDTH","CST_MARKER_LINE_WIDTH","MAX_LINE_WIDTH","MAX_MARKER_LINE_WIDTH","module","exports","style","s","gd","legend","fullLayout","_fullLayout","constantItemSizing","itemsizing","itemWidth","itemwidth","centerPos","itemGap","centerTransform","boundLineWidth","mlw","cont","max","cst","v","width","Math","min","each","d","traceGroup","select","layers","ensureSingle","trace","opacity","indentation","valign","lineHeight","height","attr","factor","top","bottom","markerOffsetY","markerOffsetX","fill","selectAll","data","enter","append","classed","line","symbol","styleSpatial","styleWaterfalls","styleFunnels","styleBars","styleBoxes","styleFunnelareas","stylePies","styleLines","stylePoints","styleCandles","styleOHLC","styleGuide","getStyleGuide","showFill","showLine","showGradientLine","showGradientFill","anyFill","anyLine","d0","dMod","tMod","cOpts","colorscale","reversescale","fillStyle","size","fillGroupStyle","gradientID","uid","gradient","getGradientDirection","lineGradient","lineGroupStyle","pathStart","hasMarkers","this3","exit","remove","call","lw","undefined","minExtend","showMarker","showText","hasText","boundVal","attrIn","arrayToValFn","bounds","valIn","nestedProperty","get","valToBound","isArrayOrTypedArray","pickFirst","array","_distinct","index","dEdit","tEdit","mc","mx","mo","mean","mlc","marker","sizeref","sizemin","sizemode","ms","tx","tp","ts","tc","tf","tw","ty","tv","tC","tE","tS","selectedpoints","texttemplate","ptgroup","pts","insert","pointStyle","mrc","txt","textPointStyle","isWaterfall","type","dir","color","styleBarLike","ptsData","visible","hasTotals","dd","pt","stroke","lThis","desiredType","markerLine","pathStr","cornerradius","isVisible","traceIs","barpath","p","w","mcc","_inHover","mid","tryColorscale","fillColor","markerPattern","pattern","patternShape","getPatternAttr","shape","patternBGColor","bgcolor","patternFGColor","fgcolor","patternFGOpacity","fgopacity","patternSize","dimAttr","patternSolidity","solidity","patternID","fillmode","boxpoints","points","fillcolor","constrain","_","i","dashLine","dash","stylePieLike","opt","d0Mod","useGradient","fillGradient","vertexcolor","facecolor","len","length","floor","isRadial","str","contours","hasLines","coloring","showlines","_operation","dflt"],"sources":["E:/tog_workspace/TestFabric_main/TestFabric-main/node_modules/plotly.js/src/components/legend/style.js"],"sourcesContent":["'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar extractOpts = require('../colorscale/helpers').extractOpts;\n\nvar subTypes = require('../../traces/scatter/subtypes');\nvar stylePie = require('../../traces/pie/style_one');\nvar pieCastOption = require('../../traces/pie/helpers').castOption;\n\nvar constants = require('./constants');\n\nvar CST_MARKER_SIZE = 12;\nvar CST_LINE_WIDTH = 5;\nvar CST_MARKER_LINE_WIDTH = 2;\nvar MAX_LINE_WIDTH = 10;\nvar MAX_MARKER_LINE_WIDTH = 5;\n\nmodule.exports = function style(s, gd, legend) {\n    var fullLayout = gd._fullLayout;\n    if(!legend) legend = fullLayout.legend;\n    var constantItemSizing = legend.itemsizing === 'constant';\n    var itemWidth = legend.itemwidth;\n    var centerPos = (itemWidth + constants.itemGap * 2) / 2;\n    var centerTransform = strTranslate(centerPos, 0);\n\n    var boundLineWidth = function(mlw, cont, max, cst) {\n        var v;\n        if(mlw + 1) {\n            v = mlw;\n        } else if(cont && cont.width > 0) {\n            v = cont.width;\n        } else {\n            return 0;\n        }\n        return constantItemSizing ? cst : Math.min(v, max);\n    };\n\n    s.each(function(d) {\n        var traceGroup = d3.select(this);\n\n        var layers = Lib.ensureSingle(traceGroup, 'g', 'layers');\n        layers.style('opacity', d[0].trace.opacity);\n\n        var indentation = legend.indentation;\n        var valign = legend.valign;\n        var lineHeight = d[0].lineHeight;\n        var height = d[0].height;\n        if((valign === 'middle' && indentation === 0) || !lineHeight || !height) {\n            layers.attr('transform', null);\n        } else {\n            var factor = {top: 1, bottom: -1}[valign];\n            var markerOffsetY = (factor * (0.5 * (lineHeight - height + 3))) || 0;\n            var markerOffsetX = legend.indentation;\n            layers.attr('transform', strTranslate(markerOffsetX, markerOffsetY));\n        }\n\n        var fill = layers\n            .selectAll('g.legendfill')\n                .data([d]);\n        fill.enter().append('g')\n            .classed('legendfill', true);\n\n        var line = layers\n            .selectAll('g.legendlines')\n                .data([d]);\n        line.enter().append('g')\n            .classed('legendlines', true);\n\n        var symbol = layers\n            .selectAll('g.legendsymbols')\n                .data([d]);\n        symbol.enter().append('g')\n            .classed('legendsymbols', true);\n\n        symbol.selectAll('g.legendpoints')\n            .data([d])\n          .enter().append('g')\n            .classed('legendpoints', true);\n    })\n    .each(styleSpatial)\n    .each(styleWaterfalls)\n    .each(styleFunnels)\n    .each(styleBars)\n    .each(styleBoxes)\n    .each(styleFunnelareas)\n    .each(stylePies)\n    .each(styleLines)\n    .each(stylePoints)\n    .each(styleCandles)\n    .each(styleOHLC);\n\n    function styleLines(d) {\n        var styleGuide = getStyleGuide(d);\n        var showFill = styleGuide.showFill;\n        var showLine = styleGuide.showLine;\n        var showGradientLine = styleGuide.showGradientLine;\n        var showGradientFill = styleGuide.showGradientFill;\n        var anyFill = styleGuide.anyFill;\n        var anyLine = styleGuide.anyLine;\n\n        var d0 = d[0];\n        var trace = d0.trace;\n        var dMod, tMod;\n\n        var cOpts = extractOpts(trace);\n        var colorscale = cOpts.colorscale;\n        var reversescale = cOpts.reversescale;\n\n        var fillStyle = function(s) {\n            if(s.size()) {\n                if(showFill) {\n                    Drawing.fillGroupStyle(s, gd, true);\n                } else {\n                    var gradientID = 'legendfill-' + trace.uid;\n                    Drawing.gradient(s, gd, gradientID,\n                        getGradientDirection(reversescale),\n                        colorscale, 'fill');\n                }\n            }\n        };\n\n        var lineGradient = function(s) {\n            if(s.size()) {\n                var gradientID = 'legendline-' + trace.uid;\n                Drawing.lineGroupStyle(s);\n                Drawing.gradient(s, gd, gradientID,\n                    getGradientDirection(reversescale),\n                    colorscale, 'stroke');\n            }\n        };\n\n        // with fill and no markers or text, move the line and fill up a bit\n        // so it's more centered\n\n        var pathStart = (subTypes.hasMarkers(trace) || !anyFill) ? 'M5,0' :\n            // with a line leave it slightly below center, to leave room for the\n            // line thickness and because the line is usually more prominent\n            anyLine ? 'M5,-2' : 'M5,-3';\n\n        var this3 = d3.select(this);\n\n        var fill = this3.select('.legendfill').selectAll('path')\n            .data(showFill || showGradientFill ? [d] : []);\n        fill.enter().append('path').classed('js-fill', true);\n        fill.exit().remove();\n        fill.attr('d', pathStart + 'h' + itemWidth + 'v6h-' + itemWidth + 'z')\n            .call(fillStyle);\n\n        if(showLine || showGradientLine) {\n            var lw = boundLineWidth(undefined, trace.line, MAX_LINE_WIDTH, CST_LINE_WIDTH);\n            tMod = Lib.minExtend(trace, {line: {width: lw}});\n            dMod = [Lib.minExtend(d0, {trace: tMod})];\n        }\n\n        var line = this3.select('.legendlines').selectAll('path')\n            .data(showLine || showGradientLine ? [dMod] : []);\n        line.enter().append('path').classed('js-line', true);\n        line.exit().remove();\n\n        // this is ugly... but you can't apply a gradient to a perfectly\n        // horizontal or vertical line. Presumably because then\n        // the system doesn't know how to scale vertical variation, even\n        // though there *is* no vertical variation in this case.\n        // so add an invisibly small angle to the line\n        // This issue (and workaround) exist across (Mac) Chrome, FF, and Safari\n        line.attr('d', pathStart + (showGradientLine ? 'l' + itemWidth + ',0.0001' : 'h' + itemWidth))\n            .call(showLine ? Drawing.lineGroupStyle : lineGradient);\n    }\n\n    function stylePoints(d) {\n        var styleGuide = getStyleGuide(d);\n        var anyFill = styleGuide.anyFill;\n        var anyLine = styleGuide.anyLine;\n        var showLine = styleGuide.showLine;\n        var showMarker = styleGuide.showMarker;\n\n        var d0 = d[0];\n        var trace = d0.trace;\n        var showText = !showMarker && !anyLine && !anyFill && subTypes.hasText(trace);\n        var dMod, tMod;\n\n        // 'scatter3d' don't use gd.calcdata,\n        // use d0.trace to infer arrayOk attributes\n\n        function boundVal(attrIn, arrayToValFn, bounds, cst) {\n            var valIn = Lib.nestedProperty(trace, attrIn).get();\n            var valToBound = (Lib.isArrayOrTypedArray(valIn) && arrayToValFn) ?\n                arrayToValFn(valIn) :\n                valIn;\n\n            if(constantItemSizing && valToBound && cst !== undefined) {\n                valToBound = cst;\n            }\n\n            if(bounds) {\n                if(valToBound < bounds[0]) return bounds[0];\n                else if(valToBound > bounds[1]) return bounds[1];\n            }\n            return valToBound;\n        }\n\n        function pickFirst(array) {\n            if(d0._distinct && d0.index && array[d0.index]) return array[d0.index];\n            return array[0];\n        }\n\n        // constrain text, markers, etc so they'll fit on the legend\n        if(showMarker || showText || showLine) {\n            var dEdit = {};\n            var tEdit = {};\n\n            if(showMarker) {\n                dEdit.mc = boundVal('marker.color', pickFirst);\n                dEdit.mx = boundVal('marker.symbol', pickFirst);\n                dEdit.mo = boundVal('marker.opacity', Lib.mean, [0.2, 1]);\n                dEdit.mlc = boundVal('marker.line.color', pickFirst);\n                dEdit.mlw = boundVal('marker.line.width', Lib.mean, [0, 5], CST_MARKER_LINE_WIDTH);\n                tEdit.marker = {\n                    sizeref: 1,\n                    sizemin: 1,\n                    sizemode: 'diameter'\n                };\n\n                var ms = boundVal('marker.size', Lib.mean, [2, 16], CST_MARKER_SIZE);\n                dEdit.ms = ms;\n                tEdit.marker.size = ms;\n            }\n\n            if(showLine) {\n                tEdit.line = {\n                    width: boundVal('line.width', pickFirst, [0, 10], CST_LINE_WIDTH)\n                };\n            }\n\n            if(showText) {\n                dEdit.tx = 'Aa';\n                dEdit.tp = boundVal('textposition', pickFirst);\n                dEdit.ts = 10;\n                dEdit.tc = boundVal('textfont.color', pickFirst);\n                dEdit.tf = boundVal('textfont.family', pickFirst);\n                dEdit.tw = boundVal('textfont.weight', pickFirst);\n                dEdit.ty = boundVal('textfont.style', pickFirst);\n                dEdit.tv = boundVal('textfont.variant', pickFirst);\n                dEdit.tC = boundVal('textfont.textcase', pickFirst);\n                dEdit.tE = boundVal('textfont.lineposition', pickFirst);\n                dEdit.tS = boundVal('textfont.shadow', pickFirst);\n            }\n\n            dMod = [Lib.minExtend(d0, dEdit)];\n            tMod = Lib.minExtend(trace, tEdit);\n\n            // always show legend items in base state\n            tMod.selectedpoints = null;\n\n            // never show texttemplate\n            tMod.texttemplate = null;\n        }\n\n        var ptgroup = d3.select(this).select('g.legendpoints');\n\n        var pts = ptgroup.selectAll('path.scatterpts')\n            .data(showMarker ? dMod : []);\n        // make sure marker is on the bottom, in case it enters after text\n        pts.enter().insert('path', ':first-child')\n            .classed('scatterpts', true)\n            .attr('transform', centerTransform);\n        pts.exit().remove();\n        pts.call(Drawing.pointStyle, tMod, gd);\n\n        // 'mrc' is set in pointStyle and used in textPointStyle:\n        // constrain it here\n        if(showMarker) dMod[0].mrc = 3;\n\n        var txt = ptgroup.selectAll('g.pointtext')\n            .data(showText ? dMod : []);\n        txt.enter()\n            .append('g').classed('pointtext', true)\n                .append('text').attr('transform', centerTransform);\n        txt.exit().remove();\n        txt.selectAll('text').call(Drawing.textPointStyle, tMod, gd);\n    }\n\n    function styleWaterfalls(d) {\n        var trace = d[0].trace;\n        var isWaterfall = trace.type === 'waterfall';\n\n        if(d[0]._distinct && isWaterfall) {\n            var cont = d[0].trace[d[0].dir].marker;\n            d[0].mc = cont.color;\n            d[0].mlw = cont.line.width;\n            d[0].mlc = cont.line.color;\n            return styleBarLike(d, this, 'waterfall');\n        }\n\n        var ptsData = [];\n        if(trace.visible && isWaterfall) {\n            ptsData = d[0].hasTotals ?\n                [['increasing', 'M-6,-6V6H0Z'], ['totals', 'M6,6H0L-6,-6H-0Z'], ['decreasing', 'M6,6V-6H0Z']] :\n                [['increasing', 'M-6,-6V6H6Z'], ['decreasing', 'M6,6V-6H-6Z']];\n        }\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legendwaterfall')\n            .data(ptsData);\n        pts.enter().append('path').classed('legendwaterfall', true)\n            .attr('transform', centerTransform)\n            .style('stroke-miterlimit', 1);\n        pts.exit().remove();\n\n        pts.each(function(dd) {\n            var pt = d3.select(this);\n            var cont = trace[dd[0]].marker;\n            var lw = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            pt.attr('d', dd[1])\n                .style('stroke-width', lw + 'px')\n                .call(Color.fill, cont.color);\n\n            if(lw) {\n                pt.call(Color.stroke, cont.line.color);\n            }\n        });\n    }\n\n    function styleBars(d) {\n        styleBarLike(d, this);\n    }\n\n    function styleFunnels(d) {\n        styleBarLike(d, this, 'funnel');\n    }\n\n    function styleBarLike(d, lThis, desiredType) {\n        var trace = d[0].trace;\n        var marker = trace.marker || {};\n        var markerLine = marker.line || {};\n\n        // If bar has rounded corners, round corners of legend icon\n        var pathStr = marker.cornerradius ?\n            'M6,3a3,3,0,0,1-3,3H-3a3,3,0,0,1-3-3V-3a3,3,0,0,1,3-3H3a3,3,0,0,1,3,3Z' : // Square with rounded corners\n            'M6,6H-6V-6H6Z'; // Normal square\n\n        var isVisible = (!desiredType) ? Registry.traceIs(trace, 'bar') :\n            (trace.visible && trace.type === desiredType);\n\n        var barpath = d3.select(lThis).select('g.legendpoints')\n            .selectAll('path.legend' + desiredType)\n            .data(isVisible ? [d] : []);\n        barpath.enter().append('path').classed('legend' + desiredType, true)\n            .attr('d', pathStr)\n            .attr('transform', centerTransform);\n        barpath.exit().remove();\n\n        barpath.each(function(d) {\n            var p = d3.select(this);\n            var d0 = d[0];\n            var w = boundLineWidth(d0.mlw, marker.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            p.style('stroke-width', w + 'px');\n\n            var mcc = d0.mcc;\n            if(!legend._inHover && 'mc' in d0) {\n                // not in unified hover but\n                // for legend use the color in the middle of scale\n                var cOpts = extractOpts(marker);\n                var mid = cOpts.mid;\n                if(mid === undefined) mid = (cOpts.max + cOpts.min) / 2;\n                mcc = Drawing.tryColorscale(marker, '')(mid);\n            }\n            var fillColor = mcc || d0.mc || marker.color;\n\n            var markerPattern = marker.pattern;\n            var patternShape = markerPattern && Drawing.getPatternAttr(markerPattern.shape, 0, '');\n\n            if(patternShape) {\n                var patternBGColor = Drawing.getPatternAttr(markerPattern.bgcolor, 0, null);\n                var patternFGColor = Drawing.getPatternAttr(markerPattern.fgcolor, 0, null);\n                var patternFGOpacity = markerPattern.fgopacity;\n                var patternSize = dimAttr(markerPattern.size, 8, 10);\n                var patternSolidity = dimAttr(markerPattern.solidity, 0.5, 1);\n                var patternID = 'legend-' + trace.uid;\n                p.call(\n                    Drawing.pattern, 'legend', gd, patternID,\n                    patternShape, patternSize, patternSolidity,\n                    mcc, markerPattern.fillmode,\n                    patternBGColor, patternFGColor, patternFGOpacity\n                );\n            } else {\n                p.call(Color.fill, fillColor);\n            }\n\n            if(w) Color.stroke(p, d0.mlc || markerLine.color);\n        });\n    }\n\n    function styleBoxes(d) {\n        var trace = d[0].trace;\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legendbox')\n            .data(trace.visible && Registry.traceIs(trace, 'box-violin') ? [d] : []);\n        pts.enter().append('path').classed('legendbox', true)\n            // if we want the median bar, prepend M6,0H-6\n            .attr('d', 'M6,6H-6V-6H6Z')\n            .attr('transform', centerTransform);\n        pts.exit().remove();\n\n        pts.each(function() {\n            var p = d3.select(this);\n\n            if((trace.boxpoints === 'all' || trace.points === 'all') &&\n                Color.opacity(trace.fillcolor) === 0 && Color.opacity((trace.line || {}).color) === 0\n            ) {\n                var tMod = Lib.minExtend(trace, {\n                    marker: {\n                        size: constantItemSizing ? CST_MARKER_SIZE : Lib.constrain(trace.marker.size, 2, 16),\n                        sizeref: 1,\n                        sizemin: 1,\n                        sizemode: 'diameter'\n                    }\n                });\n                pts.call(Drawing.pointStyle, tMod, gd);\n            } else {\n                var w = boundLineWidth(undefined, trace.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n                p.style('stroke-width', w + 'px')\n                    .call(Color.fill, trace.fillcolor);\n\n                if(w) Color.stroke(p, trace.line.color);\n            }\n        });\n    }\n\n    function styleCandles(d) {\n        var trace = d[0].trace;\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legendcandle')\n            .data(trace.visible && trace.type === 'candlestick' ? [d, d] : []);\n        pts.enter().append('path').classed('legendcandle', true)\n            .attr('d', function(_, i) {\n                if(i) return 'M-15,0H-8M-8,6V-6H8Z'; // increasing\n                return 'M15,0H8M8,-6V6H-8Z'; // decreasing\n            })\n            .attr('transform', centerTransform)\n            .style('stroke-miterlimit', 1);\n        pts.exit().remove();\n\n        pts.each(function(_, i) {\n            var p = d3.select(this);\n            var cont = trace[i ? 'increasing' : 'decreasing'];\n            var w = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            p.style('stroke-width', w + 'px')\n                .call(Color.fill, cont.fillcolor);\n\n            if(w) Color.stroke(p, cont.line.color);\n        });\n    }\n\n    function styleOHLC(d) {\n        var trace = d[0].trace;\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legendohlc')\n            .data(trace.visible && trace.type === 'ohlc' ? [d, d] : []);\n        pts.enter().append('path').classed('legendohlc', true)\n            .attr('d', function(_, i) {\n                if(i) return 'M-15,0H0M-8,-6V0'; // increasing\n                return 'M15,0H0M8,6V0'; // decreasing\n            })\n            .attr('transform', centerTransform)\n            .style('stroke-miterlimit', 1);\n        pts.exit().remove();\n\n        pts.each(function(_, i) {\n            var p = d3.select(this);\n            var cont = trace[i ? 'increasing' : 'decreasing'];\n            var w = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            p.style('fill', 'none')\n                .call(Drawing.dashLine, cont.line.dash, w);\n\n            if(w) Color.stroke(p, cont.line.color);\n        });\n    }\n\n    function stylePies(d) {\n        stylePieLike(d, this, 'pie');\n    }\n\n    function styleFunnelareas(d) {\n        stylePieLike(d, this, 'funnelarea');\n    }\n\n    function stylePieLike(d, lThis, desiredType) {\n        var d0 = d[0];\n        var trace = d0.trace;\n\n        var isVisible = (!desiredType) ? Registry.traceIs(trace, desiredType) :\n            (trace.visible && trace.type === desiredType);\n\n        var pts = d3.select(lThis).select('g.legendpoints')\n            .selectAll('path.legend' + desiredType)\n            .data(isVisible ? [d] : []);\n        pts.enter().append('path').classed('legend' + desiredType, true)\n            .attr('d', 'M6,6H-6V-6H6Z')\n            .attr('transform', centerTransform);\n        pts.exit().remove();\n\n        if(pts.size()) {\n            var cont = trace.marker || {};\n            var lw = boundLineWidth(pieCastOption(cont.line.width, d0.pts), cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            var opt = 'pieLike';\n            var tMod = Lib.minExtend(trace, {marker: {line: {width: lw}}}, opt);\n            var d0Mod = Lib.minExtend(d0, {trace: tMod}, opt);\n\n            stylePie(pts, d0Mod, tMod, gd);\n        }\n    }\n\n    function styleSpatial(d) { // i.e. maninly traces having z and colorscale\n        var trace = d[0].trace;\n\n        var useGradient;\n        var ptsData = [];\n        if(trace.visible) {\n            switch(trace.type) {\n                case 'histogram2d' :\n                case 'heatmap' :\n                    ptsData = [\n                        ['M-15,-2V4H15V-2Z'] // similar to contour\n                    ];\n                    useGradient = true;\n                    break;\n                case 'choropleth' :\n                case 'choroplethmapbox' :\n                case 'choroplethmap' :\n                    ptsData = [\n                        ['M-6,-6V6H6V-6Z']\n                    ];\n                    useGradient = true;\n                    break;\n                case 'densitymapbox' :\n                case 'densitymap' :\n                    ptsData = [\n                        ['M-6,0 a6,6 0 1,0 12,0 a 6,6 0 1,0 -12,0']\n                    ];\n                    useGradient = 'radial';\n                    break;\n                case 'cone' :\n                    ptsData = [\n                        ['M-6,2 A2,2 0 0,0 -6,6 V6L6,4Z'],\n                        ['M-6,-6 A2,2 0 0,0 -6,-2 L6,-4Z'],\n                        ['M-6,-2 A2,2 0 0,0 -6,2 L6,0Z']\n                    ];\n                    useGradient = false;\n                    break;\n                case 'streamtube' :\n                    ptsData = [\n                        ['M-6,2 A2,2 0 0,0 -6,6 H6 A2,2 0 0,1 6,2 Z'],\n                        ['M-6,-6 A2,2 0 0,0 -6,-2 H6 A2,2 0 0,1 6,-6 Z'],\n                        ['M-6,-2 A2,2 0 0,0 -6,2 H6 A2,2 0 0,1 6,-2 Z']\n                    ];\n                    useGradient = false;\n                    break;\n                case 'surface' :\n                    ptsData = [\n                        ['M-6,-6 A2,3 0 0,0 -6,0 H6 A2,3 0 0,1 6,-6 Z'],\n                        ['M-6,1 A2,3 0 0,1 -6,6 H6 A2,3 0 0,0 6,0 Z']\n                    ];\n                    useGradient = true;\n                    break;\n                case 'mesh3d' :\n                    ptsData = [\n                        ['M-6,6H0L-6,-6Z'],\n                        ['M6,6H0L6,-6Z'],\n                        ['M-6,-6H6L0,6Z']\n                    ];\n                    useGradient = false;\n                    break;\n                case 'volume' :\n                    ptsData = [\n                        ['M-6,6H0L-6,-6Z'],\n                        ['M6,6H0L6,-6Z'],\n                        ['M-6,-6H6L0,6Z']\n                    ];\n                    useGradient = true;\n                    break;\n                case 'isosurface':\n                    ptsData = [\n                        ['M-6,6H0L-6,-6Z'],\n                        ['M6,6H0L6,-6Z'],\n                        ['M-6,-6 A12,24 0 0,0 6,-6 L0,6Z']\n                    ];\n                    useGradient = false;\n                    break;\n            }\n        }\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legend3dandfriends')\n            .data(ptsData);\n        pts.enter().append('path').classed('legend3dandfriends', true)\n            .attr('transform', centerTransform)\n            .style('stroke-miterlimit', 1);\n        pts.exit().remove();\n\n        pts.each(function(dd, i) {\n            var pt = d3.select(this);\n\n            var cOpts = extractOpts(trace);\n            var colorscale = cOpts.colorscale;\n            var reversescale = cOpts.reversescale;\n            var fillGradient = function(s) {\n                if(s.size()) {\n                    var gradientID = 'legendfill-' + trace.uid;\n                    Drawing.gradient(s, gd, gradientID,\n                        getGradientDirection(reversescale, useGradient === 'radial'),\n                        colorscale, 'fill');\n                }\n            };\n\n            var fillColor;\n            if(!colorscale) {\n                var color = trace.vertexcolor || trace.facecolor || trace.color;\n                fillColor = Lib.isArrayOrTypedArray(color) ? (color[i] || color[0]) : color;\n            } else {\n                if(!useGradient) {\n                    var len = colorscale.length;\n                    fillColor =\n                        i === 0 ? colorscale[reversescale ? len - 1 : 0][1] : // minimum\n                        i === 1 ? colorscale[reversescale ? 0 : len - 1][1] : // maximum\n                            colorscale[Math.floor((len - 1) / 2)][1]; // middle\n                }\n            }\n\n            pt.attr('d', dd[0]);\n            if(fillColor) {\n                pt.call(Color.fill, fillColor);\n            } else {\n                pt.call(fillGradient);\n            }\n        });\n    }\n};\n\nfunction getGradientDirection(reversescale, isRadial) {\n    var str = isRadial ? 'radial' : 'horizontal';\n    return str + (reversescale ? '' : 'reversed');\n}\n\nfunction getStyleGuide(d) {\n    var trace = d[0].trace;\n    var contours = trace.contours;\n    var showLine = subTypes.hasLines(trace);\n    var showMarker = subTypes.hasMarkers(trace);\n\n    var showFill = trace.visible && trace.fill && trace.fill !== 'none';\n    var showGradientLine = false;\n    var showGradientFill = false;\n\n    if(contours) {\n        var coloring = contours.coloring;\n\n        if(coloring === 'lines') {\n            showGradientLine = true;\n        } else {\n            showLine = coloring === 'none' || coloring === 'heatmap' || contours.showlines;\n        }\n\n        if(contours.type === 'constraint') {\n            showFill = contours._operation !== '=';\n        } else if(coloring === 'fill' || coloring === 'heatmap') {\n            showGradientFill = true;\n        }\n    }\n    return {\n        showMarker: showMarker,\n        showLine: showLine,\n        showFill: showFill,\n        showGradientLine: showGradientLine,\n        showGradientFill: showGradientFill,\n        anyLine: showLine || showGradientLine,\n        anyFill: showFill || showGradientFill,\n    };\n}\n\nfunction dimAttr(v, dflt, max) {\n    if(v && Lib.isArrayOrTypedArray(v)) return dflt;\n    if(v > max) return max;\n    return v;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}