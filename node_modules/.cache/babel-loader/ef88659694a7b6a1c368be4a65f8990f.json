{"ast":null,"code":"'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Lib = require('../../lib');\nvar geoUtils = require('../../lib/geo_location_utils');\nvar getTopojsonFeatures = require('../../lib/topojson_utils').getTopojsonFeatures;\nvar findExtremes = require('../../plots/cartesian/autorange').findExtremes;\nvar style = require('./style').style;\nfunction plot(gd, geo, calcData) {\n  var choroplethLayer = geo.layers.backplot.select('.choroplethlayer');\n  Lib.makeTraceGroups(choroplethLayer, calcData, 'trace choropleth').each(function (calcTrace) {\n    var sel = d3.select(this);\n    var paths = sel.selectAll('path.choroplethlocation').data(Lib.identity);\n    paths.enter().append('path').classed('choroplethlocation', true);\n    paths.exit().remove();\n\n    // call style here within topojson request callback\n    style(gd, calcTrace);\n  });\n}\nfunction calcGeoJSON(calcTrace, fullLayout) {\n  var trace = calcTrace[0].trace;\n  var geoLayout = fullLayout[trace.geo];\n  var geo = geoLayout._subplot;\n  var locationmode = trace.locationmode;\n  var len = trace._length;\n  var features = locationmode === 'geojson-id' ? geoUtils.extractTraceFeature(calcTrace) : getTopojsonFeatures(trace, geo.topojson);\n  var lonArray = [];\n  var latArray = [];\n  for (var i = 0; i < len; i++) {\n    var calcPt = calcTrace[i];\n    var feature = locationmode === 'geojson-id' ? calcPt.fOut : geoUtils.locationToFeature(locationmode, calcPt.loc, features);\n    if (feature) {\n      calcPt.geojson = feature;\n      calcPt.ct = feature.properties.ct;\n      calcPt._polygons = geoUtils.feature2polygons(feature);\n      var bboxFeature = geoUtils.computeBbox(feature);\n      lonArray.push(bboxFeature[0], bboxFeature[2]);\n      latArray.push(bboxFeature[1], bboxFeature[3]);\n    } else {\n      calcPt.geojson = null;\n    }\n  }\n  if (geoLayout.fitbounds === 'geojson' && locationmode === 'geojson-id') {\n    var bboxGeojson = geoUtils.computeBbox(geoUtils.getTraceGeojson(trace));\n    lonArray = [bboxGeojson[0], bboxGeojson[2]];\n    latArray = [bboxGeojson[1], bboxGeojson[3]];\n  }\n  var opts = {\n    padded: true\n  };\n  trace._extremes.lon = findExtremes(geoLayout.lonaxis._ax, lonArray, opts);\n  trace._extremes.lat = findExtremes(geoLayout.lataxis._ax, latArray, opts);\n}\nmodule.exports = {\n  calcGeoJSON: calcGeoJSON,\n  plot: plot\n};","map":{"version":3,"names":["d3","require","Lib","geoUtils","getTopojsonFeatures","findExtremes","style","plot","gd","geo","calcData","choroplethLayer","layers","backplot","select","makeTraceGroups","each","calcTrace","sel","paths","selectAll","data","identity","enter","append","classed","exit","remove","calcGeoJSON","fullLayout","trace","geoLayout","_subplot","locationmode","len","_length","features","extractTraceFeature","topojson","lonArray","latArray","i","calcPt","feature","fOut","locationToFeature","loc","geojson","ct","properties","_polygons","feature2polygons","bboxFeature","computeBbox","push","fitbounds","bboxGeojson","getTraceGeojson","opts","padded","_extremes","lon","lonaxis","_ax","lat","lataxis","module","exports"],"sources":["E:/tog_workspace/TestFabric_main/TestFabric-main/node_modules/plotly.js/src/traces/choropleth/plot.js"],"sourcesContent":["'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Lib = require('../../lib');\nvar geoUtils = require('../../lib/geo_location_utils');\nvar getTopojsonFeatures = require('../../lib/topojson_utils').getTopojsonFeatures;\nvar findExtremes = require('../../plots/cartesian/autorange').findExtremes;\n\nvar style = require('./style').style;\n\nfunction plot(gd, geo, calcData) {\n    var choroplethLayer = geo.layers.backplot.select('.choroplethlayer');\n\n    Lib.makeTraceGroups(choroplethLayer, calcData, 'trace choropleth').each(function(calcTrace) {\n        var sel = d3.select(this);\n\n        var paths = sel.selectAll('path.choroplethlocation')\n            .data(Lib.identity);\n\n        paths.enter().append('path')\n            .classed('choroplethlocation', true);\n\n        paths.exit().remove();\n\n        // call style here within topojson request callback\n        style(gd, calcTrace);\n    });\n}\n\nfunction calcGeoJSON(calcTrace, fullLayout) {\n    var trace = calcTrace[0].trace;\n    var geoLayout = fullLayout[trace.geo];\n    var geo = geoLayout._subplot;\n    var locationmode = trace.locationmode;\n    var len = trace._length;\n\n    var features = locationmode === 'geojson-id' ?\n        geoUtils.extractTraceFeature(calcTrace) :\n        getTopojsonFeatures(trace, geo.topojson);\n\n    var lonArray = [];\n    var latArray = [];\n\n    for(var i = 0; i < len; i++) {\n        var calcPt = calcTrace[i];\n        var feature = locationmode === 'geojson-id' ?\n            calcPt.fOut :\n            geoUtils.locationToFeature(locationmode, calcPt.loc, features);\n\n        if(feature) {\n            calcPt.geojson = feature;\n            calcPt.ct = feature.properties.ct;\n            calcPt._polygons = geoUtils.feature2polygons(feature);\n\n            var bboxFeature = geoUtils.computeBbox(feature);\n            lonArray.push(bboxFeature[0], bboxFeature[2]);\n            latArray.push(bboxFeature[1], bboxFeature[3]);\n        } else {\n            calcPt.geojson = null;\n        }\n    }\n\n    if(geoLayout.fitbounds === 'geojson' && locationmode === 'geojson-id') {\n        var bboxGeojson = geoUtils.computeBbox(geoUtils.getTraceGeojson(trace));\n        lonArray = [bboxGeojson[0], bboxGeojson[2]];\n        latArray = [bboxGeojson[1], bboxGeojson[3]];\n    }\n\n    var opts = {padded: true};\n    trace._extremes.lon = findExtremes(geoLayout.lonaxis._ax, lonArray, opts);\n    trace._extremes.lat = findExtremes(geoLayout.lataxis._ax, latArray, opts);\n}\n\nmodule.exports = {\n    calcGeoJSON: calcGeoJSON,\n    plot: plot\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}