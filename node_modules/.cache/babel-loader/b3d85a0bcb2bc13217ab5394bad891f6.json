{"ast":null,"code":"'use strict';\n\nvar Color = require('../../components/color');\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\nvar boxHoverPoints = require('../box/hover');\nvar helpers = require('./helpers');\nmodule.exports = function hoverPoints(pointData, xval, yval, hovermode, opts) {\n  if (!opts) opts = {};\n  var hoverLayer = opts.hoverLayer;\n  var cd = pointData.cd;\n  var trace = cd[0].trace;\n  var hoveron = trace.hoveron;\n  var hasHoveronViolins = hoveron.indexOf('violins') !== -1;\n  var hasHoveronKDE = hoveron.indexOf('kde') !== -1;\n  var closeData = [];\n  var closePtData;\n  var violinLineAttrs;\n  if (hasHoveronViolins || hasHoveronKDE) {\n    var closeBoxData = boxHoverPoints.hoverOnBoxes(pointData, xval, yval, hovermode);\n    if (hasHoveronKDE && closeBoxData.length > 0) {\n      var xa = pointData.xa;\n      var ya = pointData.ya;\n      var pLetter, vLetter, pAxis, vAxis, vVal;\n      if (trace.orientation === 'h') {\n        vVal = xval;\n        pLetter = 'y';\n        pAxis = ya;\n        vLetter = 'x';\n        vAxis = xa;\n      } else {\n        vVal = yval;\n        pLetter = 'x';\n        pAxis = xa;\n        vLetter = 'y';\n        vAxis = ya;\n      }\n      var di = cd[pointData.index];\n      if (vVal >= di.span[0] && vVal <= di.span[1]) {\n        var kdePointData = Lib.extendFlat({}, pointData);\n        var vValPx = vAxis.c2p(vVal, true);\n        var kdeVal = helpers.getKdeValue(di, trace, vVal);\n        var pOnPath = helpers.getPositionOnKdePath(di, trace, vValPx);\n        var paOffset = pAxis._offset;\n        var paLength = pAxis._length;\n        kdePointData[pLetter + '0'] = pOnPath[0];\n        kdePointData[pLetter + '1'] = pOnPath[1];\n        kdePointData[vLetter + '0'] = kdePointData[vLetter + '1'] = vValPx;\n        kdePointData[vLetter + 'Label'] = vLetter + ': ' + Axes.hoverLabelText(vAxis, vVal, trace[vLetter + 'hoverformat']) + ', ' + cd[0].t.labels.kde + ' ' + kdeVal.toFixed(3);\n\n        // move the spike to the KDE point\n        var medId = 0;\n        for (var k = 0; k < closeBoxData.length; k++) {\n          if (closeBoxData[k].attr === 'med') {\n            medId = k;\n            break;\n          }\n        }\n        kdePointData.spikeDistance = closeBoxData[medId].spikeDistance;\n        var spikePosAttr = pLetter + 'Spike';\n        kdePointData[spikePosAttr] = closeBoxData[medId][spikePosAttr];\n        closeBoxData[medId].spikeDistance = undefined;\n        closeBoxData[medId][spikePosAttr] = undefined;\n\n        // no hovertemplate support yet\n        kdePointData.hovertemplate = false;\n        closeData.push(kdePointData);\n        violinLineAttrs = {};\n        violinLineAttrs[pLetter + '1'] = Lib.constrain(paOffset + pOnPath[0], paOffset, paOffset + paLength);\n        violinLineAttrs[pLetter + '2'] = Lib.constrain(paOffset + pOnPath[1], paOffset, paOffset + paLength);\n        violinLineAttrs[vLetter + '1'] = violinLineAttrs[vLetter + '2'] = vAxis._offset + vValPx;\n      }\n    }\n    if (hasHoveronViolins) {\n      closeData = closeData.concat(closeBoxData);\n    }\n  }\n  if (hoveron.indexOf('points') !== -1) {\n    closePtData = boxHoverPoints.hoverOnPoints(pointData, xval, yval);\n  }\n\n  // update violin line (if any)\n  var violinLine = hoverLayer.selectAll('.violinline-' + trace.uid).data(violinLineAttrs ? [0] : []);\n  violinLine.enter().append('line').classed('violinline-' + trace.uid, true).attr('stroke-width', 1.5);\n  violinLine.exit().remove();\n  violinLine.attr(violinLineAttrs).call(Color.stroke, pointData.color);\n\n  // same combine logic as box hoverPoints\n  if (hovermode === 'closest') {\n    if (closePtData) return [closePtData];\n    return closeData;\n  }\n  if (closePtData) {\n    closeData.push(closePtData);\n    return closeData;\n  }\n  return closeData;\n};","map":{"version":3,"names":["Color","require","Lib","Axes","boxHoverPoints","helpers","module","exports","hoverPoints","pointData","xval","yval","hovermode","opts","hoverLayer","cd","trace","hoveron","hasHoveronViolins","indexOf","hasHoveronKDE","closeData","closePtData","violinLineAttrs","closeBoxData","hoverOnBoxes","length","xa","ya","pLetter","vLetter","pAxis","vAxis","vVal","orientation","di","index","span","kdePointData","extendFlat","vValPx","c2p","kdeVal","getKdeValue","pOnPath","getPositionOnKdePath","paOffset","_offset","paLength","_length","hoverLabelText","t","labels","kde","toFixed","medId","k","attr","spikeDistance","spikePosAttr","undefined","hovertemplate","push","constrain","concat","hoverOnPoints","violinLine","selectAll","uid","data","enter","append","classed","exit","remove","call","stroke","color"],"sources":["E:/tog_workspace/TestFabric_main/TestFabric-main/node_modules/plotly.js/src/traces/violin/hover.js"],"sourcesContent":["'use strict';\n\nvar Color = require('../../components/color');\nvar Lib = require('../../lib');\nvar Axes = require('../../plots/cartesian/axes');\nvar boxHoverPoints = require('../box/hover');\nvar helpers = require('./helpers');\n\nmodule.exports = function hoverPoints(pointData, xval, yval, hovermode, opts) {\n    if(!opts) opts = {};\n    var hoverLayer = opts.hoverLayer;\n\n    var cd = pointData.cd;\n    var trace = cd[0].trace;\n    var hoveron = trace.hoveron;\n    var hasHoveronViolins = hoveron.indexOf('violins') !== -1;\n    var hasHoveronKDE = hoveron.indexOf('kde') !== -1;\n    var closeData = [];\n    var closePtData;\n    var violinLineAttrs;\n\n    if(hasHoveronViolins || hasHoveronKDE) {\n        var closeBoxData = boxHoverPoints.hoverOnBoxes(pointData, xval, yval, hovermode);\n\n        if(hasHoveronKDE && closeBoxData.length > 0) {\n            var xa = pointData.xa;\n            var ya = pointData.ya;\n            var pLetter, vLetter, pAxis, vAxis, vVal;\n\n            if(trace.orientation === 'h') {\n                vVal = xval;\n                pLetter = 'y';\n                pAxis = ya;\n                vLetter = 'x';\n                vAxis = xa;\n            } else {\n                vVal = yval;\n                pLetter = 'x';\n                pAxis = xa;\n                vLetter = 'y';\n                vAxis = ya;\n            }\n\n            var di = cd[pointData.index];\n\n            if(vVal >= di.span[0] && vVal <= di.span[1]) {\n                var kdePointData = Lib.extendFlat({}, pointData);\n                var vValPx = vAxis.c2p(vVal, true);\n                var kdeVal = helpers.getKdeValue(di, trace, vVal);\n                var pOnPath = helpers.getPositionOnKdePath(di, trace, vValPx);\n                var paOffset = pAxis._offset;\n                var paLength = pAxis._length;\n\n                kdePointData[pLetter + '0'] = pOnPath[0];\n                kdePointData[pLetter + '1'] = pOnPath[1];\n                kdePointData[vLetter + '0'] = kdePointData[vLetter + '1'] = vValPx;\n                kdePointData[vLetter + 'Label'] = vLetter + ': ' + Axes.hoverLabelText(vAxis, vVal, trace[vLetter + 'hoverformat']) + ', ' + cd[0].t.labels.kde + ' ' + kdeVal.toFixed(3);\n\n                // move the spike to the KDE point\n                var medId = 0;\n                for(var k = 0; k < closeBoxData.length; k++) {\n                    if(closeBoxData[k].attr === 'med') {\n                        medId = k;\n                        break;\n                    }\n                }\n\n                kdePointData.spikeDistance = closeBoxData[medId].spikeDistance;\n                var spikePosAttr = pLetter + 'Spike';\n                kdePointData[spikePosAttr] = closeBoxData[medId][spikePosAttr];\n                closeBoxData[medId].spikeDistance = undefined;\n                closeBoxData[medId][spikePosAttr] = undefined;\n\n                // no hovertemplate support yet\n                kdePointData.hovertemplate = false;\n\n                closeData.push(kdePointData);\n\n                violinLineAttrs = {};\n                violinLineAttrs[pLetter + '1'] = Lib.constrain(paOffset + pOnPath[0], paOffset, paOffset + paLength);\n                violinLineAttrs[pLetter + '2'] = Lib.constrain(paOffset + pOnPath[1], paOffset, paOffset + paLength);\n                violinLineAttrs[vLetter + '1'] = violinLineAttrs[vLetter + '2'] = vAxis._offset + vValPx;\n            }\n        }\n\n        if(hasHoveronViolins) {\n            closeData = closeData.concat(closeBoxData);\n        }\n    }\n\n    if(hoveron.indexOf('points') !== -1) {\n        closePtData = boxHoverPoints.hoverOnPoints(pointData, xval, yval);\n    }\n\n    // update violin line (if any)\n    var violinLine = hoverLayer.selectAll('.violinline-' + trace.uid)\n        .data(violinLineAttrs ? [0] : []);\n    violinLine.enter().append('line')\n        .classed('violinline-' + trace.uid, true)\n        .attr('stroke-width', 1.5);\n    violinLine.exit().remove();\n    violinLine.attr(violinLineAttrs).call(Color.stroke, pointData.color);\n\n    // same combine logic as box hoverPoints\n    if(hovermode === 'closest') {\n        if(closePtData) return [closePtData];\n        return closeData;\n    }\n    if(closePtData) {\n        closeData.push(closePtData);\n        return closeData;\n    }\n    return closeData;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}