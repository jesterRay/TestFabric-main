{"ast":null,"code":"'use strict';\n\nvar convert = require('./convert').convert;\nvar convertOnSelect = require('./convert').convertOnSelect;\nvar LAYER_PREFIX = require('../../plots/map/constants').traceLayerPrefix;\nfunction ChoroplethMap(subplot, uid) {\n  this.type = 'choroplethmap';\n  this.subplot = subplot;\n  this.uid = uid;\n\n  // N.B. fill and line layers share same source\n  this.sourceId = 'source-' + uid;\n  this.layerList = [['fill', LAYER_PREFIX + uid + '-fill'], ['line', LAYER_PREFIX + uid + '-line']];\n\n  // previous 'below' value,\n  // need this to update it properly\n  this.below = null;\n}\nvar proto = ChoroplethMap.prototype;\nproto.update = function (calcTrace) {\n  this._update(convert(calcTrace));\n\n  // link ref for quick update during selections\n  calcTrace[0].trace._glTrace = this;\n};\nproto.updateOnSelect = function (calcTrace) {\n  this._update(convertOnSelect(calcTrace));\n};\nproto._update = function (optsAll) {\n  var subplot = this.subplot;\n  var layerList = this.layerList;\n  var below = subplot.belowLookup['trace-' + this.uid];\n  subplot.map.getSource(this.sourceId).setData(optsAll.geojson);\n  if (below !== this.below) {\n    this._removeLayers();\n    this._addLayers(optsAll, below);\n    this.below = below;\n  }\n  for (var i = 0; i < layerList.length; i++) {\n    var item = layerList[i];\n    var k = item[0];\n    var id = item[1];\n    var opts = optsAll[k];\n    subplot.setOptions(id, 'setLayoutProperty', opts.layout);\n    if (opts.layout.visibility === 'visible') {\n      subplot.setOptions(id, 'setPaintProperty', opts.paint);\n    }\n  }\n};\nproto._addLayers = function (optsAll, below) {\n  var subplot = this.subplot;\n  var layerList = this.layerList;\n  var sourceId = this.sourceId;\n  for (var i = 0; i < layerList.length; i++) {\n    var item = layerList[i];\n    var k = item[0];\n    var opts = optsAll[k];\n    subplot.addLayer({\n      type: k,\n      id: item[1],\n      source: sourceId,\n      layout: opts.layout,\n      paint: opts.paint\n    }, below);\n  }\n};\nproto._removeLayers = function () {\n  var map = this.subplot.map;\n  var layerList = this.layerList;\n  for (var i = layerList.length - 1; i >= 0; i--) {\n    map.removeLayer(layerList[i][1]);\n  }\n};\nproto.dispose = function () {\n  var map = this.subplot.map;\n  this._removeLayers();\n  map.removeSource(this.sourceId);\n};\nmodule.exports = function createChoroplethMap(subplot, calcTrace) {\n  var trace = calcTrace[0].trace;\n  var choroplethMap = new ChoroplethMap(subplot, trace.uid);\n  var sourceId = choroplethMap.sourceId;\n  var optsAll = convert(calcTrace);\n  var below = choroplethMap.below = subplot.belowLookup['trace-' + trace.uid];\n  subplot.map.addSource(sourceId, {\n    type: 'geojson',\n    data: optsAll.geojson\n  });\n  choroplethMap._addLayers(optsAll, below);\n\n  // link ref for quick update during selections\n  calcTrace[0].trace._glTrace = choroplethMap;\n  return choroplethMap;\n};","map":{"version":3,"names":["convert","require","convertOnSelect","LAYER_PREFIX","traceLayerPrefix","ChoroplethMap","subplot","uid","type","sourceId","layerList","below","proto","prototype","update","calcTrace","_update","trace","_glTrace","updateOnSelect","optsAll","belowLookup","map","getSource","setData","geojson","_removeLayers","_addLayers","i","length","item","k","id","opts","setOptions","layout","visibility","paint","addLayer","source","removeLayer","dispose","removeSource","module","exports","createChoroplethMap","choroplethMap","addSource","data"],"sources":["E:/tog_workspace/TestFabric_main/TestFabric-main/node_modules/plotly.js/src/traces/choroplethmap/plot.js"],"sourcesContent":["'use strict';\n\nvar convert = require('./convert').convert;\nvar convertOnSelect = require('./convert').convertOnSelect;\nvar LAYER_PREFIX = require('../../plots/map/constants').traceLayerPrefix;\n\nfunction ChoroplethMap(subplot, uid) {\n    this.type = 'choroplethmap';\n    this.subplot = subplot;\n    this.uid = uid;\n\n    // N.B. fill and line layers share same source\n    this.sourceId = 'source-' + uid;\n\n    this.layerList = [\n        ['fill', LAYER_PREFIX + uid + '-fill'],\n        ['line', LAYER_PREFIX + uid + '-line']\n    ];\n\n    // previous 'below' value,\n    // need this to update it properly\n    this.below = null;\n}\n\nvar proto = ChoroplethMap.prototype;\n\nproto.update = function(calcTrace) {\n    this._update(convert(calcTrace));\n\n    // link ref for quick update during selections\n    calcTrace[0].trace._glTrace = this;\n};\n\nproto.updateOnSelect = function(calcTrace) {\n    this._update(convertOnSelect(calcTrace));\n};\n\nproto._update = function(optsAll) {\n    var subplot = this.subplot;\n    var layerList = this.layerList;\n    var below = subplot.belowLookup['trace-' + this.uid];\n\n    subplot.map\n        .getSource(this.sourceId)\n        .setData(optsAll.geojson);\n\n    if(below !== this.below) {\n        this._removeLayers();\n        this._addLayers(optsAll, below);\n        this.below = below;\n    }\n\n    for(var i = 0; i < layerList.length; i++) {\n        var item = layerList[i];\n        var k = item[0];\n        var id = item[1];\n        var opts = optsAll[k];\n\n        subplot.setOptions(id, 'setLayoutProperty', opts.layout);\n\n        if(opts.layout.visibility === 'visible') {\n            subplot.setOptions(id, 'setPaintProperty', opts.paint);\n        }\n    }\n};\n\nproto._addLayers = function(optsAll, below) {\n    var subplot = this.subplot;\n    var layerList = this.layerList;\n    var sourceId = this.sourceId;\n\n    for(var i = 0; i < layerList.length; i++) {\n        var item = layerList[i];\n        var k = item[0];\n        var opts = optsAll[k];\n\n        subplot.addLayer({\n            type: k,\n            id: item[1],\n            source: sourceId,\n            layout: opts.layout,\n            paint: opts.paint\n        }, below);\n    }\n};\n\nproto._removeLayers = function() {\n    var map = this.subplot.map;\n    var layerList = this.layerList;\n\n    for(var i = layerList.length - 1; i >= 0; i--) {\n        map.removeLayer(layerList[i][1]);\n    }\n};\n\nproto.dispose = function() {\n    var map = this.subplot.map;\n    this._removeLayers();\n    map.removeSource(this.sourceId);\n};\n\nmodule.exports = function createChoroplethMap(subplot, calcTrace) {\n    var trace = calcTrace[0].trace;\n    var choroplethMap = new ChoroplethMap(subplot, trace.uid);\n    var sourceId = choroplethMap.sourceId;\n    var optsAll = convert(calcTrace);\n    var below = choroplethMap.below = subplot.belowLookup['trace-' + trace.uid];\n\n    subplot.map.addSource(sourceId, {\n        type: 'geojson',\n        data: optsAll.geojson\n    });\n\n    choroplethMap._addLayers(optsAll, below);\n\n    // link ref for quick update during selections\n    calcTrace[0].trace._glTrace = choroplethMap;\n\n    return choroplethMap;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}