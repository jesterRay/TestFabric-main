{"ast":null,"code":"'use strict';\n\nvar Lib = require('../../lib');\nvar constants = require('./constants');\nvar isNumeric = require('fast-isnumeric');\nvar Axes = require('../../plots/cartesian/axes');\nvar maxRowLength = require('../../lib').maxRowLength;\nvar getImageSize = require('./helpers').getImageSize;\nmodule.exports = function calc(gd, trace) {\n  var h;\n  var w;\n  if (trace._hasZ) {\n    h = trace.z.length;\n    w = maxRowLength(trace.z);\n  } else if (trace._hasSource) {\n    var size = getImageSize(trace.source);\n    h = size.height;\n    w = size.width;\n  }\n  var xa = Axes.getFromId(gd, trace.xaxis || 'x');\n  var ya = Axes.getFromId(gd, trace.yaxis || 'y');\n  var x0 = xa.d2c(trace.x0) - trace.dx / 2;\n  var y0 = ya.d2c(trace.y0) - trace.dy / 2;\n\n  // Set axis range\n  var i;\n  var xrange = [x0, x0 + w * trace.dx];\n  var yrange = [y0, y0 + h * trace.dy];\n  if (xa && xa.type === 'log') for (i = 0; i < w; i++) xrange.push(x0 + i * trace.dx);\n  if (ya && ya.type === 'log') for (i = 0; i < h; i++) yrange.push(y0 + i * trace.dy);\n  trace._extremes[xa._id] = Axes.findExtremes(xa, xrange);\n  trace._extremes[ya._id] = Axes.findExtremes(ya, yrange);\n  trace._scaler = makeScaler(trace);\n  var cd0 = {\n    x0: x0,\n    y0: y0,\n    z: trace.z,\n    w: w,\n    h: h\n  };\n  return [cd0];\n};\nfunction scale(zero, ratio, min, max) {\n  return function (c) {\n    return Lib.constrain((c - zero) * ratio, min, max);\n  };\n}\nfunction constrain(min, max) {\n  return function (c) {\n    return Lib.constrain(c, min, max);\n  };\n}\n\n// Generate a function to scale color components according to zmin/zmax and the colormodel\nfunction makeScaler(trace) {\n  var cr = constants.colormodel[trace.colormodel];\n  var colormodel = cr.colormodel || trace.colormodel;\n  var n = colormodel.length;\n  trace._sArray = [];\n  // Loop over all color components\n  for (var k = 0; k < n; k++) {\n    if (cr.min[k] !== trace.zmin[k] || cr.max[k] !== trace.zmax[k]) {\n      trace._sArray.push(scale(trace.zmin[k], (cr.max[k] - cr.min[k]) / (trace.zmax[k] - trace.zmin[k]), cr.min[k], cr.max[k]));\n    } else {\n      trace._sArray.push(constrain(cr.min[k], cr.max[k]));\n    }\n  }\n  return function (pixel) {\n    var c = pixel.slice(0, n);\n    for (var k = 0; k < n; k++) {\n      var ck = c[k];\n      if (!isNumeric(ck)) return false;\n      c[k] = trace._sArray[k](ck);\n    }\n    return c;\n  };\n}","map":{"version":3,"names":["Lib","require","constants","isNumeric","Axes","maxRowLength","getImageSize","module","exports","calc","gd","trace","h","w","_hasZ","z","length","_hasSource","size","source","height","width","xa","getFromId","xaxis","ya","yaxis","x0","d2c","dx","y0","dy","i","xrange","yrange","type","push","_extremes","_id","findExtremes","_scaler","makeScaler","cd0","scale","zero","ratio","min","max","c","constrain","cr","colormodel","n","_sArray","k","zmin","zmax","pixel","slice","ck"],"sources":["E:/tog_workspace/TestFabric_main/TestFabric-main/node_modules/plotly.js/src/traces/image/calc.js"],"sourcesContent":["'use strict';\n\nvar Lib = require('../../lib');\nvar constants = require('./constants');\nvar isNumeric = require('fast-isnumeric');\nvar Axes = require('../../plots/cartesian/axes');\nvar maxRowLength = require('../../lib').maxRowLength;\nvar getImageSize = require('./helpers').getImageSize;\n\nmodule.exports = function calc(gd, trace) {\n    var h;\n    var w;\n    if(trace._hasZ) {\n        h = trace.z.length;\n        w = maxRowLength(trace.z);\n    } else if(trace._hasSource) {\n        var size = getImageSize(trace.source);\n        h = size.height;\n        w = size.width;\n    }\n\n    var xa = Axes.getFromId(gd, trace.xaxis || 'x');\n    var ya = Axes.getFromId(gd, trace.yaxis || 'y');\n\n    var x0 = xa.d2c(trace.x0) - trace.dx / 2;\n    var y0 = ya.d2c(trace.y0) - trace.dy / 2;\n\n    // Set axis range\n    var i;\n    var xrange = [x0, x0 + w * trace.dx];\n    var yrange = [y0, y0 + h * trace.dy];\n    if(xa && xa.type === 'log') for(i = 0; i < w; i++) xrange.push(x0 + i * trace.dx);\n    if(ya && ya.type === 'log') for(i = 0; i < h; i++) yrange.push(y0 + i * trace.dy);\n    trace._extremes[xa._id] = Axes.findExtremes(xa, xrange);\n    trace._extremes[ya._id] = Axes.findExtremes(ya, yrange);\n    trace._scaler = makeScaler(trace);\n\n    var cd0 = {\n        x0: x0,\n        y0: y0,\n        z: trace.z,\n        w: w,\n        h: h\n    };\n    return [cd0];\n};\n\nfunction scale(zero, ratio, min, max) {\n    return function(c) {\n        return Lib.constrain((c - zero) * ratio, min, max);\n    };\n}\n\nfunction constrain(min, max) {\n    return function(c) { return Lib.constrain(c, min, max);};\n}\n\n// Generate a function to scale color components according to zmin/zmax and the colormodel\nfunction makeScaler(trace) {\n    var cr = constants.colormodel[trace.colormodel];\n    var colormodel = (cr.colormodel || trace.colormodel);\n    var n = colormodel.length;\n\n    trace._sArray = [];\n    // Loop over all color components\n    for(var k = 0; k < n; k++) {\n        if(cr.min[k] !== trace.zmin[k] || cr.max[k] !== trace.zmax[k]) {\n            trace._sArray.push(scale(\n                trace.zmin[k],\n                (cr.max[k] - cr.min[k]) / (trace.zmax[k] - trace.zmin[k]),\n                cr.min[k],\n                cr.max[k]\n            ));\n        } else {\n            trace._sArray.push(constrain(cr.min[k], cr.max[k]));\n        }\n    }\n\n    return function(pixel) {\n        var c = pixel.slice(0, n);\n        for(var k = 0; k < n; k++) {\n            var ck = c[k];\n            if(!isNumeric(ck)) return false;\n            c[k] = trace._sArray[k](ck);\n        }\n        return c;\n    };\n}\n"],"mappings":"AAAA,YAAY;;AAEZ,IAAIA,GAAG,GAAGC,OAAO,CAAC,WAAW,CAAC;AAC9B,IAAIC,SAAS,GAAGD,OAAO,CAAC,aAAa,CAAC;AACtC,IAAIE,SAAS,GAAGF,OAAO,CAAC,gBAAgB,CAAC;AACzC,IAAIG,IAAI,GAAGH,OAAO,CAAC,4BAA4B,CAAC;AAChD,IAAII,YAAY,GAAGJ,OAAO,CAAC,WAAW,CAAC,CAACI,YAAY;AACpD,IAAIC,YAAY,GAAGL,OAAO,CAAC,WAAW,CAAC,CAACK,YAAY;AAEpDC,MAAM,CAACC,OAAO,GAAG,SAASC,IAAIA,CAACC,EAAE,EAAEC,KAAK,EAAE;EACtC,IAAIC,CAAC;EACL,IAAIC,CAAC;EACL,IAAGF,KAAK,CAACG,KAAK,EAAE;IACZF,CAAC,GAAGD,KAAK,CAACI,CAAC,CAACC,MAAM;IAClBH,CAAC,GAAGR,YAAY,CAACM,KAAK,CAACI,CAAC,CAAC;EAC7B,CAAC,MAAM,IAAGJ,KAAK,CAACM,UAAU,EAAE;IACxB,IAAIC,IAAI,GAAGZ,YAAY,CAACK,KAAK,CAACQ,MAAM,CAAC;IACrCP,CAAC,GAAGM,IAAI,CAACE,MAAM;IACfP,CAAC,GAAGK,IAAI,CAACG,KAAK;EAClB;EAEA,IAAIC,EAAE,GAAGlB,IAAI,CAACmB,SAAS,CAACb,EAAE,EAAEC,KAAK,CAACa,KAAK,IAAI,GAAG,CAAC;EAC/C,IAAIC,EAAE,GAAGrB,IAAI,CAACmB,SAAS,CAACb,EAAE,EAAEC,KAAK,CAACe,KAAK,IAAI,GAAG,CAAC;EAE/C,IAAIC,EAAE,GAAGL,EAAE,CAACM,GAAG,CAACjB,KAAK,CAACgB,EAAE,CAAC,GAAGhB,KAAK,CAACkB,EAAE,GAAG,CAAC;EACxC,IAAIC,EAAE,GAAGL,EAAE,CAACG,GAAG,CAACjB,KAAK,CAACmB,EAAE,CAAC,GAAGnB,KAAK,CAACoB,EAAE,GAAG,CAAC;;EAExC;EACA,IAAIC,CAAC;EACL,IAAIC,MAAM,GAAG,CAACN,EAAE,EAAEA,EAAE,GAAGd,CAAC,GAAGF,KAAK,CAACkB,EAAE,CAAC;EACpC,IAAIK,MAAM,GAAG,CAACJ,EAAE,EAAEA,EAAE,GAAGlB,CAAC,GAAGD,KAAK,CAACoB,EAAE,CAAC;EACpC,IAAGT,EAAE,IAAIA,EAAE,CAACa,IAAI,KAAK,KAAK,EAAE,KAAIH,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGnB,CAAC,EAAEmB,CAAC,EAAE,EAAEC,MAAM,CAACG,IAAI,CAACT,EAAE,GAAGK,CAAC,GAAGrB,KAAK,CAACkB,EAAE,CAAC;EACjF,IAAGJ,EAAE,IAAIA,EAAE,CAACU,IAAI,KAAK,KAAK,EAAE,KAAIH,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGpB,CAAC,EAAEoB,CAAC,EAAE,EAAEE,MAAM,CAACE,IAAI,CAACN,EAAE,GAAGE,CAAC,GAAGrB,KAAK,CAACoB,EAAE,CAAC;EACjFpB,KAAK,CAAC0B,SAAS,CAACf,EAAE,CAACgB,GAAG,CAAC,GAAGlC,IAAI,CAACmC,YAAY,CAACjB,EAAE,EAAEW,MAAM,CAAC;EACvDtB,KAAK,CAAC0B,SAAS,CAACZ,EAAE,CAACa,GAAG,CAAC,GAAGlC,IAAI,CAACmC,YAAY,CAACd,EAAE,EAAES,MAAM,CAAC;EACvDvB,KAAK,CAAC6B,OAAO,GAAGC,UAAU,CAAC9B,KAAK,CAAC;EAEjC,IAAI+B,GAAG,GAAG;IACNf,EAAE,EAAEA,EAAE;IACNG,EAAE,EAAEA,EAAE;IACNf,CAAC,EAAEJ,KAAK,CAACI,CAAC;IACVF,CAAC,EAAEA,CAAC;IACJD,CAAC,EAAEA;EACP,CAAC;EACD,OAAO,CAAC8B,GAAG,CAAC;AAChB,CAAC;AAED,SAASC,KAAKA,CAACC,IAAI,EAAEC,KAAK,EAAEC,GAAG,EAAEC,GAAG,EAAE;EAClC,OAAO,UAASC,CAAC,EAAE;IACf,OAAOhD,GAAG,CAACiD,SAAS,CAAC,CAACD,CAAC,GAAGJ,IAAI,IAAIC,KAAK,EAAEC,GAAG,EAAEC,GAAG,CAAC;EACtD,CAAC;AACL;AAEA,SAASE,SAASA,CAACH,GAAG,EAAEC,GAAG,EAAE;EACzB,OAAO,UAASC,CAAC,EAAE;IAAE,OAAOhD,GAAG,CAACiD,SAAS,CAACD,CAAC,EAAEF,GAAG,EAAEC,GAAG,CAAC;EAAC,CAAC;AAC5D;;AAEA;AACA,SAASN,UAAUA,CAAC9B,KAAK,EAAE;EACvB,IAAIuC,EAAE,GAAGhD,SAAS,CAACiD,UAAU,CAACxC,KAAK,CAACwC,UAAU,CAAC;EAC/C,IAAIA,UAAU,GAAID,EAAE,CAACC,UAAU,IAAIxC,KAAK,CAACwC,UAAW;EACpD,IAAIC,CAAC,GAAGD,UAAU,CAACnC,MAAM;EAEzBL,KAAK,CAAC0C,OAAO,GAAG,EAAE;EAClB;EACA,KAAI,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,CAAC,EAAEE,CAAC,EAAE,EAAE;IACvB,IAAGJ,EAAE,CAACJ,GAAG,CAACQ,CAAC,CAAC,KAAK3C,KAAK,CAAC4C,IAAI,CAACD,CAAC,CAAC,IAAIJ,EAAE,CAACH,GAAG,CAACO,CAAC,CAAC,KAAK3C,KAAK,CAAC6C,IAAI,CAACF,CAAC,CAAC,EAAE;MAC3D3C,KAAK,CAAC0C,OAAO,CAACjB,IAAI,CAACO,KAAK,CACpBhC,KAAK,CAAC4C,IAAI,CAACD,CAAC,CAAC,EACb,CAACJ,EAAE,CAACH,GAAG,CAACO,CAAC,CAAC,GAAGJ,EAAE,CAACJ,GAAG,CAACQ,CAAC,CAAC,KAAK3C,KAAK,CAAC6C,IAAI,CAACF,CAAC,CAAC,GAAG3C,KAAK,CAAC4C,IAAI,CAACD,CAAC,CAAC,CAAC,EACzDJ,EAAE,CAACJ,GAAG,CAACQ,CAAC,CAAC,EACTJ,EAAE,CAACH,GAAG,CAACO,CAAC,CACZ,CAAC,CAAC;IACN,CAAC,MAAM;MACH3C,KAAK,CAAC0C,OAAO,CAACjB,IAAI,CAACa,SAAS,CAACC,EAAE,CAACJ,GAAG,CAACQ,CAAC,CAAC,EAAEJ,EAAE,CAACH,GAAG,CAACO,CAAC,CAAC,CAAC,CAAC;IACvD;EACJ;EAEA,OAAO,UAASG,KAAK,EAAE;IACnB,IAAIT,CAAC,GAAGS,KAAK,CAACC,KAAK,CAAC,CAAC,EAAEN,CAAC,CAAC;IACzB,KAAI,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,CAAC,EAAEE,CAAC,EAAE,EAAE;MACvB,IAAIK,EAAE,GAAGX,CAAC,CAACM,CAAC,CAAC;MACb,IAAG,CAACnD,SAAS,CAACwD,EAAE,CAAC,EAAE,OAAO,KAAK;MAC/BX,CAAC,CAACM,CAAC,CAAC,GAAG3C,KAAK,CAAC0C,OAAO,CAACC,CAAC,CAAC,CAACK,EAAE,CAAC;IAC/B;IACA,OAAOX,CAAC;EACZ,CAAC;AACL","ignoreList":[]},"metadata":{},"sourceType":"script"}