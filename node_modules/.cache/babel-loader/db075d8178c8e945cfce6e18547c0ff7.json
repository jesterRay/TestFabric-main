{"ast":null,"code":"'use strict';\n\n/* global MathJax:false */\nvar d3 = require('@plotly/d3');\nvar Lib = require('../lib');\nvar strTranslate = Lib.strTranslate;\nvar xmlnsNamespaces = require('../constants/xmlns_namespaces');\nvar LINE_SPACING = require('../constants/alignment').LINE_SPACING;\n\n// text converter\n\nvar FIND_TEX = /([^$]*)([$]+[^$]*[$]+)([^$]*)/;\nexports.convertToTspans = function (_context, gd, _callback) {\n  var str = _context.text();\n\n  // Until we get tex integrated more fully (so it can be used along with non-tex)\n  // allow some elements to prohibit it by attaching 'data-notex' to the original\n  var tex = !_context.attr('data-notex') && gd && gd._context.typesetMath && typeof MathJax !== 'undefined' && str.match(FIND_TEX);\n  var parent = d3.select(_context.node().parentNode);\n  if (parent.empty()) return;\n  var svgClass = _context.attr('class') ? _context.attr('class').split(' ')[0] : 'text';\n  svgClass += '-math';\n  parent.selectAll('svg.' + svgClass).remove();\n  parent.selectAll('g.' + svgClass + '-group').remove();\n  _context.style('display', null).attr({\n    // some callers use data-unformatted *from the <text> element* in 'cancel'\n    // so we need it here even if we're going to turn it into math\n    // these two (plus style and text-anchor attributes) form the key we're\n    // going to use for Drawing.bBox\n    'data-unformatted': str,\n    'data-math': 'N'\n  });\n  function showText() {\n    if (!parent.empty()) {\n      svgClass = _context.attr('class') + '-math';\n      parent.select('svg.' + svgClass).remove();\n    }\n    _context.text('').style('white-space', 'pre');\n    var hasLink = buildSVGText(_context.node(), str);\n    if (hasLink) {\n      // at least in Chrome, pointer-events does not seem\n      // to be honored in children of <text> elements\n      // so if we have an anchor, we have to make the\n      // whole element respond\n      _context.style('pointer-events', 'all');\n    }\n    exports.positionText(_context);\n    if (_callback) _callback.call(_context);\n  }\n  if (tex) {\n    (gd && gd._promises || []).push(new Promise(function (resolve) {\n      _context.style('display', 'none');\n      var fontSize = parseInt(_context.node().style.fontSize, 10);\n      var config = {\n        fontSize: fontSize\n      };\n      texToSVG(tex[2], config, function (_svgEl, _glyphDefs, _svgBBox) {\n        parent.selectAll('svg.' + svgClass).remove();\n        parent.selectAll('g.' + svgClass + '-group').remove();\n        var newSvg = _svgEl && _svgEl.select('svg');\n        if (!newSvg || !newSvg.node()) {\n          showText();\n          resolve();\n          return;\n        }\n        var mathjaxGroup = parent.append('g').classed(svgClass + '-group', true).attr({\n          'pointer-events': 'none',\n          'data-unformatted': str,\n          'data-math': 'Y'\n        });\n        mathjaxGroup.node().appendChild(newSvg.node());\n\n        // stitch the glyph defs\n        if (_glyphDefs && _glyphDefs.node()) {\n          newSvg.node().insertBefore(_glyphDefs.node().cloneNode(true), newSvg.node().firstChild);\n        }\n        var w0 = _svgBBox.width;\n        var h0 = _svgBBox.height;\n        newSvg.attr({\n          class: svgClass,\n          height: h0,\n          preserveAspectRatio: 'xMinYMin meet'\n        }).style({\n          overflow: 'visible',\n          'pointer-events': 'none'\n        });\n        var fill = _context.node().style.fill || 'black';\n        var g = newSvg.select('g');\n        g.attr({\n          fill: fill,\n          stroke: fill\n        });\n        var bb = g.node().getBoundingClientRect();\n        var w = bb.width;\n        var h = bb.height;\n        if (w > w0 || h > h0) {\n          // this happen in firefox v82+ | see https://bugzilla.mozilla.org/show_bug.cgi?id=1709251 addressed\n          // temporary fix:\n          newSvg.style('overflow', 'hidden');\n          bb = newSvg.node().getBoundingClientRect();\n          w = bb.width;\n          h = bb.height;\n        }\n        var x = +_context.attr('x');\n        var y = +_context.attr('y');\n\n        // font baseline is about 1/4 fontSize below centerline\n        var textHeight = fontSize || _context.node().getBoundingClientRect().height;\n        var dy = -textHeight / 4;\n        if (svgClass[0] === 'y') {\n          mathjaxGroup.attr({\n            transform: 'rotate(' + [-90, x, y] + ')' + strTranslate(-w / 2, dy - h / 2)\n          });\n        } else if (svgClass[0] === 'l') {\n          y = dy - h / 2;\n        } else if (svgClass[0] === 'a' && svgClass.indexOf('atitle') !== 0) {\n          x = 0;\n          y = dy;\n        } else {\n          var anchor = _context.attr('text-anchor');\n          x = x - w * (anchor === 'middle' ? 0.5 : anchor === 'end' ? 1 : 0);\n          y = y + dy - h / 2;\n        }\n        newSvg.attr({\n          x: x,\n          y: y\n        });\n        if (_callback) _callback.call(_context, mathjaxGroup);\n        resolve(mathjaxGroup);\n      });\n    }));\n  } else showText();\n  return _context;\n};\n\n// MathJax\n\nvar LT_MATCH = /(<|&lt;|&#60;)/g;\nvar GT_MATCH = /(>|&gt;|&#62;)/g;\nfunction cleanEscapesForTex(s) {\n  return s.replace(LT_MATCH, '\\\\lt ').replace(GT_MATCH, '\\\\gt ');\n}\nvar inlineMath = [['$', '$'], ['\\\\(', '\\\\)']];\nfunction texToSVG(_texString, _config, _callback) {\n  var MathJaxVersion = parseInt((MathJax.version || '').split('.')[0]);\n  if (MathJaxVersion !== 2 && MathJaxVersion !== 3) {\n    Lib.warn('No MathJax version:', MathJax.version);\n    return;\n  }\n  var originalRenderer, originalConfig, originalProcessSectionDelay, tmpDiv;\n  var setConfig2 = function () {\n    originalConfig = Lib.extendDeepAll({}, MathJax.Hub.config);\n    originalProcessSectionDelay = MathJax.Hub.processSectionDelay;\n    if (MathJax.Hub.processSectionDelay !== undefined) {\n      // MathJax 2.5+ but not 3+\n      MathJax.Hub.processSectionDelay = 0;\n    }\n    return MathJax.Hub.Config({\n      messageStyle: 'none',\n      tex2jax: {\n        inlineMath: inlineMath\n      },\n      displayAlign: 'left'\n    });\n  };\n  var setConfig3 = function () {\n    originalConfig = Lib.extendDeepAll({}, MathJax.config);\n    if (!MathJax.config.tex) {\n      MathJax.config.tex = {};\n    }\n    MathJax.config.tex.inlineMath = inlineMath;\n  };\n  var setRenderer2 = function () {\n    originalRenderer = MathJax.Hub.config.menuSettings.renderer;\n    if (originalRenderer !== 'SVG') {\n      return MathJax.Hub.setRenderer('SVG');\n    }\n  };\n  var setRenderer3 = function () {\n    originalRenderer = MathJax.config.startup.output;\n    if (originalRenderer !== 'svg') {\n      MathJax.config.startup.output = 'svg';\n    }\n  };\n  var initiateMathJax = function () {\n    var randomID = 'math-output-' + Lib.randstr({}, 64);\n    tmpDiv = d3.select('body').append('div').attr({\n      id: randomID\n    }).style({\n      visibility: 'hidden',\n      position: 'absolute',\n      'font-size': _config.fontSize + 'px'\n    }).text(cleanEscapesForTex(_texString));\n    var tmpNode = tmpDiv.node();\n    return MathJaxVersion === 2 ? MathJax.Hub.Typeset(tmpNode) : MathJax.typeset([tmpNode]);\n  };\n  var finalizeMathJax = function () {\n    var sel = tmpDiv.select(MathJaxVersion === 2 ? '.MathJax_SVG' : '.MathJax');\n    var node = !sel.empty() && tmpDiv.select('svg').node();\n    if (!node) {\n      Lib.log('There was an error in the tex syntax.', _texString);\n      _callback();\n    } else {\n      var nodeBBox = node.getBoundingClientRect();\n      var glyphDefs;\n      if (MathJaxVersion === 2) {\n        glyphDefs = d3.select('body').select('#MathJax_SVG_glyphs');\n      } else {\n        glyphDefs = sel.select('defs');\n      }\n      _callback(sel, glyphDefs, nodeBBox);\n    }\n    tmpDiv.remove();\n  };\n  var resetRenderer2 = function () {\n    if (originalRenderer !== 'SVG') {\n      return MathJax.Hub.setRenderer(originalRenderer);\n    }\n  };\n  var resetRenderer3 = function () {\n    if (originalRenderer !== 'svg') {\n      MathJax.config.startup.output = originalRenderer;\n    }\n  };\n  var resetConfig2 = function () {\n    if (originalProcessSectionDelay !== undefined) {\n      MathJax.Hub.processSectionDelay = originalProcessSectionDelay;\n    }\n    return MathJax.Hub.Config(originalConfig);\n  };\n  var resetConfig3 = function () {\n    MathJax.config = originalConfig;\n  };\n  if (MathJaxVersion === 2) {\n    MathJax.Hub.Queue(setConfig2, setRenderer2, initiateMathJax, finalizeMathJax, resetRenderer2, resetConfig2);\n  } else if (MathJaxVersion === 3) {\n    setConfig3();\n    setRenderer3();\n    MathJax.startup.defaultReady();\n    MathJax.startup.promise.then(function () {\n      initiateMathJax();\n      finalizeMathJax();\n      resetRenderer3();\n      resetConfig3();\n    });\n  }\n}\nvar TAG_STYLES = {\n  // would like to use baseline-shift for sub/sup but FF doesn't support it\n  // so we need to use dy along with the uber hacky shift-back-to\n  // baseline below\n  sup: 'font-size:70%',\n  sub: 'font-size:70%',\n  s: 'text-decoration:line-through',\n  u: 'text-decoration:underline',\n  b: 'font-weight:bold',\n  i: 'font-style:italic',\n  a: 'cursor:pointer',\n  span: '',\n  em: 'font-style:italic;font-weight:bold'\n};\n\n// baseline shifts for sub and sup\nvar SHIFT_DY = {\n  sub: '0.3em',\n  sup: '-0.6em'\n};\n// reset baseline by adding a tspan (empty except for a zero-width space)\n// with dy of -70% * SHIFT_DY (because font-size=70%)\nvar RESET_DY = {\n  sub: '-0.21em',\n  sup: '0.42em'\n};\nvar ZERO_WIDTH_SPACE = '\\u200b';\n\n/*\n * Whitelist of protocols in user-supplied urls. Mostly we want to avoid javascript\n * and related attack vectors. The empty items are there for IE, that in various\n * versions treats relative paths as having different flavors of no protocol, while\n * other browsers have these explicitly inherit the protocol of the page they're in.\n */\nvar PROTOCOLS = ['http:', 'https:', 'mailto:', '', undefined, ':'];\nvar NEWLINES = exports.NEWLINES = /(\\r\\n?|\\n)/g;\nvar SPLIT_TAGS = /(<[^<>]*>)/;\nvar ONE_TAG = /<(\\/?)([^ >]*)(\\s+(.*))?>/i;\nvar BR_TAG = /<br(\\s+.*)?>/i;\nexports.BR_TAG_ALL = /<br(\\s+.*)?>/gi;\n\n/*\n * style and href: pull them out of either single or double quotes. Also\n * - target: (_blank|_self|_parent|_top|framename)\n *     note that you can't use target to get a popup but if you use popup,\n *     a `framename` will be passed along as the name of the popup window.\n *     per the spec, cannot contain whitespace.\n *     for backward compatibility we default to '_blank'\n * - popup: a custom one for us to enable popup (new window) links. String\n *     for window.open -> strWindowFeatures, like 'menubar=yes,width=500,height=550'\n *     note that at least in Chrome, you need to give at least one property\n *     in this string or the page will open in a new tab anyway. We follow this\n *     convention and will not make a popup if this string is empty.\n *     per the spec, cannot contain whitespace.\n *\n * Because we hack in other attributes with style (sub & sup), drop any trailing\n * semicolon in user-supplied styles so we can consistently append the tag-dependent style\n *\n * These are for tag attributes; Chrome anyway will convert entities in\n * attribute values, but not in attribute names\n * you can test this by for example:\n * > p = document.createElement('p')\n * > p.innerHTML = '<span styl&#x65;=\"font-color:r&#x65;d;\">Hi</span>'\n * > p.innerHTML\n * <- '<span styl&#x65;=\"font-color:red;\">Hi</span>'\n */\nvar STYLEMATCH = /(^|[\\s\"'])style\\s*=\\s*(\"([^\"]*);?\"|'([^']*);?')/i;\nvar HREFMATCH = /(^|[\\s\"'])href\\s*=\\s*(\"([^\"]*)\"|'([^']*)')/i;\nvar TARGETMATCH = /(^|[\\s\"'])target\\s*=\\s*(\"([^\"\\s]*)\"|'([^'\\s]*)')/i;\nvar POPUPMATCH = /(^|[\\s\"'])popup\\s*=\\s*(\"([\\w=,]*)\"|'([\\w=,]*)')/i;\n\n// dedicated matcher for these quoted regexes, that can return their results\n// in two different places\nfunction getQuotedMatch(_str, re) {\n  if (!_str) return null;\n  var match = _str.match(re);\n  var result = match && (match[3] || match[4]);\n  return result && convertEntities(result);\n}\nvar COLORMATCH = /(^|;)\\s*color:/;\n\n/**\n * Strip string of tags\n *\n * @param {string} _str : input string\n * @param {object} opts :\n * - len {number} max length of output string\n * - allowedTags {array} list of pseudo-html tags to NOT strip\n * @return {string}\n */\nexports.plainText = function (_str, opts) {\n  opts = opts || {};\n  var len = opts.len !== undefined && opts.len !== -1 ? opts.len : Infinity;\n  var allowedTags = opts.allowedTags !== undefined ? opts.allowedTags : ['br'];\n  var ellipsis = '...';\n  var eLen = ellipsis.length;\n  var oldParts = _str.split(SPLIT_TAGS);\n  var newParts = [];\n  var prevTag = '';\n  var l = 0;\n  for (var i = 0; i < oldParts.length; i++) {\n    var p = oldParts[i];\n    var match = p.match(ONE_TAG);\n    var tagType = match && match[2].toLowerCase();\n    if (tagType) {\n      // N.B. tags do not count towards string length\n      if (allowedTags.indexOf(tagType) !== -1) {\n        newParts.push(p);\n        prevTag = tagType;\n      }\n    } else {\n      var pLen = p.length;\n      if (l + pLen < len) {\n        newParts.push(p);\n        l += pLen;\n      } else if (l < len) {\n        var pLen2 = len - l;\n        if (prevTag && (prevTag !== 'br' || pLen2 <= eLen || pLen <= eLen)) {\n          newParts.pop();\n        }\n        if (len > eLen) {\n          newParts.push(p.substr(0, pLen2 - eLen) + ellipsis);\n        } else {\n          newParts.push(p.substr(0, pLen2));\n        }\n        break;\n      }\n      prevTag = '';\n    }\n  }\n  return newParts.join('');\n};\n\n/*\n * N.B. HTML entities are listed without the leading '&' and trailing ';'\n * https://www.freeformatter.com/html-entities.html\n *\n * FWIW if we wanted to support the full set, it has 2261 entries:\n * https://www.w3.org/TR/html5/entities.json\n * though I notice that some of these are duplicates and/or are missing \";\"\n * eg: \"&amp;\", \"&amp\", \"&AMP;\", and \"&AMP\" all map to \"&\"\n * We no longer need to include numeric entities here, these are now handled\n * by String.fromCodePoint/fromCharCode\n *\n * Anyway the only ones that are really important to allow are the HTML special\n * chars <, >, and &, because these ones can trigger special processing if not\n * replaced by the corresponding entity.\n */\nvar entityToUnicode = {\n  mu: 'μ',\n  amp: '&',\n  lt: '<',\n  gt: '>',\n  nbsp: ' ',\n  times: '×',\n  plusmn: '±',\n  deg: '°'\n};\n\n// NOTE: in general entities can contain uppercase too (so [a-zA-Z]) but all the\n// ones we support use only lowercase. If we ever change that, update the regex.\nvar ENTITY_MATCH = /&(#\\d+|#x[\\da-fA-F]+|[a-z]+);/g;\nfunction convertEntities(_str) {\n  return _str.replace(ENTITY_MATCH, function (fullMatch, innerMatch) {\n    var outChar;\n    if (innerMatch.charAt(0) === '#') {\n      // cannot use String.fromCodePoint in IE\n      outChar = fromCodePoint(innerMatch.charAt(1) === 'x' ? parseInt(innerMatch.substr(2), 16) : parseInt(innerMatch.substr(1), 10));\n    } else outChar = entityToUnicode[innerMatch];\n\n    // as in regular HTML, if we didn't decode the entity just\n    // leave the raw text in place.\n    return outChar || fullMatch;\n  });\n}\nexports.convertEntities = convertEntities;\nfunction fromCodePoint(code) {\n  // Don't allow overflow. In Chrome this turns into � but I feel like it's\n  // more useful to just not convert it at all.\n  if (code > 0x10FFFF) return;\n  var stringFromCodePoint = String.fromCodePoint;\n  if (stringFromCodePoint) return stringFromCodePoint(code);\n\n  // IE doesn't have String.fromCodePoint\n  // see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/fromCodePoint\n  var stringFromCharCode = String.fromCharCode;\n  if (code <= 0xFFFF) return stringFromCharCode(code);\n  return stringFromCharCode((code >> 10) + 0xD7C0, code % 0x400 + 0xDC00);\n}\n\n/*\n * buildSVGText: convert our pseudo-html into SVG tspan elements, and attach these\n * to containerNode\n *\n * @param {svg text element} containerNode: the <text> node to insert this text into\n * @param {string} str: the pseudo-html string to convert to svg\n *\n * @returns {bool}: does the result contain any links? We need to handle the text element\n *   somewhat differently if it does, so just keep track of this when it happens.\n */\nfunction buildSVGText(containerNode, str) {\n  /*\n   * Normalize behavior between IE and others wrt newlines and whitespace:pre\n   * this combination makes IE barf https://github.com/plotly/plotly.js/issues/746\n   * Chrome and FF display \\n, \\r, or \\r\\n as a space in this mode.\n   * I feel like at some point we turned these into <br> but currently we don't so\n   * I'm just going to cement what we do now in Chrome and FF\n   */\n  str = str.replace(NEWLINES, ' ');\n  var hasLink = false;\n\n  // as we're building the text, keep track of what elements we're nested inside\n  // nodeStack will be an array of {node, type, style, href, target, popup}\n  // where only type: 'a' gets the last 3 and node is only added when it's created\n  var nodeStack = [];\n  var currentNode;\n  var currentLine = -1;\n  function newLine() {\n    currentLine++;\n    var lineNode = document.createElementNS(xmlnsNamespaces.svg, 'tspan');\n    d3.select(lineNode).attr({\n      class: 'line',\n      dy: currentLine * LINE_SPACING + 'em'\n    });\n    containerNode.appendChild(lineNode);\n    currentNode = lineNode;\n    var oldNodeStack = nodeStack;\n    nodeStack = [{\n      node: lineNode\n    }];\n    if (oldNodeStack.length > 1) {\n      for (var i = 1; i < oldNodeStack.length; i++) {\n        enterNode(oldNodeStack[i]);\n      }\n    }\n  }\n  function enterNode(nodeSpec) {\n    var type = nodeSpec.type;\n    var nodeAttrs = {};\n    var nodeType;\n    if (type === 'a') {\n      nodeType = 'a';\n      var target = nodeSpec.target;\n      var href = nodeSpec.href;\n      var popup = nodeSpec.popup;\n      if (href) {\n        nodeAttrs = {\n          'xlink:xlink:show': target === '_blank' || target.charAt(0) !== '_' ? 'new' : 'replace',\n          target: target,\n          'xlink:xlink:href': href\n        };\n        if (popup) {\n          // security: href and target are not inserted as code but\n          // as attributes. popup is, but limited to /[A-Za-z0-9_=,]/\n          nodeAttrs.onclick = 'window.open(this.href.baseVal,this.target.baseVal,\"' + popup + '\");return false;';\n        }\n      }\n    } else nodeType = 'tspan';\n    if (nodeSpec.style) nodeAttrs.style = nodeSpec.style;\n    var newNode = document.createElementNS(xmlnsNamespaces.svg, nodeType);\n    if (type === 'sup' || type === 'sub') {\n      addTextNode(currentNode, ZERO_WIDTH_SPACE);\n      currentNode.appendChild(newNode);\n      var resetter = document.createElementNS(xmlnsNamespaces.svg, 'tspan');\n      addTextNode(resetter, ZERO_WIDTH_SPACE);\n      d3.select(resetter).attr('dy', RESET_DY[type]);\n      nodeAttrs.dy = SHIFT_DY[type];\n      currentNode.appendChild(newNode);\n      currentNode.appendChild(resetter);\n    } else {\n      currentNode.appendChild(newNode);\n    }\n    d3.select(newNode).attr(nodeAttrs);\n    currentNode = nodeSpec.node = newNode;\n    nodeStack.push(nodeSpec);\n  }\n  function addTextNode(node, text) {\n    node.appendChild(document.createTextNode(text));\n  }\n  function exitNode(type) {\n    // A bare closing tag can't close the root node. If we encounter this it\n    // means there's an extra closing tag that can just be ignored:\n    if (nodeStack.length === 1) {\n      Lib.log('Ignoring unexpected end tag </' + type + '>.', str);\n      return;\n    }\n    var innerNode = nodeStack.pop();\n    if (type !== innerNode.type) {\n      Lib.log('Start tag <' + innerNode.type + '> doesnt match end tag <' + type + '>. Pretending it did match.', str);\n    }\n    currentNode = nodeStack[nodeStack.length - 1].node;\n  }\n  var hasLines = BR_TAG.test(str);\n  if (hasLines) newLine();else {\n    currentNode = containerNode;\n    nodeStack = [{\n      node: containerNode\n    }];\n  }\n  var parts = str.split(SPLIT_TAGS);\n  for (var i = 0; i < parts.length; i++) {\n    var parti = parts[i];\n    var match = parti.match(ONE_TAG);\n    var tagType = match && match[2].toLowerCase();\n    var tagStyle = TAG_STYLES[tagType];\n    if (tagType === 'br') {\n      newLine();\n    } else if (tagStyle === undefined) {\n      addTextNode(currentNode, convertEntities(parti));\n    } else {\n      // tag - open or close\n      if (match[1]) {\n        exitNode(tagType);\n      } else {\n        var extra = match[4];\n        var nodeSpec = {\n          type: tagType\n        };\n\n        // now add style, from both the tag name and any extra css\n        // Most of the svg css that users will care about is just like html,\n        // but font color is different (uses fill). Let our users ignore this.\n        var css = getQuotedMatch(extra, STYLEMATCH);\n        if (css) {\n          css = css.replace(COLORMATCH, '$1 fill:');\n          if (tagStyle) css += ';' + tagStyle;\n        } else if (tagStyle) css = tagStyle;\n        if (css) nodeSpec.style = css;\n        if (tagType === 'a') {\n          hasLink = true;\n          var href = getQuotedMatch(extra, HREFMATCH);\n          if (href) {\n            var safeHref = sanitizeHref(href);\n            if (safeHref) {\n              nodeSpec.href = safeHref;\n              nodeSpec.target = getQuotedMatch(extra, TARGETMATCH) || '_blank';\n              nodeSpec.popup = getQuotedMatch(extra, POPUPMATCH);\n            }\n          }\n        }\n        enterNode(nodeSpec);\n      }\n    }\n  }\n  return hasLink;\n}\nfunction sanitizeHref(href) {\n  var decodedHref = encodeURI(decodeURI(href));\n  var dummyAnchor1 = document.createElement('a');\n  var dummyAnchor2 = document.createElement('a');\n  dummyAnchor1.href = href;\n  dummyAnchor2.href = decodedHref;\n  var p1 = dummyAnchor1.protocol;\n  var p2 = dummyAnchor2.protocol;\n\n  // check safe protocols\n  if (PROTOCOLS.indexOf(p1) !== -1 && PROTOCOLS.indexOf(p2) !== -1) {\n    return decodedHref;\n  } else {\n    return '';\n  }\n}\n\n/*\n * sanitizeHTML: port of buildSVGText aimed at providing a clean subset of HTML\n * @param {string} str: the html string to clean\n * @returns {string}: a cleaned and normalized version of the input,\n *     supporting only a small subset of html\n */\nexports.sanitizeHTML = function sanitizeHTML(str) {\n  str = str.replace(NEWLINES, ' ');\n  var rootNode = document.createElement('p');\n  var currentNode = rootNode;\n  var nodeStack = [];\n  var parts = str.split(SPLIT_TAGS);\n  for (var i = 0; i < parts.length; i++) {\n    var parti = parts[i];\n    var match = parti.match(ONE_TAG);\n    var tagType = match && match[2].toLowerCase();\n    if (tagType in TAG_STYLES) {\n      if (match[1]) {\n        if (nodeStack.length) {\n          currentNode = nodeStack.pop();\n        }\n      } else {\n        var extra = match[4];\n        var css = getQuotedMatch(extra, STYLEMATCH);\n        var nodeAttrs = css ? {\n          style: css\n        } : {};\n        if (tagType === 'a') {\n          var href = getQuotedMatch(extra, HREFMATCH);\n          if (href) {\n            var safeHref = sanitizeHref(href);\n            if (safeHref) {\n              nodeAttrs.href = safeHref;\n              var target = getQuotedMatch(extra, TARGETMATCH);\n              if (target) {\n                nodeAttrs.target = target;\n              }\n            }\n          }\n        }\n        var newNode = document.createElement(tagType);\n        currentNode.appendChild(newNode);\n        d3.select(newNode).attr(nodeAttrs);\n        currentNode = newNode;\n        nodeStack.push(newNode);\n      }\n    } else {\n      currentNode.appendChild(document.createTextNode(convertEntities(parti)));\n    }\n  }\n  var key = 'innerHTML'; // i.e. to avoid pass test-syntax\n  return rootNode[key];\n};\nexports.lineCount = function lineCount(s) {\n  return s.selectAll('tspan.line').size() || 1;\n};\nexports.positionText = function positionText(s, x, y) {\n  return s.each(function () {\n    var text = d3.select(this);\n    function setOrGet(attr, val) {\n      if (val === undefined) {\n        val = text.attr(attr);\n        if (val === null) {\n          text.attr(attr, 0);\n          val = 0;\n        }\n      } else text.attr(attr, val);\n      return val;\n    }\n    var thisX = setOrGet('x', x);\n    var thisY = setOrGet('y', y);\n    if (this.nodeName === 'text') {\n      text.selectAll('tspan.line').attr({\n        x: thisX,\n        y: thisY\n      });\n    }\n  });\n};\nfunction alignHTMLWith(_base, container, options) {\n  var alignH = options.horizontalAlign;\n  var alignV = options.verticalAlign || 'top';\n  var bRect = _base.node().getBoundingClientRect();\n  var cRect = container.node().getBoundingClientRect();\n  var thisRect;\n  var getTop;\n  var getLeft;\n  if (alignV === 'bottom') {\n    getTop = function () {\n      return bRect.bottom - thisRect.height;\n    };\n  } else if (alignV === 'middle') {\n    getTop = function () {\n      return bRect.top + (bRect.height - thisRect.height) / 2;\n    };\n  } else {\n    // default: top\n    getTop = function () {\n      return bRect.top;\n    };\n  }\n  if (alignH === 'right') {\n    getLeft = function () {\n      return bRect.right - thisRect.width;\n    };\n  } else if (alignH === 'center') {\n    getLeft = function () {\n      return bRect.left + (bRect.width - thisRect.width) / 2;\n    };\n  } else {\n    // default: left\n    getLeft = function () {\n      return bRect.left;\n    };\n  }\n  return function () {\n    thisRect = this.node().getBoundingClientRect();\n    var x0 = getLeft() - cRect.left;\n    var y0 = getTop() - cRect.top;\n    var gd = options.gd || {};\n    if (options.gd) {\n      gd._fullLayout._calcInverseTransform(gd);\n      var transformedCoords = Lib.apply3DTransform(gd._fullLayout._invTransform)(x0, y0);\n      x0 = transformedCoords[0];\n      y0 = transformedCoords[1];\n    }\n    this.style({\n      top: y0 + 'px',\n      left: x0 + 'px',\n      'z-index': 1000\n    });\n    return this;\n  };\n}\nvar onePx = '1px ';\nexports.makeTextShadow = function (color) {\n  var x = onePx;\n  var y = onePx;\n  var b = onePx;\n  return x + y + b + color + ', ' + '-' + x + '-' + y + b + color + ', ' + x + '-' + y + b + color + ', ' + '-' + x + y + b + color;\n};\n\n/*\n * Editable title\n * @param {d3.selection} context: the element being edited. Normally text,\n *   but if it isn't, you should provide the styling options\n * @param {object} options:\n *   @param {div} options.gd: graphDiv\n *   @param {d3.selection} options.delegate: item to bind events to if not this\n *   @param {boolean} options.immediate: start editing now (true) or on click (false, default)\n *   @param {string} options.fill: font color if not as shown\n *   @param {string} options.background: background color if not as shown\n *   @param {string} options.text: initial text, if not as shown\n *   @param {string} options.horizontalAlign: alignment of the edit box wrt. the bound element\n *   @param {string} options.verticalAlign: alignment of the edit box wrt. the bound element\n */\n\nexports.makeEditable = function (context, options) {\n  var gd = options.gd;\n  var _delegate = options.delegate;\n  var dispatch = d3.dispatch('edit', 'input', 'cancel');\n  var handlerElement = _delegate || context;\n  context.style({\n    'pointer-events': _delegate ? 'none' : 'all'\n  });\n  if (context.size() !== 1) throw new Error('boo');\n  function handleClick() {\n    appendEditable();\n    context.style({\n      opacity: 0\n    });\n    // also hide any mathjax svg\n    var svgClass = handlerElement.attr('class');\n    var mathjaxClass;\n    if (svgClass) mathjaxClass = '.' + svgClass.split(' ')[0] + '-math-group';else mathjaxClass = '[class*=-math-group]';\n    if (mathjaxClass) {\n      d3.select(context.node().parentNode).select(mathjaxClass).style({\n        opacity: 0\n      });\n    }\n  }\n  function selectElementContents(_el) {\n    var el = _el.node();\n    var range = document.createRange();\n    range.selectNodeContents(el);\n    var sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range);\n    el.focus();\n  }\n  function appendEditable() {\n    var plotDiv = d3.select(gd);\n    var container = plotDiv.select('.svg-container');\n    var div = container.append('div');\n    var cStyle = context.node().style;\n    var fontSize = parseFloat(cStyle.fontSize || 12);\n    var initialText = options.text;\n    if (initialText === undefined) initialText = context.attr('data-unformatted');\n    div.classed('plugin-editable editable', true).style({\n      position: 'absolute',\n      'font-family': cStyle.fontFamily || 'Arial',\n      'font-size': fontSize,\n      color: options.fill || cStyle.fill || 'black',\n      opacity: 1,\n      'background-color': options.background || 'transparent',\n      outline: '#ffffff33 1px solid',\n      margin: [-fontSize / 8 + 1, 0, 0, -1].join('px ') + 'px',\n      padding: '0',\n      'box-sizing': 'border-box'\n    }).attr({\n      contenteditable: true\n    }).text(initialText).call(alignHTMLWith(context, container, options)).on('blur', function () {\n      gd._editing = false;\n      context.text(this.textContent).style({\n        opacity: 1\n      });\n      var svgClass = d3.select(this).attr('class');\n      var mathjaxClass;\n      if (svgClass) mathjaxClass = '.' + svgClass.split(' ')[0] + '-math-group';else mathjaxClass = '[class*=-math-group]';\n      if (mathjaxClass) {\n        d3.select(context.node().parentNode).select(mathjaxClass).style({\n          opacity: 0\n        });\n      }\n      var text = this.textContent;\n      d3.select(this).transition().duration(0).remove();\n      d3.select(document).on('mouseup', null);\n      dispatch.edit.call(context, text);\n    }).on('focus', function () {\n      var editDiv = this;\n      gd._editing = true;\n      d3.select(document).on('mouseup', function () {\n        if (d3.event.target === editDiv) return false;\n        if (document.activeElement === div.node()) div.node().blur();\n      });\n    }).on('keyup', function () {\n      if (d3.event.which === 27) {\n        gd._editing = false;\n        context.style({\n          opacity: 1\n        });\n        d3.select(this).style({\n          opacity: 0\n        }).on('blur', function () {\n          return false;\n        }).transition().remove();\n        dispatch.cancel.call(context, this.textContent);\n      } else {\n        dispatch.input.call(context, this.textContent);\n        d3.select(this).call(alignHTMLWith(context, container, options));\n      }\n    }).on('keydown', function () {\n      if (d3.event.which === 13) this.blur();\n    }).call(selectElementContents);\n  }\n  if (options.immediate) handleClick();else handlerElement.on('click', handleClick);\n  return d3.rebind(context, dispatch, 'on');\n};","map":{"version":3,"names":["d3","require","Lib","strTranslate","xmlnsNamespaces","LINE_SPACING","FIND_TEX","exports","convertToTspans","_context","gd","_callback","str","text","tex","attr","typesetMath","MathJax","match","parent","select","node","parentNode","empty","svgClass","split","selectAll","remove","style","showText","hasLink","buildSVGText","positionText","call","_promises","push","Promise","resolve","fontSize","parseInt","config","texToSVG","_svgEl","_glyphDefs","_svgBBox","newSvg","mathjaxGroup","append","classed","appendChild","insertBefore","cloneNode","firstChild","w0","width","h0","height","class","preserveAspectRatio","overflow","fill","g","stroke","bb","getBoundingClientRect","w","h","x","y","textHeight","dy","transform","indexOf","anchor","LT_MATCH","GT_MATCH","cleanEscapesForTex","s","replace","inlineMath","_texString","_config","MathJaxVersion","version","warn","originalRenderer","originalConfig","originalProcessSectionDelay","tmpDiv","setConfig2","extendDeepAll","Hub","processSectionDelay","undefined","Config","messageStyle","tex2jax","displayAlign","setConfig3","setRenderer2","menuSettings","renderer","setRenderer","setRenderer3","startup","output","initiateMathJax","randomID","randstr","id","visibility","position","tmpNode","Typeset","typeset","finalizeMathJax","sel","log","nodeBBox","glyphDefs","resetRenderer2","resetRenderer3","resetConfig2","resetConfig3","Queue","defaultReady","promise","then","TAG_STYLES","sup","sub","u","b","i","a","span","em","SHIFT_DY","RESET_DY","ZERO_WIDTH_SPACE","PROTOCOLS","NEWLINES","SPLIT_TAGS","ONE_TAG","BR_TAG","BR_TAG_ALL","STYLEMATCH","HREFMATCH","TARGETMATCH","POPUPMATCH","getQuotedMatch","_str","re","result","convertEntities","COLORMATCH","plainText","opts","len","Infinity","allowedTags","ellipsis","eLen","length","oldParts","newParts","prevTag","l","p","tagType","toLowerCase","pLen","pLen2","pop","substr","join","entityToUnicode","mu","amp","lt","gt","nbsp","times","plusmn","deg","ENTITY_MATCH","fullMatch","innerMatch","outChar","charAt","fromCodePoint","code","stringFromCodePoint","String","stringFromCharCode","fromCharCode","containerNode","nodeStack","currentNode","currentLine","newLine","lineNode","document","createElementNS","svg","oldNodeStack","enterNode","nodeSpec","type","nodeAttrs","nodeType","target","href","popup","onclick","newNode","addTextNode","resetter","createTextNode","exitNode","innerNode","hasLines","test","parts","parti","tagStyle","extra","css","safeHref","sanitizeHref","decodedHref","encodeURI","decodeURI","dummyAnchor1","createElement","dummyAnchor2","p1","protocol","p2","sanitizeHTML","rootNode","key","lineCount","size","each","setOrGet","val","thisX","thisY","nodeName","alignHTMLWith","_base","container","options","alignH","horizontalAlign","alignV","verticalAlign","bRect","cRect","thisRect","getTop","getLeft","bottom","top","right","left","x0","y0","_fullLayout","_calcInverseTransform","transformedCoords","apply3DTransform","_invTransform","onePx","makeTextShadow","color","makeEditable","context","_delegate","delegate","dispatch","handlerElement","Error","handleClick","appendEditable","opacity","mathjaxClass","selectElementContents","_el","el","range","createRange","selectNodeContents","window","getSelection","removeAllRanges","addRange","focus","plotDiv","div","cStyle","parseFloat","initialText","fontFamily","background","outline","margin","padding","contenteditable","on","_editing","textContent","transition","duration","edit","editDiv","event","activeElement","blur","which","cancel","input","immediate","rebind"],"sources":["E:/tog_workspace/TestFabric_main/TestFabric-main/node_modules/plotly.js/src/lib/svg_text_utils.js"],"sourcesContent":["'use strict';\n\n/* global MathJax:false */\n\nvar d3 = require('@plotly/d3');\n\nvar Lib = require('../lib');\nvar strTranslate = Lib.strTranslate;\nvar xmlnsNamespaces = require('../constants/xmlns_namespaces');\nvar LINE_SPACING = require('../constants/alignment').LINE_SPACING;\n\n// text converter\n\nvar FIND_TEX = /([^$]*)([$]+[^$]*[$]+)([^$]*)/;\n\nexports.convertToTspans = function(_context, gd, _callback) {\n    var str = _context.text();\n\n    // Until we get tex integrated more fully (so it can be used along with non-tex)\n    // allow some elements to prohibit it by attaching 'data-notex' to the original\n    var tex = (!_context.attr('data-notex')) &&\n        gd && gd._context.typesetMath &&\n        (typeof MathJax !== 'undefined') &&\n        str.match(FIND_TEX);\n\n    var parent = d3.select(_context.node().parentNode);\n    if(parent.empty()) return;\n    var svgClass = (_context.attr('class')) ? _context.attr('class').split(' ')[0] : 'text';\n    svgClass += '-math';\n    parent.selectAll('svg.' + svgClass).remove();\n    parent.selectAll('g.' + svgClass + '-group').remove();\n    _context.style('display', null)\n        .attr({\n            // some callers use data-unformatted *from the <text> element* in 'cancel'\n            // so we need it here even if we're going to turn it into math\n            // these two (plus style and text-anchor attributes) form the key we're\n            // going to use for Drawing.bBox\n            'data-unformatted': str,\n            'data-math': 'N'\n        });\n\n    function showText() {\n        if(!parent.empty()) {\n            svgClass = _context.attr('class') + '-math';\n            parent.select('svg.' + svgClass).remove();\n        }\n        _context.text('')\n            .style('white-space', 'pre');\n\n        var hasLink = buildSVGText(_context.node(), str);\n\n        if(hasLink) {\n            // at least in Chrome, pointer-events does not seem\n            // to be honored in children of <text> elements\n            // so if we have an anchor, we have to make the\n            // whole element respond\n            _context.style('pointer-events', 'all');\n        }\n\n        exports.positionText(_context);\n\n        if(_callback) _callback.call(_context);\n    }\n\n    if(tex) {\n        ((gd && gd._promises) || []).push(new Promise(function(resolve) {\n            _context.style('display', 'none');\n            var fontSize = parseInt(_context.node().style.fontSize, 10);\n            var config = {fontSize: fontSize};\n\n            texToSVG(tex[2], config, function(_svgEl, _glyphDefs, _svgBBox) {\n                parent.selectAll('svg.' + svgClass).remove();\n                parent.selectAll('g.' + svgClass + '-group').remove();\n\n                var newSvg = _svgEl && _svgEl.select('svg');\n                if(!newSvg || !newSvg.node()) {\n                    showText();\n                    resolve();\n                    return;\n                }\n\n                var mathjaxGroup = parent.append('g')\n                    .classed(svgClass + '-group', true)\n                    .attr({\n                        'pointer-events': 'none',\n                        'data-unformatted': str,\n                        'data-math': 'Y'\n                    });\n\n                mathjaxGroup.node().appendChild(newSvg.node());\n\n                // stitch the glyph defs\n                if(_glyphDefs && _glyphDefs.node()) {\n                    newSvg.node().insertBefore(_glyphDefs.node().cloneNode(true),\n                                               newSvg.node().firstChild);\n                }\n\n                var w0 = _svgBBox.width;\n                var h0 = _svgBBox.height;\n\n                newSvg.attr({\n                    class: svgClass,\n                    height: h0,\n                    preserveAspectRatio: 'xMinYMin meet'\n                })\n                .style({overflow: 'visible', 'pointer-events': 'none'});\n\n                var fill = _context.node().style.fill || 'black';\n                var g = newSvg.select('g');\n                g.attr({fill: fill, stroke: fill});\n\n                var bb = g.node().getBoundingClientRect();\n                var w = bb.width;\n                var h = bb.height;\n\n                if(w > w0 || h > h0) {\n                    // this happen in firefox v82+ | see https://bugzilla.mozilla.org/show_bug.cgi?id=1709251 addressed\n                    // temporary fix:\n                    newSvg.style('overflow', 'hidden');\n                    bb = newSvg.node().getBoundingClientRect();\n                    w = bb.width;\n                    h = bb.height;\n                }\n\n                var x = +_context.attr('x');\n                var y = +_context.attr('y');\n\n                // font baseline is about 1/4 fontSize below centerline\n                var textHeight = fontSize || _context.node().getBoundingClientRect().height;\n                var dy = -textHeight / 4;\n\n                if(svgClass[0] === 'y') {\n                    mathjaxGroup.attr({\n                        transform: 'rotate(' + [-90, x, y] +\n                        ')' + strTranslate(-w / 2, dy - h / 2)\n                    });\n                } else if(svgClass[0] === 'l') {\n                    y = dy - h / 2;\n                } else if(svgClass[0] === 'a' && svgClass.indexOf('atitle') !== 0) {\n                    x = 0;\n                    y = dy;\n                } else {\n                    var anchor = _context.attr('text-anchor');\n\n                    x = x - w * (\n                        anchor === 'middle' ? 0.5 :\n                        anchor === 'end' ? 1 : 0\n                    );\n                    y = y + dy - h / 2;\n                }\n\n                newSvg.attr({\n                    x: x,\n                    y: y\n                });\n\n                if(_callback) _callback.call(_context, mathjaxGroup);\n                resolve(mathjaxGroup);\n            });\n        }));\n    } else showText();\n\n    return _context;\n};\n\n\n// MathJax\n\nvar LT_MATCH = /(<|&lt;|&#60;)/g;\nvar GT_MATCH = /(>|&gt;|&#62;)/g;\n\nfunction cleanEscapesForTex(s) {\n    return s.replace(LT_MATCH, '\\\\lt ')\n        .replace(GT_MATCH, '\\\\gt ');\n}\n\nvar inlineMath = [['$', '$'], ['\\\\(', '\\\\)']];\n\nfunction texToSVG(_texString, _config, _callback) {\n    var MathJaxVersion = parseInt(\n        (MathJax.version || '').split('.')[0]\n    );\n\n    if(\n        MathJaxVersion !== 2 &&\n        MathJaxVersion !== 3\n    ) {\n        Lib.warn('No MathJax version:', MathJax.version);\n        return;\n    }\n\n    var originalRenderer,\n        originalConfig,\n        originalProcessSectionDelay,\n        tmpDiv;\n\n    var setConfig2 = function() {\n        originalConfig = Lib.extendDeepAll({}, MathJax.Hub.config);\n\n        originalProcessSectionDelay = MathJax.Hub.processSectionDelay;\n        if(MathJax.Hub.processSectionDelay !== undefined) {\n            // MathJax 2.5+ but not 3+\n            MathJax.Hub.processSectionDelay = 0;\n        }\n\n        return MathJax.Hub.Config({\n            messageStyle: 'none',\n            tex2jax: {\n                inlineMath: inlineMath\n            },\n            displayAlign: 'left',\n        });\n    };\n\n    var setConfig3 = function() {\n        originalConfig = Lib.extendDeepAll({}, MathJax.config);\n\n        if(!MathJax.config.tex) {\n            MathJax.config.tex = {};\n        }\n\n        MathJax.config.tex.inlineMath = inlineMath;\n    };\n\n    var setRenderer2 = function() {\n        originalRenderer = MathJax.Hub.config.menuSettings.renderer;\n        if(originalRenderer !== 'SVG') {\n            return MathJax.Hub.setRenderer('SVG');\n        }\n    };\n\n    var setRenderer3 = function() {\n        originalRenderer = MathJax.config.startup.output;\n        if(originalRenderer !== 'svg') {\n            MathJax.config.startup.output = 'svg';\n        }\n    };\n\n    var initiateMathJax = function() {\n        var randomID = 'math-output-' + Lib.randstr({}, 64);\n        tmpDiv = d3.select('body').append('div')\n            .attr({id: randomID})\n            .style({\n                visibility: 'hidden',\n                position: 'absolute',\n                'font-size': _config.fontSize + 'px'\n            })\n            .text(cleanEscapesForTex(_texString));\n\n        var tmpNode = tmpDiv.node();\n\n        return MathJaxVersion === 2 ?\n            MathJax.Hub.Typeset(tmpNode) :\n            MathJax.typeset([tmpNode]);\n    };\n\n    var finalizeMathJax = function() {\n        var sel = tmpDiv.select(\n            MathJaxVersion === 2 ? '.MathJax_SVG' : '.MathJax'\n        );\n\n        var node = !sel.empty() && tmpDiv.select('svg').node();\n        if(!node) {\n            Lib.log('There was an error in the tex syntax.', _texString);\n            _callback();\n        } else {\n            var nodeBBox = node.getBoundingClientRect();\n            var glyphDefs;\n            if(MathJaxVersion === 2) {\n                glyphDefs = d3.select('body').select('#MathJax_SVG_glyphs');\n            } else {\n                glyphDefs = sel.select('defs');\n            }\n            _callback(sel, glyphDefs, nodeBBox);\n        }\n\n        tmpDiv.remove();\n    };\n\n    var resetRenderer2 = function() {\n        if(originalRenderer !== 'SVG') {\n            return MathJax.Hub.setRenderer(originalRenderer);\n        }\n    };\n\n    var resetRenderer3 = function() {\n        if(originalRenderer !== 'svg') {\n            MathJax.config.startup.output = originalRenderer;\n        }\n    };\n\n    var resetConfig2 = function() {\n        if(originalProcessSectionDelay !== undefined) {\n            MathJax.Hub.processSectionDelay = originalProcessSectionDelay;\n        }\n        return MathJax.Hub.Config(originalConfig);\n    };\n\n    var resetConfig3 = function() {\n        MathJax.config = originalConfig;\n    };\n\n    if(MathJaxVersion === 2) {\n        MathJax.Hub.Queue(\n            setConfig2,\n            setRenderer2,\n            initiateMathJax,\n            finalizeMathJax,\n            resetRenderer2,\n            resetConfig2\n        );\n    } else if(MathJaxVersion === 3) {\n        setConfig3();\n        setRenderer3();\n        MathJax.startup.defaultReady();\n\n        MathJax.startup.promise.then(function() {\n            initiateMathJax();\n            finalizeMathJax();\n\n            resetRenderer3();\n            resetConfig3();\n        });\n    }\n}\n\nvar TAG_STYLES = {\n    // would like to use baseline-shift for sub/sup but FF doesn't support it\n    // so we need to use dy along with the uber hacky shift-back-to\n    // baseline below\n    sup: 'font-size:70%',\n    sub: 'font-size:70%',\n    s: 'text-decoration:line-through',\n    u: 'text-decoration:underline',\n    b: 'font-weight:bold',\n    i: 'font-style:italic',\n    a: 'cursor:pointer',\n    span: '',\n    em: 'font-style:italic;font-weight:bold'\n};\n\n// baseline shifts for sub and sup\nvar SHIFT_DY = {\n    sub: '0.3em',\n    sup: '-0.6em'\n};\n// reset baseline by adding a tspan (empty except for a zero-width space)\n// with dy of -70% * SHIFT_DY (because font-size=70%)\nvar RESET_DY = {\n    sub: '-0.21em',\n    sup: '0.42em'\n};\nvar ZERO_WIDTH_SPACE = '\\u200b';\n\n/*\n * Whitelist of protocols in user-supplied urls. Mostly we want to avoid javascript\n * and related attack vectors. The empty items are there for IE, that in various\n * versions treats relative paths as having different flavors of no protocol, while\n * other browsers have these explicitly inherit the protocol of the page they're in.\n */\nvar PROTOCOLS = ['http:', 'https:', 'mailto:', '', undefined, ':'];\n\nvar NEWLINES = exports.NEWLINES = /(\\r\\n?|\\n)/g;\n\nvar SPLIT_TAGS = /(<[^<>]*>)/;\n\nvar ONE_TAG = /<(\\/?)([^ >]*)(\\s+(.*))?>/i;\n\nvar BR_TAG = /<br(\\s+.*)?>/i;\nexports.BR_TAG_ALL = /<br(\\s+.*)?>/gi;\n\n/*\n * style and href: pull them out of either single or double quotes. Also\n * - target: (_blank|_self|_parent|_top|framename)\n *     note that you can't use target to get a popup but if you use popup,\n *     a `framename` will be passed along as the name of the popup window.\n *     per the spec, cannot contain whitespace.\n *     for backward compatibility we default to '_blank'\n * - popup: a custom one for us to enable popup (new window) links. String\n *     for window.open -> strWindowFeatures, like 'menubar=yes,width=500,height=550'\n *     note that at least in Chrome, you need to give at least one property\n *     in this string or the page will open in a new tab anyway. We follow this\n *     convention and will not make a popup if this string is empty.\n *     per the spec, cannot contain whitespace.\n *\n * Because we hack in other attributes with style (sub & sup), drop any trailing\n * semicolon in user-supplied styles so we can consistently append the tag-dependent style\n *\n * These are for tag attributes; Chrome anyway will convert entities in\n * attribute values, but not in attribute names\n * you can test this by for example:\n * > p = document.createElement('p')\n * > p.innerHTML = '<span styl&#x65;=\"font-color:r&#x65;d;\">Hi</span>'\n * > p.innerHTML\n * <- '<span styl&#x65;=\"font-color:red;\">Hi</span>'\n */\nvar STYLEMATCH = /(^|[\\s\"'])style\\s*=\\s*(\"([^\"]*);?\"|'([^']*);?')/i;\nvar HREFMATCH = /(^|[\\s\"'])href\\s*=\\s*(\"([^\"]*)\"|'([^']*)')/i;\nvar TARGETMATCH = /(^|[\\s\"'])target\\s*=\\s*(\"([^\"\\s]*)\"|'([^'\\s]*)')/i;\nvar POPUPMATCH = /(^|[\\s\"'])popup\\s*=\\s*(\"([\\w=,]*)\"|'([\\w=,]*)')/i;\n\n// dedicated matcher for these quoted regexes, that can return their results\n// in two different places\nfunction getQuotedMatch(_str, re) {\n    if(!_str) return null;\n    var match = _str.match(re);\n    var result = match && (match[3] || match[4]);\n    return result && convertEntities(result);\n}\n\nvar COLORMATCH = /(^|;)\\s*color:/;\n\n/**\n * Strip string of tags\n *\n * @param {string} _str : input string\n * @param {object} opts :\n * - len {number} max length of output string\n * - allowedTags {array} list of pseudo-html tags to NOT strip\n * @return {string}\n */\nexports.plainText = function(_str, opts) {\n    opts = opts || {};\n\n    var len = (opts.len !== undefined && opts.len !== -1) ? opts.len : Infinity;\n    var allowedTags = opts.allowedTags !== undefined ? opts.allowedTags : ['br'];\n\n    var ellipsis = '...';\n    var eLen = ellipsis.length;\n\n    var oldParts = _str.split(SPLIT_TAGS);\n    var newParts = [];\n    var prevTag = '';\n    var l = 0;\n\n    for(var i = 0; i < oldParts.length; i++) {\n        var p = oldParts[i];\n        var match = p.match(ONE_TAG);\n        var tagType = match && match[2].toLowerCase();\n\n        if(tagType) {\n            // N.B. tags do not count towards string length\n            if(allowedTags.indexOf(tagType) !== -1) {\n                newParts.push(p);\n                prevTag = tagType;\n            }\n        } else {\n            var pLen = p.length;\n\n            if((l + pLen) < len) {\n                newParts.push(p);\n                l += pLen;\n            } else if(l < len) {\n                var pLen2 = len - l;\n\n                if(prevTag && (prevTag !== 'br' || pLen2 <= eLen || pLen <= eLen)) {\n                    newParts.pop();\n                }\n\n                if(len > eLen) {\n                    newParts.push(p.substr(0, pLen2 - eLen) + ellipsis);\n                } else {\n                    newParts.push(p.substr(0, pLen2));\n                }\n                break;\n            }\n\n            prevTag = '';\n        }\n    }\n\n    return newParts.join('');\n};\n\n/*\n * N.B. HTML entities are listed without the leading '&' and trailing ';'\n * https://www.freeformatter.com/html-entities.html\n *\n * FWIW if we wanted to support the full set, it has 2261 entries:\n * https://www.w3.org/TR/html5/entities.json\n * though I notice that some of these are duplicates and/or are missing \";\"\n * eg: \"&amp;\", \"&amp\", \"&AMP;\", and \"&AMP\" all map to \"&\"\n * We no longer need to include numeric entities here, these are now handled\n * by String.fromCodePoint/fromCharCode\n *\n * Anyway the only ones that are really important to allow are the HTML special\n * chars <, >, and &, because these ones can trigger special processing if not\n * replaced by the corresponding entity.\n */\nvar entityToUnicode = {\n    mu: 'μ',\n    amp: '&',\n    lt: '<',\n    gt: '>',\n    nbsp: ' ',\n    times: '×',\n    plusmn: '±',\n    deg: '°'\n};\n\n// NOTE: in general entities can contain uppercase too (so [a-zA-Z]) but all the\n// ones we support use only lowercase. If we ever change that, update the regex.\nvar ENTITY_MATCH = /&(#\\d+|#x[\\da-fA-F]+|[a-z]+);/g;\nfunction convertEntities(_str) {\n    return _str.replace(ENTITY_MATCH, function(fullMatch, innerMatch) {\n        var outChar;\n        if(innerMatch.charAt(0) === '#') {\n            // cannot use String.fromCodePoint in IE\n            outChar = fromCodePoint(\n                innerMatch.charAt(1) === 'x' ?\n                    parseInt(innerMatch.substr(2), 16) :\n                    parseInt(innerMatch.substr(1), 10)\n            );\n        } else outChar = entityToUnicode[innerMatch];\n\n        // as in regular HTML, if we didn't decode the entity just\n        // leave the raw text in place.\n        return outChar || fullMatch;\n    });\n}\nexports.convertEntities = convertEntities;\n\nfunction fromCodePoint(code) {\n    // Don't allow overflow. In Chrome this turns into � but I feel like it's\n    // more useful to just not convert it at all.\n    if(code > 0x10FFFF) return;\n    var stringFromCodePoint = String.fromCodePoint;\n    if(stringFromCodePoint) return stringFromCodePoint(code);\n\n    // IE doesn't have String.fromCodePoint\n    // see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/fromCodePoint\n    var stringFromCharCode = String.fromCharCode;\n    if(code <= 0xFFFF) return stringFromCharCode(code);\n    return stringFromCharCode(\n        (code >> 10) + 0xD7C0,\n        (code % 0x400) + 0xDC00\n    );\n}\n\n/*\n * buildSVGText: convert our pseudo-html into SVG tspan elements, and attach these\n * to containerNode\n *\n * @param {svg text element} containerNode: the <text> node to insert this text into\n * @param {string} str: the pseudo-html string to convert to svg\n *\n * @returns {bool}: does the result contain any links? We need to handle the text element\n *   somewhat differently if it does, so just keep track of this when it happens.\n */\nfunction buildSVGText(containerNode, str) {\n    /*\n     * Normalize behavior between IE and others wrt newlines and whitespace:pre\n     * this combination makes IE barf https://github.com/plotly/plotly.js/issues/746\n     * Chrome and FF display \\n, \\r, or \\r\\n as a space in this mode.\n     * I feel like at some point we turned these into <br> but currently we don't so\n     * I'm just going to cement what we do now in Chrome and FF\n     */\n    str = str.replace(NEWLINES, ' ');\n\n    var hasLink = false;\n\n    // as we're building the text, keep track of what elements we're nested inside\n    // nodeStack will be an array of {node, type, style, href, target, popup}\n    // where only type: 'a' gets the last 3 and node is only added when it's created\n    var nodeStack = [];\n    var currentNode;\n    var currentLine = -1;\n\n    function newLine() {\n        currentLine++;\n\n        var lineNode = document.createElementNS(xmlnsNamespaces.svg, 'tspan');\n        d3.select(lineNode).attr({\n            class: 'line',\n            dy: (currentLine * LINE_SPACING) + 'em'\n        });\n        containerNode.appendChild(lineNode);\n\n        currentNode = lineNode;\n\n        var oldNodeStack = nodeStack;\n        nodeStack = [{node: lineNode}];\n\n        if(oldNodeStack.length > 1) {\n            for(var i = 1; i < oldNodeStack.length; i++) {\n                enterNode(oldNodeStack[i]);\n            }\n        }\n    }\n\n    function enterNode(nodeSpec) {\n        var type = nodeSpec.type;\n        var nodeAttrs = {};\n        var nodeType;\n\n        if(type === 'a') {\n            nodeType = 'a';\n            var target = nodeSpec.target;\n            var href = nodeSpec.href;\n            var popup = nodeSpec.popup;\n            if(href) {\n                nodeAttrs = {\n                    'xlink:xlink:show': (target === '_blank' || target.charAt(0) !== '_') ? 'new' : 'replace',\n                    target: target,\n                    'xlink:xlink:href': href\n                };\n                if(popup) {\n                    // security: href and target are not inserted as code but\n                    // as attributes. popup is, but limited to /[A-Za-z0-9_=,]/\n                    nodeAttrs.onclick = 'window.open(this.href.baseVal,this.target.baseVal,\"' +\n                        popup + '\");return false;';\n                }\n            }\n        } else nodeType = 'tspan';\n\n        if(nodeSpec.style) nodeAttrs.style = nodeSpec.style;\n\n        var newNode = document.createElementNS(xmlnsNamespaces.svg, nodeType);\n\n        if(type === 'sup' || type === 'sub') {\n            addTextNode(currentNode, ZERO_WIDTH_SPACE);\n            currentNode.appendChild(newNode);\n\n            var resetter = document.createElementNS(xmlnsNamespaces.svg, 'tspan');\n            addTextNode(resetter, ZERO_WIDTH_SPACE);\n            d3.select(resetter).attr('dy', RESET_DY[type]);\n            nodeAttrs.dy = SHIFT_DY[type];\n\n            currentNode.appendChild(newNode);\n            currentNode.appendChild(resetter);\n        } else {\n            currentNode.appendChild(newNode);\n        }\n\n        d3.select(newNode).attr(nodeAttrs);\n\n        currentNode = nodeSpec.node = newNode;\n        nodeStack.push(nodeSpec);\n    }\n\n    function addTextNode(node, text) {\n        node.appendChild(document.createTextNode(text));\n    }\n\n    function exitNode(type) {\n        // A bare closing tag can't close the root node. If we encounter this it\n        // means there's an extra closing tag that can just be ignored:\n        if(nodeStack.length === 1) {\n            Lib.log('Ignoring unexpected end tag </' + type + '>.', str);\n            return;\n        }\n\n        var innerNode = nodeStack.pop();\n\n        if(type !== innerNode.type) {\n            Lib.log('Start tag <' + innerNode.type + '> doesnt match end tag <' +\n                type + '>. Pretending it did match.', str);\n        }\n        currentNode = nodeStack[nodeStack.length - 1].node;\n    }\n\n    var hasLines = BR_TAG.test(str);\n\n    if(hasLines) newLine();\n    else {\n        currentNode = containerNode;\n        nodeStack = [{node: containerNode}];\n    }\n\n    var parts = str.split(SPLIT_TAGS);\n    for(var i = 0; i < parts.length; i++) {\n        var parti = parts[i];\n        var match = parti.match(ONE_TAG);\n        var tagType = match && match[2].toLowerCase();\n        var tagStyle = TAG_STYLES[tagType];\n\n        if(tagType === 'br') {\n            newLine();\n        } else if(tagStyle === undefined) {\n            addTextNode(currentNode, convertEntities(parti));\n        } else {\n            // tag - open or close\n            if(match[1]) {\n                exitNode(tagType);\n            } else {\n                var extra = match[4];\n\n                var nodeSpec = {type: tagType};\n\n                // now add style, from both the tag name and any extra css\n                // Most of the svg css that users will care about is just like html,\n                // but font color is different (uses fill). Let our users ignore this.\n                var css = getQuotedMatch(extra, STYLEMATCH);\n                if(css) {\n                    css = css.replace(COLORMATCH, '$1 fill:');\n                    if(tagStyle) css += ';' + tagStyle;\n                } else if(tagStyle) css = tagStyle;\n\n                if(css) nodeSpec.style = css;\n\n                if(tagType === 'a') {\n                    hasLink = true;\n\n                    var href = getQuotedMatch(extra, HREFMATCH);\n\n                    if(href) {\n                        var safeHref = sanitizeHref(href);\n                        if(safeHref) {\n                            nodeSpec.href = safeHref;\n                            nodeSpec.target = getQuotedMatch(extra, TARGETMATCH) || '_blank';\n                            nodeSpec.popup = getQuotedMatch(extra, POPUPMATCH);\n                        }\n                    }\n                }\n\n                enterNode(nodeSpec);\n            }\n        }\n    }\n\n    return hasLink;\n}\n\nfunction sanitizeHref(href) {\n    var decodedHref = encodeURI(decodeURI(href));\n    var dummyAnchor1 = document.createElement('a');\n    var dummyAnchor2 = document.createElement('a');\n    dummyAnchor1.href = href;\n    dummyAnchor2.href = decodedHref;\n\n    var p1 = dummyAnchor1.protocol;\n    var p2 = dummyAnchor2.protocol;\n\n    // check safe protocols\n    if(\n        PROTOCOLS.indexOf(p1) !== -1 &&\n        PROTOCOLS.indexOf(p2) !== -1\n    ) {\n        return decodedHref;\n    } else {\n        return '';\n    }\n}\n\n/*\n * sanitizeHTML: port of buildSVGText aimed at providing a clean subset of HTML\n * @param {string} str: the html string to clean\n * @returns {string}: a cleaned and normalized version of the input,\n *     supporting only a small subset of html\n */\nexports.sanitizeHTML = function sanitizeHTML(str) {\n    str = str.replace(NEWLINES, ' ');\n\n    var rootNode = document.createElement('p');\n    var currentNode = rootNode;\n    var nodeStack = [];\n\n    var parts = str.split(SPLIT_TAGS);\n    for(var i = 0; i < parts.length; i++) {\n        var parti = parts[i];\n        var match = parti.match(ONE_TAG);\n        var tagType = match && match[2].toLowerCase();\n\n        if(tagType in TAG_STYLES) {\n            if(match[1]) {\n                if(nodeStack.length) {\n                    currentNode = nodeStack.pop();\n                }\n            } else {\n                var extra = match[4];\n\n                var css = getQuotedMatch(extra, STYLEMATCH);\n                var nodeAttrs = css ? {style: css} : {};\n\n                if(tagType === 'a') {\n                    var href = getQuotedMatch(extra, HREFMATCH);\n\n                    if(href) {\n                        var safeHref = sanitizeHref(href);\n                        if(safeHref) {\n                            nodeAttrs.href = safeHref;\n                            var target = getQuotedMatch(extra, TARGETMATCH);\n                            if(target) {\n                                nodeAttrs.target = target;\n                            }\n                        }\n                    }\n                }\n\n                var newNode = document.createElement(tagType);\n                currentNode.appendChild(newNode);\n                d3.select(newNode).attr(nodeAttrs);\n\n                currentNode = newNode;\n                nodeStack.push(newNode);\n            }\n        } else {\n            currentNode.appendChild(\n                document.createTextNode(convertEntities(parti))\n            );\n        }\n    }\n    var key = 'innerHTML'; // i.e. to avoid pass test-syntax\n    return rootNode[key];\n};\n\nexports.lineCount = function lineCount(s) {\n    return s.selectAll('tspan.line').size() || 1;\n};\n\nexports.positionText = function positionText(s, x, y) {\n    return s.each(function() {\n        var text = d3.select(this);\n\n        function setOrGet(attr, val) {\n            if(val === undefined) {\n                val = text.attr(attr);\n                if(val === null) {\n                    text.attr(attr, 0);\n                    val = 0;\n                }\n            } else text.attr(attr, val);\n            return val;\n        }\n\n        var thisX = setOrGet('x', x);\n        var thisY = setOrGet('y', y);\n\n        if(this.nodeName === 'text') {\n            text.selectAll('tspan.line').attr({x: thisX, y: thisY});\n        }\n    });\n};\n\nfunction alignHTMLWith(_base, container, options) {\n    var alignH = options.horizontalAlign;\n    var alignV = options.verticalAlign || 'top';\n    var bRect = _base.node().getBoundingClientRect();\n    var cRect = container.node().getBoundingClientRect();\n    var thisRect;\n    var getTop;\n    var getLeft;\n\n    if(alignV === 'bottom') {\n        getTop = function() { return bRect.bottom - thisRect.height; };\n    } else if(alignV === 'middle') {\n        getTop = function() { return bRect.top + (bRect.height - thisRect.height) / 2; };\n    } else { // default: top\n        getTop = function() { return bRect.top; };\n    }\n\n    if(alignH === 'right') {\n        getLeft = function() { return bRect.right - thisRect.width; };\n    } else if(alignH === 'center') {\n        getLeft = function() { return bRect.left + (bRect.width - thisRect.width) / 2; };\n    } else { // default: left\n        getLeft = function() { return bRect.left; };\n    }\n\n    return function() {\n        thisRect = this.node().getBoundingClientRect();\n\n        var x0 = getLeft() - cRect.left;\n        var y0 = getTop() - cRect.top;\n        var gd = options.gd || {};\n        if(options.gd) {\n            gd._fullLayout._calcInverseTransform(gd);\n            var transformedCoords = Lib.apply3DTransform(gd._fullLayout._invTransform)(x0, y0);\n            x0 = transformedCoords[0];\n            y0 = transformedCoords[1];\n        }\n\n        this.style({\n            top: y0 + 'px',\n            left: x0 + 'px',\n            'z-index': 1000\n        });\n        return this;\n    };\n}\n\nvar onePx = '1px ';\n\nexports.makeTextShadow = function(color) {\n    var x = onePx;\n    var y = onePx;\n    var b = onePx;\n    return x + y + b + color + ', ' +\n        '-' + x + '-' + y + b + color + ', ' +\n        x + '-' + y + b + color + ', ' +\n        '-' + x + y + b + color;\n};\n\n/*\n * Editable title\n * @param {d3.selection} context: the element being edited. Normally text,\n *   but if it isn't, you should provide the styling options\n * @param {object} options:\n *   @param {div} options.gd: graphDiv\n *   @param {d3.selection} options.delegate: item to bind events to if not this\n *   @param {boolean} options.immediate: start editing now (true) or on click (false, default)\n *   @param {string} options.fill: font color if not as shown\n *   @param {string} options.background: background color if not as shown\n *   @param {string} options.text: initial text, if not as shown\n *   @param {string} options.horizontalAlign: alignment of the edit box wrt. the bound element\n *   @param {string} options.verticalAlign: alignment of the edit box wrt. the bound element\n */\n\nexports.makeEditable = function(context, options) {\n    var gd = options.gd;\n    var _delegate = options.delegate;\n    var dispatch = d3.dispatch('edit', 'input', 'cancel');\n    var handlerElement = _delegate || context;\n\n    context.style({'pointer-events': _delegate ? 'none' : 'all'});\n\n    if(context.size() !== 1) throw new Error('boo');\n\n    function handleClick() {\n        appendEditable();\n        context.style({opacity: 0});\n        // also hide any mathjax svg\n        var svgClass = handlerElement.attr('class');\n        var mathjaxClass;\n        if(svgClass) mathjaxClass = '.' + svgClass.split(' ')[0] + '-math-group';\n        else mathjaxClass = '[class*=-math-group]';\n        if(mathjaxClass) {\n            d3.select(context.node().parentNode).select(mathjaxClass).style({opacity: 0});\n        }\n    }\n\n    function selectElementContents(_el) {\n        var el = _el.node();\n        var range = document.createRange();\n        range.selectNodeContents(el);\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n        el.focus();\n    }\n\n    function appendEditable() {\n        var plotDiv = d3.select(gd);\n        var container = plotDiv.select('.svg-container');\n        var div = container.append('div');\n        var cStyle = context.node().style;\n        var fontSize = parseFloat(cStyle.fontSize || 12);\n\n        var initialText = options.text;\n        if(initialText === undefined) initialText = context.attr('data-unformatted');\n\n        div.classed('plugin-editable editable', true)\n            .style({\n                position: 'absolute',\n                'font-family': cStyle.fontFamily || 'Arial',\n                'font-size': fontSize,\n                color: options.fill || cStyle.fill || 'black',\n                opacity: 1,\n                'background-color': options.background || 'transparent',\n                outline: '#ffffff33 1px solid',\n                margin: [-fontSize / 8 + 1, 0, 0, -1].join('px ') + 'px',\n                padding: '0',\n                'box-sizing': 'border-box'\n            })\n            .attr({contenteditable: true})\n            .text(initialText)\n            .call(alignHTMLWith(context, container, options))\n            .on('blur', function() {\n                gd._editing = false;\n                context.text(this.textContent)\n                    .style({opacity: 1});\n                var svgClass = d3.select(this).attr('class');\n                var mathjaxClass;\n                if(svgClass) mathjaxClass = '.' + svgClass.split(' ')[0] + '-math-group';\n                else mathjaxClass = '[class*=-math-group]';\n                if(mathjaxClass) {\n                    d3.select(context.node().parentNode).select(mathjaxClass).style({opacity: 0});\n                }\n                var text = this.textContent;\n                d3.select(this).transition().duration(0).remove();\n                d3.select(document).on('mouseup', null);\n                dispatch.edit.call(context, text);\n            })\n            .on('focus', function() {\n                var editDiv = this;\n                gd._editing = true;\n                d3.select(document).on('mouseup', function() {\n                    if(d3.event.target === editDiv) return false;\n                    if(document.activeElement === div.node()) div.node().blur();\n                });\n            })\n            .on('keyup', function() {\n                if(d3.event.which === 27) {\n                    gd._editing = false;\n                    context.style({opacity: 1});\n                    d3.select(this)\n                        .style({opacity: 0})\n                        .on('blur', function() { return false; })\n                        .transition().remove();\n                    dispatch.cancel.call(context, this.textContent);\n                } else {\n                    dispatch.input.call(context, this.textContent);\n                    d3.select(this).call(alignHTMLWith(context, container, options));\n                }\n            })\n            .on('keydown', function() {\n                if(d3.event.which === 13) this.blur();\n            })\n            .call(selectElementContents);\n    }\n\n    if(options.immediate) handleClick();\n    else handlerElement.on('click', handleClick);\n\n    return d3.rebind(context, dispatch, 'on');\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}